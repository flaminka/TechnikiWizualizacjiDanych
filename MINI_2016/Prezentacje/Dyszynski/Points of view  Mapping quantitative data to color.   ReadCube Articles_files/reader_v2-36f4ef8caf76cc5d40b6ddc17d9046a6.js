/*!
 * jQuery Browser Plugin v0.0.5
 * https://github.com/gabceb/jquery-browser-plugin
 *
 * Original jquery-browser code Copyright 2005, 2013 jQuery Foundation, Inc. and other contributors
 * http://jquery.org/license
 *
 * Modifications Copyright 2013 Gabriel Cebrian
 * https://github.com/gabceb
 *
 * Released under the MIT license
 *
 * Date: 2013-07-29T17:23:27-07:00
 */
function parseUri(t){for(var e=parseUri.options,n=e.parser[e.strictMode?"strict":"loose"].exec(t),i={},r=14;r--;)i[e.key[r]]=n[r]||"";return i[e.q.name]={},i[e.key[12]].replace(e.q.parser,function(t,n,r){n&&(i[e.q.name][n]=r)}),i}!function(t,e){"use strict";var n,i;if(t.uaMatch=function(t){t=t.toLowerCase();var e=/(opr)[\/]([\w.]+)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[],n=/(ipad)/.exec(t)||/(iphone)/.exec(t)||/(android)/.exec(t)||/(windows phone)/.exec(t)||/(win)/.exec(t)||/(mac)/.exec(t)||/(linux)/.exec(t)||[];return{browser:e[3]||e[1]||"",version:e[2]||"0",platform:n[0]||""}},n=t.uaMatch(e.navigator.userAgent),i={},n.browser&&(i[n.browser]=!0,i.version=n.version,i.versionNumber=parseInt(n.version)),n.platform&&(i[n.platform]=!0),(i.chrome||i.opr||i.safari)&&(i.webkit=!0),i.rv){var r="msie";n.browser=r,i[r]=!0}if(i.opr){var s="opera";n.browser=s,i[s]=!0}if(i.safari&&i.android){var o="android";n.browser=o,i[o]=!0}i.name=n.browser,i.platform=n.platform,t.browser=i}(jQuery,window);/**
 * @license almond 0.2.7 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */
var requirejs,require,define;!function(t){function e(t,e){return v.call(t,e)}function n(t,e){var n,i,r,s,o,a,c,l,u,d,h=e&&e.split("/"),f=g.map,p=f&&f["*"]||{};if(t&&"."===t.charAt(0))if(e){for(h=h.slice(0,h.length-1),t=h.concat(t.split("/")),l=0;l<t.length;l+=1)if(d=t[l],"."===d)t.splice(l,1),l-=1;else if(".."===d){if(1===l&&(".."===t[2]||".."===t[0]))break;l>0&&(t.splice(l-1,2),l-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((h||p)&&f){for(n=t.split("/"),l=n.length;l>0;l-=1){if(i=n.slice(0,l).join("/"),h)for(u=h.length;u>0;u-=1)if(r=f[h.slice(0,u).join("/")],r&&(r=r[i])){s=r,o=l;break}if(s)break;!a&&p&&p[i]&&(a=p[i],c=l)}!s&&a&&(s=a,o=c),s&&(n.splice(0,o,s),t=n.join("/"))}return t}function i(e,n){return function(){return u.apply(t,b.call(arguments,0).concat([e,n]))}}function r(t){return function(e){return n(e,t)}}function s(t){return function(e){f[t]=e}}function o(n){if(e(p,n)){var i=p[n];delete p[n],m[n]=!0,l.apply(t,i)}if(!e(f,n)&&!e(m,n))throw new Error("No "+n);return f[n]}function a(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function c(t){return function(){return g&&g.config&&g.config[t]||{}}}var l,u,d,h,f={},p={},g={},m={},v=Object.prototype.hasOwnProperty,b=[].slice;d=function(t,e){var i,s=a(t),c=s[0];return t=s[1],c&&(c=n(c,e),i=o(c)),c?t=i&&i.normalize?i.normalize(t,r(e)):n(t,e):(t=n(t,e),s=a(t),c=s[0],t=s[1],c&&(i=o(c))),{f:c?c+"!"+t:t,n:t,pr:c,p:i}},h={require:function(t){return i(t)},exports:function(t){var e=f[t];return"undefined"!=typeof e?e:f[t]={}},module:function(t){return{id:t,uri:"",exports:f[t],config:c(t)}}},l=function(n,r,a,c){var l,u,g,v,b,y,_=[],w=typeof a;if(c=c||n,"undefined"===w||"function"===w){for(r=!r.length&&a.length?["require","exports","module"]:r,b=0;b<r.length;b+=1)if(v=d(r[b],c),u=v.f,"require"===u)_[b]=h.require(n);else if("exports"===u)_[b]=h.exports(n),y=!0;else if("module"===u)l=_[b]=h.module(n);else if(e(f,u)||e(p,u)||e(m,u))_[b]=o(u);else{if(!v.p)throw new Error(n+" missing "+u);v.p.load(v.n,i(c,!0),s(u),{}),_[b]=f[u]}g=a?a.apply(f[n],_):void 0,n&&(l&&l.exports!==t&&l.exports!==f[n]?f[n]=l.exports:g===t&&y||(f[n]=g))}else n&&(f[n]=a)},requirejs=require=u=function(e,n,i,r,s){return"string"==typeof e?h[e]?h[e](n):o(d(e,n).f):(e.splice||(g=e,n.splice?(e=n,n=i,i=null):e=t),n=n||function(){},"function"==typeof i&&(i=r,r=s),r?l(t,e,n,i):setTimeout(function(){l(t,e,n,i)},4),u)},u.config=function(t){return g=t,g.deps&&u(g.deps,g.callback),u},requirejs._defined=f,define=function(t,n,i){n.splice||(i=n,n=[]),e(f,t)||e(p,t)||(p[t]=[t,n,i])},define.amd={jQuery:!0}}(),define("enviroment",function(){function t(t){return t.toLowerCase()==a}function e(){return a}function n(){return t("development")}function i(){return t("staging")}function r(){return t("production")}function s(){/^(www\.)?readcube\.com$/i.test(c)?a="production":/^staging\.readcube\.com$/i.test(c)?a="staging":/^local\.readcube\.com$/i.test(c)&&(a="development")}var o={},a="unknown",c=document.domain;return s(),o.is=t,o.get=e,o.staging=i,o.production=r,o.development=n,window.env=o,o}),define("util",function(){function t(){try{if(window["readcube-console-log"]||localStorage.getItem("readcube-console-log"))return console.log.apply(console,arguments)}catch(t){}}function e(t){return"undefined"==typeof t?(new Date).toISOString():new Date(t).toISOString()}function n(t){var e={};if(!t)return e;for(var n=0;n<t.length;n++)e[t[n].id]=t[n];return e}function i(t){var e=[];if(!t)return e;for(var n in t)e.push(t[n]);return e}function r(t,e){return"undefined"!=typeof e[t]}function s(t){return $.extend(!0,{},t)}function o(){return Array.prototype.splice.call(arguments,0,0,!0,{}),$.extend.apply($,arguments)}function a(t){var e=[];for(var n in t)e.push(n+"="+encodeURIComponent(t[n]));return e.join("&")}function c(t,e){var n=t.split("#");return n[0]+=-1==n[0].indexOf("?")?"?":"&",n[0]+=a(e),n.join("#")}function l(t,e){var n=null,i=null,r=0,s=function(){clearTimeout(n),n=null,r=Date.now(),t.apply(i,arguments)};return function(){i=this;var t=Date.now()-r,o=e-t;0>o?s():n||(n=setTimeout(s,o))}}function u(t){setTimeout(t,0)}function d(t,e,n){n&&(t+="?_ts="+(new Date).getTime()),$.get(t,function(){$("<link>",{rel:"stylesheet",type:"text/css",href:t}).appendTo("head"),e&&e()})}function h(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=0|16*Math.random(),n="x"==t?e:8|3&e;return n.toString(16)})}function f(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function p(t){return/[¸ˇ´¨`'"~]{1}/.test(t)}function g(t){return{width:t[0].offsetWidth,height:t[0].offsetHeight}}function m(){return m.md?m.md:(m.md=$("<div></div>").css({position:"absolute",visibility:"hidden"}).appendTo(document.body),m.md)}function v(t){if(document.body.contains(t[0]))return g(t);t=t.clone(),t.appendTo(m());var e=g(t);return t.remove(),e}function b(t){for(var e={top:+1/0,left:+1/0,bottom:-1/0,right:-1/0},n=0;n<t.length;n++){var i=t[n].getBoundingClientRect();e.top=Math.min(e.top,i.top),e.left=Math.min(e.left,i.left),e.bottom=Math.max(e.bottom,i.bottom),e.right=Math.max(e.right,i.right)}return e}function y(t){var e=document.createElement("span");return t.parentNode.insertBefore(e,t),e.appendChild(t),e}function _(t){var e=t.firstChild;return t.parentNode.insertBefore(e,t),t.parentNode.removeChild(t),e}function w(){var t=document.createElement("div");t.style.visibility="hidden",t.style.width="100px",t.style.msOverflowStyle="scrollbar",document.body.appendChild(t);var e=t.offsetWidth;t.style.overflow="scroll";var n=document.createElement("div");n.style.width="100%",t.appendChild(n);var i=n.offsetWidth;return t.parentNode.removeChild(t),e-i}var x=function(){var t={};return{tic:function(){var e=h();return t[e]=Date.now(),e},toc:function(e){var n=Date.now()-t[e];return delete t[e],n}}}();return{log:t,guid:h,timer:x,loadCss:d,throttle:l,queueExec:u,addParams:c,dateISO:e,regexEscape:f,containsDiacritic:p,clone:s,merge:o,definedKey:r,arrayToHash:n,hashToArray:i,measureElement:v,getBoundingRect:b,wrapTextNode:y,unwrapTextNode:_,getScrollbarWidth:w}}),define("endpoint",["util"],function(t){var e=t.clone(window.readcube.endpoints);return function(n,i){return e[n]?i?t.addParams(e[n],i):e[n]:null}}),window.Modernizr=function(t,e,n){function i(t){b.cssText=t}function r(t,e){return i(_.join(t+";")+(e||""))}function s(t,e){return typeof t===e}function o(t,e){return!!~(""+t).indexOf(e)}function a(t,e){for(var i in t){var r=t[i];if(!o(r,"-")&&b[r]!==n)return"pfx"==e?r:!0}return!1}function c(t,e,i){for(var r in t){var o=e[t[r]];if(o!==n)return i===!1?t[r]:s(o,"function")?o.bind(i||e):o}return!1}function l(t,e,n){var i=t.charAt(0).toUpperCase()+t.slice(1),r=(t+" "+x.join(i+" ")+i).split(" ");return s(e,"string")||s(e,"undefined")?a(r,e):(r=(t+" "+S.join(i+" ")+i).split(" "),c(r,e,n))}var u,d,h,f="2.8.2",p={},g=e.documentElement,m="modernizr",v=e.createElement(m),b=v.style,y=":)",_=({}.toString," -webkit- -moz- -o- -ms- ".split(" ")),w="Webkit Moz O ms",x=w.split(" "),S=w.toLowerCase().split(" "),C={svg:"http://www.w3.org/2000/svg"},k={},T=[],I=T.slice,O=function(t,n,i,r){var s,o,a,c,l=e.createElement("div"),u=e.body,d=u||e.createElement("body");if(parseInt(i,10))for(;i--;)a=e.createElement("div"),a.id=r?r[i]:m+(i+1),l.appendChild(a);return s=["&#173;",'<style id="s',m,'">',t,"</style>"].join(""),l.id=m,(u?l:d).innerHTML+=s,d.appendChild(l),u||(d.style.background="",d.style.overflow="hidden",c=g.style.overflow,g.style.overflow="hidden",g.appendChild(d)),o=n(l,t),u?l.parentNode.removeChild(l):(d.parentNode.removeChild(d),g.style.overflow=c),!!o},E=function(){function t(t,r){r=r||e.createElement(i[t]||"div"),t="on"+t;var o=t in r;return o||(r.setAttribute||(r=e.createElement("div")),r.setAttribute&&r.removeAttribute&&(r.setAttribute(t,""),o=s(r[t],"function"),s(r[t],"undefined")||(r[t]=n),r.removeAttribute(t))),r=null,o}var i={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return t}(),N={}.hasOwnProperty;h=s(N,"undefined")||s(N.call,"undefined")?function(t,e){return e in t&&s(t.constructor.prototype[e],"undefined")}:function(t,e){return N.call(t,e)},Function.prototype.bind||(Function.prototype.bind=function(t){var e=this;if("function"!=typeof e)throw new TypeError;var n=I.call(arguments,1),i=function(){if(this instanceof i){var r=function(){};r.prototype=e.prototype;var s=new r,o=e.apply(s,n.concat(I.call(arguments)));return Object(o)===o?o:s}return e.apply(t,n.concat(I.call(arguments)))};return i}),k.flexbox=function(){return l("flexWrap")},k.flexboxlegacy=function(){return l("boxDirection")},k.postmessage=function(){return!!t.postMessage},k.hashchange=function(){return E("hashchange",t)&&(e.documentMode===n||e.documentMode>7)},k.rgba=function(){return i("background-color:rgba(150,255,150,.5)"),o(b.backgroundColor,"rgba")},k.backgroundsize=function(){return l("backgroundSize")},k.borderradius=function(){return l("borderRadius")},k.boxshadow=function(){return l("boxShadow")},k.textshadow=function(){return""===e.createElement("div").style.textShadow},k.opacity=function(){return r("opacity:.55"),/^0.55$/.test(b.opacity)},k.cssgradients=function(){var t="background-image:",e="gradient(linear,left top,right bottom,from(#9f9),to(white));",n="linear-gradient(left top,#9f9, white);";return i((t+"-webkit- ".split(" ").join(e+t)+_.join(n+t)).slice(0,-t.length)),o(b.backgroundImage,"gradient")},k.csstransforms=function(){return!!l("transform")},k.csstransitions=function(){return l("transition")},k.fontface=function(){var t;return O('@font-face {font-family:"font";src:url("https://")}',function(n,i){var r=e.getElementById("smodernizr"),s=r.sheet||r.styleSheet,o=s?s.cssRules&&s.cssRules[0]?s.cssRules[0].cssText:s.cssText||"":"";t=/src/i.test(o)&&0===o.indexOf(i.split(" ")[0])}),t},k.generatedcontent=function(){var t;return O(["#",m,"{font:0/0 a}#",m,':after{content:"',y,'";visibility:hidden;font:3px/1 a}'].join(""),function(e){t=e.offsetHeight>=3}),t},k.video=function(){var t=e.createElement("video"),n=!1;try{(n=!!t.canPlayType)&&(n=new Boolean(n),n.ogg=t.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),n.h264=t.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),n.webm=t.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""))}catch(i){}return n},k.localstorage=function(){try{return localStorage.setItem(m,m),localStorage.removeItem(m),!0}catch(t){return!1}},k.svg=function(){return!!e.createElementNS&&!!e.createElementNS(C.svg,"svg").createSVGRect};for(var L in k)h(k,L)&&(d=L.toLowerCase(),p[d]=k[L](),T.push((p[d]?"":"no-")+d));return p.addTest=function(t,e){if("object"==typeof t)for(var i in t)h(t,i)&&p.addTest(i,t[i]);else{if(t=t.toLowerCase(),p[t]!==n)return p;e="function"==typeof e?e():e,"undefined"!=typeof enableClasses&&enableClasses&&(g.className+=" "+(e?"":"no-")+t),p[t]=e}return p},i(""),v=u=null,p._version=f,p._prefixes=_,p._domPrefixes=S,p._cssomPrefixes=x,p.hasEvent=E,p.testProp=function(t){return a([t])},p.testAllProps=l,p.testStyles=O,p}(this,this.document),define("mobile-detect",function(){function t(){var t={Android:function(){return/Android/i.test(i)},BlackBerry:function(){return/BlackBerry/i.test(i)},iOS:function(){return/iPhone|iPad|iPod/i.test(i)},Opera:function(){return/Opera Mini/i.test(i)},Windows:function(){/IEMobile/i.test(i)}};for(var e in t)if(t[e]())return e;return null}function e(){return!!t()}function n(){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(i)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(i.substr(0,4))}var i=navigator.userAgent||navigator.vendor||window.opera;return{isMobile:function(){return e()||n()},platform:t}}),define("subpixelfont-test",function(){return function(){var t=document.getElementsByTagName("body")[0],e=document.createElement("div");e.style.position="absolute",e.style.visibility="hidden",e.style.fontFamily='"Georgia"',e.innerHTML="PICS",t.appendChild(e);var n=10,i=4,r=.1;e.style.fontSize=n+"px";var s=e.offsetWidth;e.style.fontSize=n*i+"px";var o=e.offsetWidth;return t.removeChild(e),Math.abs(o/s-i)<r}}),define("compatible",["util","mobile-detect","subpixelfont-test"],function(t,e,n){function i(){return"WebkitAppearance"in document.documentElement.style}function r(){if(e.isMobile())return t.log("[READCUBE] browser is mobile"),{result:!1,message:"mobile_browser"};if(!i()&&!n())return t.log("[READCUBE] browser does not support subpixel font rendering"),{result:!1,message:"font_fail"};for(var r=0;r<s.length;r++){var o=s[r];if("string"!=typeof o){for(var a=!1,c=0;c<o.length;c++)if(Modernizr[o[c]]){a=!0;break}if(!a)return t.log("[READCUBE] browser does not support "+o.join(" or ")),{result:!1,message:"old_browser"}}else if(!Modernizr[o])return t.log("[READCUBE] browser does not support "+o),{result:!1,message:"old_browser"}}return{result:!0}}var s=[["flexbox","flexboxlegacy"],"fontface","backgroundsize","borderradius","boxshadow","opacity","rgba","textshadow","cssgradients","csstransforms","csstransitions","hashchange","video","localstorage","postmessage","svg"];return r()}),parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},/*!
 * jQuery BBQ: Back Button & Query Library - v1.3pre - 8/26/2010
 * http://benalman.com/projects/jquery-bbq-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
// Copyright (c) 2010 "Cowboy" Ben Alman,
function(t){"$:nomunge";function e(t){return"string"==typeof t}function n(t){var e=w.call(arguments,1);return function(){return t.apply(this,e.concat(w.call(arguments)))}}function i(t){return t.replace(v,"$2")}function r(t){return t.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,"$1")}function s(n,i,r,s,o){var a,u,h,f,p;return s!==c?(h=r.match(n?v:/^([^#?]*)\??([^#]*)(#?.*)/),p=h[3]||"",2===o&&e(s)?u=s.replace(n?m:A,""):(f=d(h[2]),s=e(s)?d[n?O:I](s):s,u=2===o?s:1===o?t.extend({},s,f):t.extend({},f,s),u=l(u),n&&(u=u.replace(b,x))),a=h[1]+(n?_:u||!h[1]?"?":"")+u+p):a=i(r!==c?r:location.href),a}function o(t,n,i){return n===c||"boolean"==typeof n?(i=n,n=S[t?O:I]()):n=e(n)?n.replace(t?m:A,""):n,d(n,i)}function a(n,i,r,s){return e(r)||"object"==typeof r||(s=r,r=i,i=c),this.each(function(){var e=t(this),o=i||g()[(this.nodeName||"").toLowerCase()]||"",a=o&&e.attr(o)||"";e.attr(o,S[n](a,r,s))})}var c,l,u,d,h,f,p,g,m,v,b,y,_,w=Array.prototype.slice,x=decodeURIComponent,S=t.param,C=t.bbq=t.bbq||{},k=t.event.special,T="hashchange",I="querystring",O="fragment",E="elemUrlAttr",N="href",L="src",A=/^.*\?|#.*$/g,R={};S[I]=n(s,0,r),S[O]=u=n(s,1,i),S.sorted=l=function(e,n){var i=[],r={};return t.each(S(e,n).split("&"),function(t,e){var n=e.replace(/(?:%5B|=).*$/,""),s=r[n];s||(s=r[n]=[],i.push(n)),s.push(e)}),t.map(i.sort(),function(t){return r[t]}).join("&")},u.noEscape=function(e){e=e||"";var n=t.map(e.split(""),encodeURIComponent);b=new RegExp(n.join("|"),"g")},u.noEscape(",/"),u.ajaxCrawlable=function(t){return t!==c&&(t?(m=/^.*(?:#!|#)/,v=/^([^#]*)(?:#!|#)?(.*)$/,_="#!"):(m=/^.*#/,v=/^([^#]*)#?(.*)$/,_="#"),y=!!t),y},u.ajaxCrawlable(0),t.deparam=d=function(e,n){var i={},r={"true":!0,"false":!1,"null":null};return t.each(e.replace(/\+/g," ").split("&"),function(e,s){var o,a=s.split("="),l=x(a[0]),u=i,d=0,h=l.split("]["),f=h.length-1;if(/\[/.test(h[0])&&/\]$/.test(h[f])?(h[f]=h[f].replace(/\]$/,""),h=h.shift().split("[").concat(h),f=h.length-1):f=0,2===a.length)if(o=x(a[1]),n&&(o=o&&!isNaN(o)?+o:"undefined"===o?c:r[o]!==c?r[o]:o),f)for(;f>=d;d++)l=""===h[d]?u.length:h[d],u=u[l]=f>d?u[l]||(h[d+1]&&isNaN(h[d+1])?{}:[]):o;else t.isArray(i[l])?i[l].push(o):i[l]=i[l]!==c?[i[l],o]:o;else l&&(i[l]=n?c:"")}),i},d[I]=n(o,0),d[O]=h=n(o,1),t[E]||(t[E]=function(e){return t.extend(R,e)})({a:N,base:N,iframe:L,img:L,input:L,form:"action",link:N,script:L}),g=t[E],t.fn[I]=n(a,I),t.fn[O]=n(a,O),C.pushState=f=function(t,n){e(t)&&/^#/.test(t)&&n===c&&(n=2);var i=t!==c,r=u(location.href,i?t:{},i?n:2);location.href=r},C.getState=p=function(t,e){return t===c||"boolean"==typeof t?h(t):h(e)[t]},C.removeState=function(e){var n={};e!==c&&(n=p(),t.each(t.isArray(e)?e:arguments,function(t,e){delete n[e]})),f(n,2)},k[T]=t.extend(k[T],{add:function(e){function n(t){var e=t[O]=u();t.getState=function(t,n){return t===c||"boolean"==typeof t?d(e,t):d(e,n)[t]},i.apply(this,arguments)}var i;return t.isFunction(e)?(i=e,n):(i=e.handler,e.handler=n,void 0)}})}(jQuery,this),/*!
 * jQuery hashchange event - v1.3 - 7/21/2010
 * http://benalman.com/projects/jquery-hashchange-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
// Copyright (c) 2010 "Cowboy" Ben Alman,
function(t,e,n){"$:nomunge";function i(t){return t=t||location.href,"#"+t.replace(/^[^#]*#?(.*)$/,"$1")}var r,s="hashchange",o=document,a=t.event.special,c=o.documentMode,l="on"+s in e&&(c===n||c>7);t.fn[s]=function(t){return t?this.bind(s,t):this.trigger(s)},t.fn[s].delay=50,a[s]=t.extend(a[s],{setup:function(){return l?!1:(t(r.start),void 0)},teardown:function(){return l?!1:(t(r.stop),void 0)}}),r=function(){function r(){var n=i(),o=f(u);n!==u?(h(u=n,o),t(e).trigger(s)):o!==u&&(location.href=location.href.replace(/#.*/,"")+o),a=setTimeout(r,t.fn[s].delay)}var a,c={},u=i(),d=function(t){return t},h=d,f=d;return c.start=function(){a||r()},c.stop=function(){a&&clearTimeout(a),a=n},t.browser.msie&&!l&&function(){var e,n;c.start=function(){e||(n=t.fn[s].src,n=n&&n+i(),e=t('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){n||h(i()),r()}).attr("src",n||"javascript:0").insertAfter("body")[0].contentWindow,o.onpropertychange=function(){try{"title"===event.propertyName&&(e.document.title=o.title)}catch(t){}})},c.stop=d,f=function(){return i(e.location.href)},h=function(n,i){var r=e.document,a=t.fn[s].domain;n!==i&&(r.title=o.title,r.open(),a&&r.write('<script>document.domain="'+a+'"</script>'),r.close(),e.location.hash=n)}}(),c}()}(jQuery,this),/*!
 * jQuery postMessage - v0.5 - 9/11/2009
 * http://benalman.com/projects/jquery-postmessage-plugin/
 * 
 * Copyright (c) 2009 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
// Copyright (c) 2009 "Cowboy" Ben Alman,
function(t){"$:nomunge";var e,n,i,r,s=1,o=this,a=!1,c="postMessage",l="addEventListener",u=o[c];t[c]=function(e,n,i){n&&(e="string"==typeof e?e:t.param(e),i=i||parent,u?i[c](e,n.replace(/([^:]+:\/\/[^\/]+).*/,"$1")):n&&(i.location=n.replace(/#.*$/,"")+"#"+ +new Date+s++ +"&"+e))},t.receiveMessage=r=function(s,c,d){u?(s&&(i&&r(),i=function(e){return"string"==typeof c&&e.origin!==c||t.isFunction(c)&&c(e.origin)===a?a:(s(e),void 0)}),o[l]?o[s?l:"removeEventListener"]("message",i,a):o[s?"attachEvent":"detachEvent"]("onmessage",i)):(e&&clearInterval(e),e=null,s&&(d="number"==typeof c?c:"number"==typeof d?d:100,e=setInterval(function(){var t=document.location.hash,e=/^#?\d+&/;t!==n&&e.test(t)&&(n=t,s({data:t.replace(e,"")}))},d)))}}(jQuery),define("message-receiver",["util"],function(t){function e(e){return/readcube\.com(:\d+)?$/.test(e)?!0:(t.log("disallowed origin:",e),!1)}function n(t){if(!t.origin||e(t.origin)){var n=t.data;"string"==typeof n&&(n=$.deparam(t.data)),n.type&&$(r).trigger(n.type,[n])}}function i(){$.receiveMessage(n),window.popupMessage=function(t){$(r).trigger(t.type,[t])}}var r={};return i(),r}),define("iframe-modal",function(){var t=200,e=400,n=function(n){function i(){return $('<div class="modal-bg"></div>')}function r(){return $('<div class="modal-close '+n+'"><div class="close-btn">&#215</div></div>')}function s(t){return $('<iframe class="modal '+n+'" allowtransparency="true" marginheight="0" marginwidth="0" frameborder="0" src="'+t+'"></iframe>')}function o(){$(document.body).addClass("modal-open")}function a(){$(document.body).removeClass("modal-open")}function c(){$(window).unbind("keydown.iframe-modal")}function l(){c(),$(window).bind("keydown.iframe-modal",function(t){return t.metaKey||t.ctrlKey?void 0:27==t.keyCode&&h()?(u(),!1):void 0})}function u(){return v||!p?!1:(v=!0,c(),m.animate({top:"-100%",bottom:"100%"},e),g.animate({top:"-100%",bottom:"100%"},e,function(){g.remove(),g=null,p.fadeOut(t,function(){p.remove(),a(),p=null,v=!1})}),!0)}function d(n){return v||p?!1:(v=!0,o(),p=i(),m=r(),g=s(n),p.appendTo(document.body),m.appendTo(p),g.appendTo(p),p.click(function(){return u(),!1}),p.fadeIn(t,function(){m.animate({top:"0%",bottom:"0%"},e),g.animate({top:"0%",bottom:"0%"},e,function(){l(),v=!1})}),!0)}function h(){return null!=p}function f(t){h()?u():d(t)}var p=null,g=null,m=null,v=!1;return{show:d,hide:u,isOpen:h,toggle:f}};return n}),/*
 * jQuery Easing v1.3 - http://gsgd.co.uk/sandbox/jquery/easing/
 *
 * Uses the built in easing capabilities added In jQuery 1.1
 * to offer multiple easing options
 *
 * TERMS OF USE - jQuery Easing
 * 
 * Open source under the BSD License. 
 * 
 * Copyright © 2008 George McGinley Smith
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without modification, 
 * are permitted provided that the following conditions are met:
 * 
 * Redistributions of source code must retain the above copyright notice, this list of 
 * conditions and the following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice, this list 
 * of conditions and the following disclaimer in the documentation and/or other materials 
 * provided with the distribution.
 * 
 * Neither the name of the author nor the names of contributors may be used to endorse 
 * or promote products derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY 
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 *  COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 *  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 *  GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED 
 * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED 
 * OF THE POSSIBILITY OF SUCH DAMAGE. 
 *
*/
eval(function(t,e,n,i,r,s){if(r=function(t){return(e>t?"":r(parseInt(t/e)))+((t%=e)>35?String.fromCharCode(t+29):t.toString(36))},!"".replace(/^/,String)){for(;n--;)s[r(n)]=i[n]||r(n);i=[function(t){return s[t]}],r=function(){return"\\w+"},n=1}for(;n--;)i[n]&&(t=t.replace(new RegExp("\\b"+r(n)+"\\b","g"),i[n]));return t}("h.i['1a']=h.i['z'];h.O(h.i,{y:'D',z:9(x,t,b,c,d){6 h.i[h.i.y](x,t,b,c,d)},17:9(x,t,b,c,d){6 c*(t/=d)*t+b},D:9(x,t,b,c,d){6-c*(t/=d)*(t-2)+b},13:9(x,t,b,c,d){e((t/=d/2)<1)6 c/2*t*t+b;6-c/2*((--t)*(t-2)-1)+b},X:9(x,t,b,c,d){6 c*(t/=d)*t*t+b},U:9(x,t,b,c,d){6 c*((t=t/d-1)*t*t+1)+b},R:9(x,t,b,c,d){e((t/=d/2)<1)6 c/2*t*t*t+b;6 c/2*((t-=2)*t*t+2)+b},N:9(x,t,b,c,d){6 c*(t/=d)*t*t*t+b},M:9(x,t,b,c,d){6-c*((t=t/d-1)*t*t*t-1)+b},L:9(x,t,b,c,d){e((t/=d/2)<1)6 c/2*t*t*t*t+b;6-c/2*((t-=2)*t*t*t-2)+b},K:9(x,t,b,c,d){6 c*(t/=d)*t*t*t*t+b},J:9(x,t,b,c,d){6 c*((t=t/d-1)*t*t*t*t+1)+b},I:9(x,t,b,c,d){e((t/=d/2)<1)6 c/2*t*t*t*t*t+b;6 c/2*((t-=2)*t*t*t*t+2)+b},G:9(x,t,b,c,d){6-c*8.C(t/d*(8.g/2))+c+b},15:9(x,t,b,c,d){6 c*8.n(t/d*(8.g/2))+b},12:9(x,t,b,c,d){6-c/2*(8.C(8.g*t/d)-1)+b},Z:9(x,t,b,c,d){6(t==0)?b:c*8.j(2,10*(t/d-1))+b},Y:9(x,t,b,c,d){6(t==d)?b+c:c*(-8.j(2,-10*t/d)+1)+b},W:9(x,t,b,c,d){e(t==0)6 b;e(t==d)6 b+c;e((t/=d/2)<1)6 c/2*8.j(2,10*(t-1))+b;6 c/2*(-8.j(2,-10*--t)+2)+b},V:9(x,t,b,c,d){6-c*(8.o(1-(t/=d)*t)-1)+b},S:9(x,t,b,c,d){6 c*8.o(1-(t=t/d-1)*t)+b},Q:9(x,t,b,c,d){e((t/=d/2)<1)6-c/2*(8.o(1-t*t)-1)+b;6 c/2*(8.o(1-(t-=2)*t)+1)+b},P:9(x,t,b,c,d){f s=1.l;f p=0;f a=c;e(t==0)6 b;e((t/=d)==1)6 b+c;e(!p)p=d*.3;e(a<8.w(c)){a=c;f s=p/4}m f s=p/(2*8.g)*8.r(c/a);6-(a*8.j(2,10*(t-=1))*8.n((t*d-s)*(2*8.g)/p))+b},H:9(x,t,b,c,d){f s=1.l;f p=0;f a=c;e(t==0)6 b;e((t/=d)==1)6 b+c;e(!p)p=d*.3;e(a<8.w(c)){a=c;f s=p/4}m f s=p/(2*8.g)*8.r(c/a);6 a*8.j(2,-10*t)*8.n((t*d-s)*(2*8.g)/p)+c+b},T:9(x,t,b,c,d){f s=1.l;f p=0;f a=c;e(t==0)6 b;e((t/=d/2)==2)6 b+c;e(!p)p=d*(.3*1.5);e(a<8.w(c)){a=c;f s=p/4}m f s=p/(2*8.g)*8.r(c/a);e(t<1)6-.5*(a*8.j(2,10*(t-=1))*8.n((t*d-s)*(2*8.g)/p))+b;6 a*8.j(2,-10*(t-=1))*8.n((t*d-s)*(2*8.g)/p)*.5+c+b},F:9(x,t,b,c,d,s){e(s==u)s=1.l;6 c*(t/=d)*t*((s+1)*t-s)+b},E:9(x,t,b,c,d,s){e(s==u)s=1.l;6 c*((t=t/d-1)*t*((s+1)*t+s)+1)+b},16:9(x,t,b,c,d,s){e(s==u)s=1.l;e((t/=d/2)<1)6 c/2*(t*t*(((s*=(1.B))+1)*t-s))+b;6 c/2*((t-=2)*t*(((s*=(1.B))+1)*t+s)+2)+b},A:9(x,t,b,c,d){6 c-h.i.v(x,d-t,0,c,d)+b},v:9(x,t,b,c,d){e((t/=d)<(1/2.k)){6 c*(7.q*t*t)+b}m e(t<(2/2.k)){6 c*(7.q*(t-=(1.5/2.k))*t+.k)+b}m e(t<(2.5/2.k)){6 c*(7.q*(t-=(2.14/2.k))*t+.11)+b}m{6 c*(7.q*(t-=(2.18/2.k))*t+.19)+b}},1b:9(x,t,b,c,d){e(t<d/2)6 h.i.A(x,t*2,0,c,d)*.5+b;6 h.i.v(x,t*2-d,0,c,d)*.5+c*.5+b}});",62,74,"||||||return||Math|function|||||if|var|PI|jQuery|easing|pow|75|70158|else|sin|sqrt||5625|asin|||undefined|easeOutBounce|abs||def|swing|easeInBounce|525|cos|easeOutQuad|easeOutBack|easeInBack|easeInSine|easeOutElastic|easeInOutQuint|easeOutQuint|easeInQuint|easeInOutQuart|easeOutQuart|easeInQuart|extend|easeInElastic|easeInOutCirc|easeInOutCubic|easeOutCirc|easeInOutElastic|easeOutCubic|easeInCirc|easeInOutExpo|easeInCubic|easeOutExpo|easeInExpo||9375|easeInOutSine|easeInOutQuad|25|easeOutSine|easeInOutBack|easeInQuad|625|984375|jswing|easeInOutBounce".split("|"),0,{})),function(t){var e,n,i,r,s,o,a,c,l,u,d,h,f,p=0,g={},m=[],v=0,b={},y=[],_=null,w=new Image,x=/\.(jpg|gif|xpng|bmp|jpeg)(.*)?$/i,S=/[^\.]\.(swf)\s*$/i,C=1,k=0,T="",I=!1,O=t.extend(t("<div/>")[0],{prop:0}),E=t.browser.msie&&t.browser.version<7&&!window.XMLHttpRequest,N=function(){n.hide(),w.onerror=w.onload=null,_&&_.abort(),e.empty()},L=function(){return!1===g.onError(m,p,g)?(n.hide(),I=!1,void 0):(g.titleShow=!1,g.width="auto",g.height="auto",e.html('<p id="fancybox-error">The requested content cannot be loaded.<br />Please try again later.</p>'),R(),void 0)},A=function(){var i,r,s,a,c,l,u=m[p];if(N(),g=t.extend({},t.fn.fancybox.defaults,"undefined"==typeof t(u).data("fancybox")?g:t(u).data("fancybox")),l=g.onStart(m,p,g),l===!1)return I=!1,void 0;if("object"==typeof l&&(g=t.extend(g,l)),s=g.title||(u.nodeName?t(u).attr("title"):u.title)||"",u.nodeName&&!g.orig&&(g.orig=t(u).children("img:first").length?t(u).children("img:first"):t(u)),""===s&&g.orig&&g.titleFromAlt&&(s=g.orig.attr("alt")),i=g.href||(u.nodeName?t(u).attr("href"):u.href)||null,(/^(?:javascript)/i.test(i)||"#"==i)&&(i=null),g.type?(r=g.type,i||(i=g.content)):g.content?r="html":i&&(r=i.match(x)?"image":i.match(S)?"swf":t(u).hasClass("iframe")?"iframe":0===i.indexOf("#")?"inline":"ajax"),!r)return L(),void 0;switch("inline"==r&&(u=i.substr(i.indexOf("#")),r=t(u).length>0?"inline":"ajax"),g.type=r,g.href=i,g.title=s,g.autoDimensions&&("html"==g.type||"inline"==g.type||"ajax"==g.type?(g.width="auto",g.height="auto"):g.autoDimensions=!1),g.modal&&(g.overlayShow=!0,g.hideOnOverlayClick=!1,g.hideOnContentClick=!1,g.enableEscapeButton=!1,g.showCloseButton=!1),g.padding=parseInt(g.padding,10),g.margin=parseInt(g.margin,10),e.css("padding",g.padding+g.margin),t(".fancybox-inline-tmp").unbind("fancybox-cancel").bind("fancybox-change",function(){t(this).replaceWith(o.children())}),r){case"html":e.html(g.content),R();break;case"inline":if(t(u).parent().is("#fancybox-content")===!0)return I=!1,void 0;t('<div class="fancybox-inline-tmp" />').hide().insertBefore(t(u)).bind("fancybox-cleanup",function(){t(this).replaceWith(o.children())}).bind("fancybox-cancel",function(){t(this).replaceWith(e.children())}),t(u).appendTo(e),R();break;case"image":I=!1,t.fancybox.showActivity(),w=new Image,w.onerror=function(){L()},w.onload=function(){I=!0,w.onerror=w.onload=null,$()},w.src=i;break;case"swf":g.scrolling="no",a='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+g.width+'" height="'+g.height+'"><param name="movie" value="'+i+'"></param>',c="",t.each(g.swf,function(t,e){a+='<param name="'+t+'" value="'+e+'"></param>',c+=" "+t+'="'+e+'"'}),a+='<embed src="'+i+'" type="application/x-shockwave-flash" width="'+g.width+'" height="'+g.height+'"'+c+"></embed></object>",e.html(a),R();break;case"ajax":I=!1,t.fancybox.showActivity(),g.ajax.win=g.ajax.success,_=t.ajax(t.extend({},g.ajax,{url:i,data:g.ajax.data||{},error:function(t){t.status>0&&L()},success:function(t,r,s){var o="object"==typeof s?s:_;if(200==o.status){if("function"==typeof g.ajax.win){if(l=g.ajax.win(i,t,r,s),l===!1)return n.hide(),void 0;("string"==typeof l||"object"==typeof l)&&(t=l)}e.html(t),R()}}}));break;case"iframe":D()}},R=function(){var n=g.width,i=g.height;n=n.toString().indexOf("%")>-1?parseInt((t(window).width()-2*g.margin)*parseFloat(n)/100,10)+"px":"auto"==n?"auto":n+"px",i=i.toString().indexOf("%")>-1?parseInt((t(window).height()-2*g.margin)*parseFloat(i)/100,10)+"px":"auto"==i?"auto":i+"px",e.wrapInner('<div style="width:'+n+";height:"+i+";overflow: "+("auto"==g.scrolling?"auto":"yes"==g.scrolling?"scroll":"hidden")+';position:relative;"></div>'),g.width=e.width(),g.height=e.height(),D()},$=function(){g.width=w.width,g.height=w.height,t("<img />").attr({id:"fancybox-img",src:w.src,alt:g.title}).appendTo(e),D()},D=function(){var s,d;return n.hide(),r.is(":visible")&&!1===b.onCleanup(y,v,b)?(t.event.trigger("fancybox-cancel"),I=!1,void 0):(I=!0,t(o.add(i)).unbind(),t(window).unbind("resize.fb scroll.fb"),t(document).unbind("keydown.fb"),r.is(":visible")&&"outside"!==b.titlePosition&&r.css("height",r.height()),y=m,v=p,b=g,b.overlayShow?(i.css({"background-color":b.overlayColor,opacity:b.overlayOpacity,cursor:b.hideOnOverlayClick?"pointer":"auto",height:t(document).height()}),i.is(":visible")||(E&&t("select:not(#fancybox-tmp select)").filter(function(){return"hidden"!==this.style.visibility}).css({visibility:"hidden"}).one("fancybox-cleanup",function(){this.style.visibility="inherit"}),i.show())):i.hide(),f=Y(),M(),r.is(":visible")?(t(a.add(l).add(u)).hide(),s=r.position(),h={top:s.top,left:s.left,width:r.width(),height:r.height()},d=h.width==f.width&&h.height==f.height,o.fadeTo(b.changeFade,.3,function(){var n=function(){o.html(e.contents()).fadeTo(b.changeFade,1,F)};t.event.trigger("fancybox-change"),o.empty().removeAttr("filter").css({"border-width":b.padding,width:f.width-2*b.padding,height:g.autoDimensions?"auto":f.height-k-2*b.padding}),d?n():(O.prop=0,t(O).animate({prop:1},{duration:b.changeSpeed,easing:b.easingChange,step:B,complete:n}))}),void 0):(r.removeAttr("style"),o.css("border-width",b.padding),"elastic"==b.transitionIn?(h=W(),o.html(e.contents()),r.show(),b.opacity&&(f.opacity=0),O.prop=0,t(O).animate({prop:1},{duration:b.speedIn,easing:b.easingIn,step:B,complete:F}),void 0):("inside"==b.titlePosition&&k>0&&c.show(),o.css({width:f.width-2*b.padding,height:g.autoDimensions?"auto":f.height-k-2*b.padding}).html(e.contents()),r.css(f).fadeIn("none"==b.transitionIn?0:b.speedIn,F),void 0)))},P=function(t){return t&&t.length?"float"==b.titlePosition?'<table id="fancybox-title-float-wrap" cellpadding="0" cellspacing="0"><tr><td id="fancybox-title-float-left"></td><td id="fancybox-title-float-main">'+t+'</td><td id="fancybox-title-float-right"></td></tr></table>':'<div id="fancybox-title-'+b.titlePosition+'">'+t+"</div>":!1},M=function(){if(T=b.title||"",k=0,c.empty().removeAttr("style").removeClass(),b.titleShow===!1)return c.hide(),void 0;if(T=t.isFunction(b.titleFormat)?b.titleFormat(T,y,v,b):P(T),!T||""===T)return c.hide(),void 0;switch(c.addClass("fancybox-title-"+b.titlePosition).html(T).appendTo("body").show(),b.titlePosition){case"inside":c.css({width:f.width-2*b.padding,marginLeft:b.padding,marginRight:b.padding}),k=c.outerHeight(!0),c.appendTo(s),f.height+=k;break;case"over":c.css({marginLeft:b.padding,width:f.width-2*b.padding,bottom:b.padding}).appendTo(s);break;case"float":c.css("left",-1*parseInt((c.width()-f.width-40)/2,10)).appendTo(r);break;default:c.css({width:f.width-2*b.padding,paddingLeft:b.padding,paddingRight:b.padding}).appendTo(r)}c.hide()},j=function(){return(b.enableEscapeButton||b.enableKeyboardNav)&&t(document).bind("keydown.fb",function(e){27==e.keyCode&&b.enableEscapeButton?(e.preventDefault(),t.fancybox.close()):37!=e.keyCode&&39!=e.keyCode||!b.enableKeyboardNav||"INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName||"SELECT"===e.target.tagName||(e.preventDefault(),t.fancybox[37==e.keyCode?"prev":"next"]())}),b.showNavArrows?((b.cyclic&&y.length>1||0!==v)&&l.show(),(b.cyclic&&y.length>1||v!=y.length-1)&&u.show(),void 0):(l.hide(),u.hide(),void 0)},F=function(){t.support.opacity||(o.get(0).style.removeAttribute("filter"),r.get(0).style.removeAttribute("filter")),g.autoDimensions&&o.css("height","auto"),r.css("height","auto"),T&&T.length&&c.show(),b.showCloseButton&&a.show(),j(),b.hideOnContentClick&&o.bind("click",t.fancybox.close),b.hideOnOverlayClick&&i.bind("click",t.fancybox.close),t(window).bind("resize.fb",t.fancybox.resize),b.centerOnScroll&&t(window).bind("scroll.fb",t.fancybox.center),"iframe"==b.type&&t('<iframe id="fancybox-frame" name="fancybox-frame'+(new Date).getTime()+'" frameborder="0" hspace="0" '+(t.browser.msie?'allowtransparency="true""':"")+' scrolling="'+g.scrolling+'" src="'+b.href+'"></iframe>').appendTo(o),r.show(),I=!1,t.fancybox.center(),b.onComplete(y,v,b),z()},z=function(){var t,e;y.length-1>v&&(t=y[v+1].href,"undefined"!=typeof t&&t.match(x)&&(e=new Image,e.src=t)),v>0&&(t=y[v-1].href,"undefined"!=typeof t&&t.match(x)&&(e=new Image,e.src=t))},B=function(t){var e={width:parseInt(h.width+(f.width-h.width)*t,10),height:parseInt(h.height+(f.height-h.height)*t,10),top:parseInt(h.top+(f.top-h.top)*t,10),left:parseInt(h.left+(f.left-h.left)*t,10)};"undefined"!=typeof f.opacity&&(e.opacity=.5>t?.5:t),r.css(e),o.css({width:e.width-2*b.padding,height:e.height-k*t-2*b.padding})},U=function(){return[t(window).width()-2*b.margin,t(window).height()-2*b.margin,t(document).scrollLeft()+b.margin,t(document).scrollTop()+b.margin]},Y=function(){var t,e=U(),n={},i=b.autoScale,r=2*b.padding;return n.width=b.width.toString().indexOf("%")>-1?parseInt(e[0]*parseFloat(b.width)/100,10):b.width+r,n.height=b.height.toString().indexOf("%")>-1?parseInt(e[1]*parseFloat(b.height)/100,10):b.height+r,i&&(n.width>e[0]||n.height>e[1])&&("image"==g.type||"swf"==g.type?(t=b.width/b.height,n.width>e[0]&&(n.width=e[0],n.height=parseInt((n.width-r)/t+r,10)),n.height>e[1]&&(n.height=e[1],n.width=parseInt((n.height-r)*t+r,10))):(n.width=Math.min(n.width,e[0]),n.height=Math.min(n.height,e[1]))),n.top=parseInt(Math.max(e[3]-20,e[3]+.5*(e[1]-n.height-40)),10),n.left=parseInt(Math.max(e[2]-20,e[2]+.5*(e[0]-n.width-40)),10),n},H=function(t){var e=t.offset();return e.top+=parseInt(t.css("paddingTop"),10)||0,e.left+=parseInt(t.css("paddingLeft"),10)||0,e.top+=parseInt(t.css("border-top-width"),10)||0,e.left+=parseInt(t.css("border-left-width"),10)||0,e.width=t.width(),e.height=t.height(),e},W=function(){var e,n,i=g.orig?t(g.orig):!1,r={};return i&&i.length?(e=H(i),r={width:e.width+2*b.padding,height:e.height+2*b.padding,top:e.top-b.padding-20,left:e.left-b.padding-20}):(n=U(),r={width:2*b.padding,height:2*b.padding,top:parseInt(n[3]+.5*n[1],10),left:parseInt(n[2]+.5*n[0],10)}),r},q=function(){return n.is(":visible")?(t("div",n).css("top",-40*C+"px"),C=(C+1)%12,void 0):(clearInterval(d),void 0)};t.fn.fancybox=function(e){return t(this).length?(t(this).data("fancybox",t.extend({},e,t.metadata?t(this).metadata():{})).unbind("click.fb").bind("click.fb",function(e){if(e.preventDefault(),!I){I=!0,t(this).blur(),m=[],p=0;var n=t(this).attr("rel")||"";n&&""!=n&&"nofollow"!==n?(m=t("a[rel="+n+"], area[rel="+n+"]"),p=m.index(this)):m.push(this),A()}}),this):this},t.fancybox=function(e){var n;if(!I){if(I=!0,n="undefined"!=typeof arguments[1]?arguments[1]:{},m=[],p=parseInt(n.index,10)||0,t.isArray(e)){for(var i=0,r=e.length;r>i;i++)"object"==typeof e[i]?t(e[i]).data("fancybox",t.extend({},n,e[i])):e[i]=t({}).data("fancybox",t.extend({content:e[i]},n));m=jQuery.merge(m,e)}else"object"==typeof e?t(e).data("fancybox",t.extend({},n,e)):e=t({}).data("fancybox",t.extend({content:e},n)),m.push(e);(p>m.length||0>p)&&(p=0),A()}},t.fancybox.showActivity=function(){clearInterval(d),n.show(),d=setInterval(q,66)},t.fancybox.hideActivity=function(){n.hide()},t.fancybox.next=function(){return t.fancybox.pos(v+1)},t.fancybox.prev=function(){return t.fancybox.pos(v-1)},t.fancybox.pos=function(t){I||(t=parseInt(t),m=y,t>-1&&t<y.length?(p=t,A()):b.cyclic&&y.length>1&&(p=t>=y.length?0:y.length-1,A()))},t.fancybox.cancel=function(){I||(I=!0,t.event.trigger("fancybox-cancel"),N(),g.onCancel(m,p,g),I=!1)},t.fancybox.close=function(){function e(){i.fadeOut("fast"),c.empty().hide(),r.hide(),t.event.trigger("fancybox-cleanup"),o.empty(),b.onClosed(y,v,b),y=g=[],v=p=0,b=g={},I=!1}if(!I&&!r.is(":hidden")){if(I=!0,b&&!1===b.onCleanup(y,v,b))return I=!1,void 0;if(N(),t(a.add(l).add(u)).hide(),t(o.add(i)).unbind(),t(window).unbind("resize.fb scroll.fb"),t(document).unbind("keydown.fb"),o.find("iframe").attr("src",E&&/^https/i.test(window.location.href||"")?"javascript:void(false)":"about:blank"),"inside"!==b.titlePosition&&c.empty(),r.stop(),"elastic"==b.transitionOut){h=W();var n=r.position();f={top:n.top,left:n.left,width:r.width(),height:r.height()},b.opacity&&(f.opacity=1),c.empty().hide(),O.prop=1,t(O).animate({prop:0},{duration:b.speedOut,easing:b.easingOut,step:B,complete:e})}else r.fadeOut("none"==b.transitionOut?0:b.speedOut,e)}},t.fancybox.resize=function(){i.is(":visible")&&i.css("height",t(document).height()),t.fancybox.center(!0)},t.fancybox.center=function(){var t,e;I||(e=arguments[0]===!0?1:0,t=U(),(e||!(r.width()>t[0]||r.height()>t[1]))&&r.stop().animate({top:parseInt(Math.max(t[3]-20,t[3]+.5*(t[1]-o.height()-40)-b.padding)),left:parseInt(Math.max(t[2]-20,t[2]+.5*(t[0]-o.width()-40)-b.padding))},"number"==typeof arguments[0]?arguments[0]:200))},t.fancybox.init=function(){t("#fancybox-wrap").length||(t("body").append(e=t('<div id="fancybox-tmp"></div>'),n=t('<div id="fancybox-loading"><div></div></div>'),i=t('<div id="fancybox-overlay"></div>'),r=t('<div id="fancybox-wrap"></div>')),s=t('<div id="fancybox-outer"></div>').append('<div class="fancybox-bg" id="fancybox-bg-n"></div><div class="fancybox-bg" id="fancybox-bg-ne"></div><div class="fancybox-bg" id="fancybox-bg-e"></div><div class="fancybox-bg" id="fancybox-bg-se"></div><div class="fancybox-bg" id="fancybox-bg-s"></div><div class="fancybox-bg" id="fancybox-bg-sw"></div><div class="fancybox-bg" id="fancybox-bg-w"></div><div class="fancybox-bg" id="fancybox-bg-nw"></div>').appendTo(r),s.append(o=t('<div id="fancybox-content"></div>'),a=t('<a id="fancybox-close"></a>'),c=t('<div id="fancybox-title"></div>'),l=t('<a href="javascript:;" id="fancybox-left"><span class="fancy-ico" id="fancybox-left-ico"></span></a>'),u=t('<a href="javascript:;" id="fancybox-right"><span class="fancy-ico" id="fancybox-right-ico"></span></a>')),a.click(t.fancybox.close),n.click(t.fancybox.cancel),l.click(function(e){e.preventDefault(),t.fancybox.prev()}),u.click(function(e){e.preventDefault(),t.fancybox.next()}),t.fn.mousewheel&&r.bind("mousewheel.fb",function(e,n){I?e.preventDefault():(0==t(e.target).get(0).clientHeight||t(e.target).get(0).scrollHeight===t(e.target).get(0).clientHeight)&&(e.preventDefault(),t.fancybox[n>0?"prev":"next"]())}),t.support.opacity||r.addClass("fancybox-ie"),E&&(n.addClass("fancybox-ie6"),r.addClass("fancybox-ie6"),t('<iframe id="fancybox-hide-sel-frame" src="'+(/^https/i.test(window.location.href||"")?"javascript:void(false)":"about:blank")+'" scrolling="no" border="0" frameborder="0" tabindex="-1"></iframe>').prependTo(s)))},t.fn.fancybox.defaults={padding:10,margin:40,opacity:!1,modal:!1,cyclic:!1,scrolling:"auto",width:560,height:340,autoScale:!0,autoDimensions:!0,centerOnScroll:!1,ajax:{},swf:{wmode:"transparent"},hideOnOverlayClick:!0,hideOnContentClick:!1,overlayShow:!0,overlayOpacity:.7,overlayColor:"#777",titleShow:!0,titlePosition:"float",titleFormat:null,titleFromAlt:!1,transitionIn:"fade",transitionOut:"fade",speedIn:300,speedOut:300,changeSpeed:300,changeFade:"fast",easingIn:"swing",easingOut:"swing",showCloseButton:!0,showNavArrows:!0,enableEscapeButton:!0,enableKeyboardNav:!0,onStart:function(){},onCancel:function(){},onComplete:function(){},onCleanup:function(){},onClosed:function(){},onError:function(){}},t(document).ready(function(){t.fancybox.init()})}(jQuery),define("iframe-modal-fbox",["util"],function(t){var e=function(e){function n(){return o?($.fancybox.close(),o=!1,!0):!1}function i(n){return o?!1:($.fancybox(t.merge(e,{onClosed:function(){o=!1},href:n})),o=!0,!0)}function r(){return o}function s(t){r()?n():i(t)}var o=!1;return e=t.merge({type:"iframe",width:540,padding:0,margin:0},e),{show:i,hide:n,isOpen:r,toggle:s}};return e}),define("browser-detect",function(){function t(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)}function e(e,n){t(e,n)||(e.className=e.className?[e.className,n].join(" "):n)}var n={init:function(){this.browser=this.searchString(this.dataBrowser),this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion),this.OS=this.searchString(this.dataOS),this.browser&&e(document.documentElement,this.browser.toLowerCase()),this.OS&&e(document.documentElement,this.OS.toLowerCase()+"-os")},searchString:function(t){for(var e=0;e<t.length;e++){var n=t[e].string,i=t[e].prop;if(this.versionSearchString=t[e].versionSearch||t[e].identity,n){if(-1!=n.indexOf(t[e].subString))return t[e].identity}else if(i)return t[e].identity}return null},searchVersion:function(t){var e=t.indexOf(this.versionSearchString);return-1==e?null:parseFloat(t.substring(e+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Trident",identity:"Explorer",versionSearch:"rv"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};return n.init(),n}),define("user-modal",["util","endpoint","message-receiver","iframe-modal","iframe-modal-fbox","browser-detect"],function(t,e,n,i,r,s){var o=function(){function o(){return"Explorer"==s.browser&&s.version<9}function a(n,i){return n&&(p=n),e(p,t.merge(m,i))}function c(t,e){return g.show(a(t,e))}function l(){return g.hide()}function u(){return g.isOpen()}function d(t,e){return g.toggle(a(t,e))}function h(){$(n).bind("login:success register:success",function(t,e){$(f).trigger("success",[e])})}var f={},p="login",g=o()?r({height:560}):i("login"),m={parent_url:window.location.toString(),embed:"1"};return h(),f.show=c,f.hide=l,f.isOpen=u,f.toggle=d,f};return o}),define("user",["util","endpoint","user-modal"],function(t,e,n){function i(){return t.clone(f)}function r(t){var e=f;f=t,!s(e)&&s(t)&&$(d).trigger("login",[i()]),$(d).trigger("change",[i()])}function s(t){return t&&t.id}function o(){return s(f)}function a(t){o()&&t(),$(d).on("login",t)}function c(t,e){h.isOpen()||($(d).off("login.single"),$(d).one("login.single",function(t,n){e&&e(n)}),h.show("login",t))}function l(t,e){h.isOpen()||($(d).off("login.single"),$(d).one("login.single",function(t,n){e&&e(n)}),h.show("register",t))}function u(){$(h).on("success",function(t,e){h.hide(),r(e.user)})}var d={},h=n(),f=t.clone(window.readcube.user);return u(),d.get=i,d.set=r,d.showLogin=c,d.showRegister=l,d.signedIn=o,d.onSignIn=a,window.user_api=d,d}),define("article",["util","endpoint"],function(t,e){function n(n){if(!m.meta){var i=t.timer.tic();$.ajax({url:e("article_data",t.merge({doi:m.doi,hash:m.hash},m.options)),dataType:"json",success:function(e){t.log("get_article_data:",t.timer.toc(i)+"ms",e),n(e)}})}}function i(n,i){n=t.merge({doi:m.doi,hash:m.hash},n),n=t.merge(window.readcube.access_options,n),n=t.merge(m.options,n);var r=t.timer.tic();$.ajax({type:"POST",url:e("article_pages"),dataType:"json",data:n,success:function(e){t.log("get_pages:",t.timer.toc(r)+"ms",e),i(e)}})}function r(n,i){n=t.merge({doi:m.doi,hash:m.hash},n),n=t.merge(window.readcube.access_options,n),n=t.merge(m.options,n);var r=t.timer.tic();$.ajax({type:"POST",url:e("generate_shared_access"),dataType:"json",data:n,success:function(e){t.log("get_pages:",t.timer.toc(r)+"ms",e),i(e)}})}function s(){return t.clone(m)}function o(e){m=t.merge(m,e),$(g).trigger("data",[s()])}function a(e){m=t.merge(m,e),$(g).trigger("access-check",[s()]),e.access&&$(g).trigger("access",[s()])}function c(t){i(t,a)}function l(){return m.access}function u(t){m.meta?t(m):$(g).one("data",function(e,n){t(n)})}function d(t){m.access?t(m):$(g).one("access",function(e,n){t(n)})}function h(e){t.definedKey("access",m)?e(m):$(g).one("access-check",function(t,n){e(n)})}function f(e){$(g).on("access-check",function(t,n){e(n)}),t.definedKey("access",m)&&e(m)}function p(){m.meta||n(o)}var g={},m=t.clone(window.readcube.article);return p(),g.get=s,g.onData=u,g.checkAccessWith=c,g.onAccess=d,g.onceAccessChecked=h,g.onAccessCheck=f,g.hasAccess=l,g.generateSharedAccess=r,window.article=g,g}),define("access-control",["util","endpoint","user","article"],function(t,e,n,i){function r(t){if(window.readcube.publisher_proxy){var e=parseUri(t).host,n=parseUri(window.readcube.publisher_proxy).host;return t.replace(e,n)}return t}function s(){var t=e(i.get().meta.publisher+"_jsonp_access");return t?r(t):null}function o(){var e=i.get().meta;return"nature"==e.publisher?t.addParams(r(e.url),{parent_url:location.toString(),pdf_url:e.pdf_url}):null}function a(){$(window).on("message",function(e){for(;e.originalEvent;)e=e.originalEvent;return"jsonp_access_result"==e.data.type?(m(e.data.result),void 0):"pdf_size"==e.data.type?(t.log("pdf size:",e.data.size),d(),h(e.data.size),void 0):"pdf_size_fail"==e.data.type?(d(),t.log("get pdf size failed with status:",e.data.status),void 0):void 0})}function c(){i.onData(function(){s()?f():e("parent")?l():u(),v()}),$(n).on("login",b)}function l(){window.parent.postMessage({type:"get_pdf_size",pdf_url:i.get().meta.pdf_url},e("parent"))}function u(){o()&&(d(),$("<iframe></iframe>").attr("src",o()).addClass("access-check").appendTo(document.body))}function d(){$("iframe.access-check").remove()}function h(t){I.size=parseInt(t)||1337,x()}function f(){e("parent")?p():g()}function p(){window.parent.postMessage({type:"jsonp_access_check"},e("parent"))}function g(){var e=t.timer.tic(),n=i.get(),r={resource:n.meta.original_doi};n.options&&n.options.cochrane&&(r.pdfType=n.options.cochrane),$.ajax({url:s(),dataType:"jsonp",data:r,success:function(n){t.log("jsonp access response:",t.timer.toc(e)+"ms",n),m(n)}})}function m(t){I.jsonp_response=t,x()}function v(){setTimeout(function(){O||x()},E)}function b(){x(),$(i).one("access-check",function(){N[n.get().id]=!0,$(k).trigger("login-access-check")})}function y(t){N[n.get().id]?t():$(k).one("login-access-check",t)}function _(){i.onAccess(function(t){if(t.purchase&&t.purchase.rental_expires){var e=1e3*t.purchase.rental_expires,n=e-Date.now();n>=0&&w(n),$(k).trigger("rental-expiry",[e])}})}function w(t){setTimeout(function(){location.reload(!0)},t)}function x(){O=!0,i.checkAccessWith(I)}function S(t){O=!0,i.generateSharedAccess(I,t)}function C(){a(),c(),_(),w(T)}var k={},T=864e5,I={},O=!1,E=5e3,N={};return C(),k.checkAccess=x,k.generateSharedAccess=S,k.onLoginCheck=y,k}),define("page",["util","browser-detect"],function(t,e){var n=2e3,i=1e3,r=function(t){this._dimensions=t.dimensions,this._container=t.container,this._text=t.text,this._urls=t.urls,this._init()};return r.prototype={_init:function(){this._page=this._createPlaceholder(),this._content=null,this._loading=!1,this._loaded=!1,this._jqxhr=null,this._scale=1,this._timeouts={},this._scalePage(),this._page.appendTo(this._container)},_createPlaceholder:function(){return $('<div class="pf w0 h0"></div>')},_retry:function(t){this._timeouts[t]&&clearTimeout(this._timeouts[t]),this._timeouts[t]=setTimeout($.proxy(this[t],this),i)},_cancelAllRetrys:function(){for(var t in this._timeouts)clearTimeout(this._timeouts[t])},_setThumb:function(){this._page.find("img.bt").remove(),$('<img class="bt" alt="" src="'+this._urls.thumb+'">').one("error",$.proxy(function(){t.log("* thumb load error"),this._retry("_setThumb")},this)).on("dragstart",!1).prependTo(this._page)},_setImageBg:function(){this._content.find("img.bf").remove(),$('<img class="bf" alt="" src="'+this._urls.bg+'">').one("error",$.proxy(function(){t.log("* background load error"),this._retry("_setImageBg")},this)).on("dragstart",!1).prependTo(this._content)},_setObjectBg:function(){this._content.find("object.bf").remove(),$('<object class="bf" type="image/svg+xml" data="'+this._urls.bg+'"></object>').on("dragstart",!1).prependTo(this._content)},_setBackground:function(){this._page.find("img.bt").remove(),"Safari"==e.browser?this._setObjectBg():this._setImageBg()},_scalePage:function(){if(this._page.css({width:this._dimensions.width*this._scale,height:this._dimensions.height*this._scale,margin:this._dimensions.margin*this._scale+"px auto"}),this._content){var t=this._scale/this._dimensions.zoom;this._content.css("transform","scale("+t.toFixed(5)+")")}},_createPage:function(t){this._content=$(t).find(".pc"),this._content.find("a").attr("target","_blank"),this._content.prepend('<div class="bf"></div>'),this._content.appendTo(this._page),this._scalePage(),this._setBackground()},_handleLoadSuccess:function(){this._jqxhr=null,this._loaded=!0,this._loading=!1,$(this).trigger("loaded")},_loadPage:function(){this._text?(this._createPage(this._text),this._handleLoadSuccess()):this._urls.text?this._jqxhr=$.ajax({url:this._urls.text,timeout:n,dataType:"text",success:$.proxy(function(t){this._loading&&(this._createPage(t),this._handleLoadSuccess())},this),error:$.proxy(function(){this._loading&&(t.log("* text load error"),this._retry("_loadPage"))},this)}):this._urls.thumb&&(this._setThumb(),this._handleLoadSuccess())},setUrls:function(t){!this._urls.text&&t.text&&(this._page.find("img").off("error"),this._jqxhr&&this._jqxhr.abort(),this._cancelAllRetrys(),this._loading=!1,this._loaded=!1,this._jqxhr=null,this._urls=t)},hasText:function(){return null!=this._content},hasAccess:function(){return!!this._urls.text},load:function(t){this.onLoaded(t),this._loaded||this._loading||(this._loading=!0,this._loadPage())},scale:function(t){this._scale!=t&&(this._scale=t,this._scalePage())},isVisible:function(){var t=this._container.offset().top,e=t+this._container.height(),n=this._page.offset().top,i=n+this._page.height();return i>=t&&e>=n},getElem:function(){return this._page},getWidth:function(){return this._dimensions.width},getHeight:function(){return this._dimensions.height},getScale:function(){return this._scale},onLoaded:function(t){t=t||function(){},this._loaded&&t(),$(this).on("loaded",t)}},r}),define("loader",function(){function t(t){function e(){1==++h&&$(u).trigger("loading-start")}function n(t,e){e&&!f[t]&&(++d,f[t]=!0,$(u).trigger("page-loaded",[t])),0==--h&&$(u).trigger("loading-stop")}function i(i,r,s){e(i),t[i].load(function(){n(i,!0),r&&r()},function(){n(i,!1),s&&s()})}function r(e,n){for(var r=0,s=!1,o=0;o<t.length;o++)i(o,function(){++r==t.length&&e&&e()},function(){s||(s=!0,n&&n())})}function s(){for(var e=0;e<t.length;e++)t[e].isVisible()&&i(e)}function o(e,n){p=!1,n=n||l;for(var r=Math.min(t.length,1+2*n),s=[e],o=0,a=1;s.length<r;a++){var c=e-a,u=e+a;c>=0&&s.push(c),u<t.length&&s.push(u)}!function(){if(!(p||o>=r)){var t=arguments.callee,e=s[o];i(e,function(){++o,t()})}}()}function a(){p=!0}function c(){return d}var l=2,u={},d=0,h=0,f={},p=!1;return u.loadAll=r,u.loadVisible=s,u.preloadPages=o,u.stopPreloading=a,u.getLoadedCnt=c,u}return t}),define("viewer-control",["util","page","loader"],function(t,e,n){function i(i){function r(t,e){(M||"initialized"==t)&&(e?$(N).trigger(t,[e]):$(N).trigger(t))}function s(){A=n(L),$(A).on({"page-loaded":function(t,e){A.getLoadedCnt()>=L.length&&R.off("scroll.loader"),r("page-loaded",e+1)},"loading-start":function(){r("loading-start")},"loading-stop":function(){r("loading-stop")}})}function o(t){return Math.min(L.length,Math.max(0,t))}function a(){var t=parseInt(R.css("paddingLeft")),e=parseInt(R.css("paddingRight"));return R[0].clientWidth-t-e}function c(){return D.is(":visible")?D.outerHeight(!0):0}function l(){return R.height()}function u(){var t,e=0,n=(R.scrollTop()-c())/B;for(t=0;t<L.length&&(e+=P[t].height+Y,!(e>n));t++);var i=(e-n)/(P[t].height+Y);return t+(1-i)}function d(t){var e,n=t>0?Math.floor(t):Math.ceil(t),i=t-n,r=0;for(e=0;n>e;e++)r+=P[e].height+Y;return r+=i*(P[e].height+Y),Math.round(r*B)+c()}function h(t,e){var n=d(t);e&&(n+=Y/2),R.scrollTop(n),A.loadVisible(),r("scroll")}function f(){return o(u())}function p(){var t=Math.floor(f());U!=t&&(U=t,r("page-changed",t+1))}function g(t){P=[];for(var e=0;e<t.length;e++){var n=t.size||t.sizes[e];P.push({zoom:t.zoom,height:n[1],width:n[0],margin:Y})}}function m(){A.preloadPages(Math.floor(f()))}function v(){for(var t=0;t<L.length;t++){var e=L[t],n=e.getElem();e.isVisible()?n.addClass("open"):n.removeClass("open")}}function b(){R.off("scroll.update"),R.on("scroll.update",t.throttle(function(){p(),_(),r("scroll")},100));var e=null,n=null;R.off("scroll.loader"),R.on("scroll.loader",function(){clearTimeout(e),clearTimeout(n),A.stopPreloading(),e=setTimeout(function(){A.loadVisible()},500),n=setTimeout(function(){m()},1e3)});var i=null;R.off("scroll.render"),R.on("scroll.render",function(){clearTimeout(i),i=setTimeout(v,100)})}function y(t){return S(t/P[0].width)}function _(){R[0].style.display="block"}function w(t){clearInterval(F),j=P[U],F=setInterval(t,500),t()}function x(){clearInterval(F),F=null}function S(t){var e=u();B=t;for(var n=0;n<L.length;n++)L[n].scale(t);h(e),_(),r("scale")}function C(t){S(B*t)}function k(){w(function(){S(a()/j.width)})}function T(){w(function(){var t=a()/j.width,e=l()/(j.height+Y);S(Math.min(t,e))})}function I(t){M?t():$(N).on("initialized",t)}function O(t){$.ajax({url:t.text[0],dataType:"text",success:function(n){$(function(){var o=$(n).data("pages"),a=o.length;
R=$(i),D=R.find("#advrtsmnt"),g(o),s();for(var c=0;a>c;c++){var l={container:R,dimensions:P[c],urls:{thumb:t.thumb[c],text:t.text[c],bg:t.background[c]}};0==c&&(l.text=n),L.push(new e(l))}"fit-width"==z?k():"fit-page"==z?T():y(Math.min(z,R.width())),R.scrollTop(0),v(),b(),m(),M=!0,r("initialized")})}})}function E(t){I(function(){for(var e=0;e<L.length;e++)L[e].setUrls({thumb:t.thumb[e],text:t.text[e],bg:t.background[e]});s(),v(),b(),m()})}var N={},L=[],A=null,R=null,D=null,P=null,M=!1,j=null,F=null,z=900,B=1,U=0,Y=8;return N.init=function(t){return O(t)},N.onInit=function(t){return I(t)},N.setData=function(t){return E(t)},N.fitPage=function(){return M?T():void 0},N.fitWidth=function(){return M?k():void 0},N.getElem=function(){return M?R:void 0},N.getPage=function(){return M?U+1:void 0},N.getPageObj=function(t){return M?L[t-1]:void 0},N.eachPage=function(t){if(M)for(var e=0;e<L.length;e++)if(!1===t(e+1,L[e]))return},N.eachVisiblePage=function(t){if(M)for(var e=U;e<L.length;e++){if(!L[e].isVisible())return;if(!1===t(e+1,L[e]))return}},N.gotoPage=function(t){return M&&(t=parseFloat(t),!isNaN(t))?h(o(t-1),!0):void 0},N.loadAll=function(t,e){M&&A.loadAll(t,e)},N.numPages=function(){return M?L.length:void 0},N.scaleBy=function(t){return M?(x(),C(t)):void 0},N.scaleTo=function(t){return M?(x(),S(t)):void 0},N}return i}),define("session",["endpoint"],function(t){function e(){t("parent")?(n(),$(i).one("new",function(){r=!0})):r=!0}function n(){$(window).on("message",function(t){for(;t.originalEvent;)t=t.originalEvent;"new_session"==t.data.type&&$(i).trigger("new")})}var i={},r=!1;return e(),i.onceStarted=function(t){r?t():$(i).one("new",t)},i.onStart=function(t){r&&t(),$(i).one("new",t)},i}),define("readcube-analytics",["endpoint","util"],function(t,e){function n(t){s(),i(),u(t)}function i(){y=e.timer.tic(),clearInterval(_),_=setInterval(r,w)}function r(){var t=e.timer.toc(y)/1e3;l({duration:Math.round(t)}),e.log("session duration:",Math.round(t)+"s"),y=e.timer.tic()}function s(){clearInterval(v),v=setInterval(o,b),p={},sessionUpdateBatch={},m={}}function o(){if(f){var t={};t=e.merge(t,g),$.isEmptyObject(m)||(t=e.merge(t,{counters:m})),$.isEmptyObject(t)||d(t),p=e.merge(p,g),g={},m={}}}function a(t){if(t.sidepanel)c(t,"sidepanel");else if(t.share)c(t,"share");else if(t.print)c(t,"print");else for(var e in t)t[e]!==p[e]&&(g[e]=t[e])}function c(t,e){for(var n in t[e]){var i=p[e]&&p[e][n];t[e][n]!==i&&(g[e]=g[e]||{},g[e][n]=t[e][n])}}function l(t){for(var e in t)m[e]=(m[e]||0)+t[e]}function u(n){var i={doi:n.doi,publisher:n.meta.publisher,environment:"html5",referrer_url:document.referrer};$.ajax({url:t("analytics_init"),type:"POST",dataType:"json",crossDomain:!0,xhrFields:{withCredentials:!0},data:{data:e.merge(i,{session_id:h})},success:function(t){e.log("created new tracking session"),f=t.result}})}function d(n){e.log("sending metrics update: ",n),$.ajax({url:t("analytics_update"),type:"POST",dataType:"json",crossDomain:!0,xhrFields:{withCredentials:!0},data:{data:e.merge(n,{session_id:h,article_session_id:f})}})}var h=window.readcube.tracking.tracking_id,f=null,p={},g={},m={},v=null,b=3e4,y=null,_=null,w=6e4;return{start:n,sendEvent:a,addCounter:l}}),define("tracker",["session","user","article","readcube-analytics","util"],function(t,e,n,i){function r(){t.onStart(s),$(e).on("login",function(){f(e.get())}),n.onceAccessChecked(function(){n.hasAccess()||o()})}function s(){n.onData(function(){i.start(n.get()),ga("send","event","article","read","web")})}function o(){i.sendEvent({access_denied:!0})}function a(){i.sendEvent({altmetric:!0})}function c(){i.sendEvent({cite:!0})}function l(){i.sendEvent({discover:!0})}function u(t){ga("send","event","article","save_pdf","web",t?1:0),t&&i.sendEvent({download:!0})}function d(){i.sendEvent({highlight:1})}function h(t){ga("send","event","article","linkout",t)}function f(){i.sendEvent({login:!0})}function p(){i.sendEvent({note:1})}function g(t){var e={};e[t]=!0,i.sendEvent({print:e}),ga("send","event","article","print","web")}function m(t){i.sendEvent({purchased:!0,purchase_id:t.purchase.id})}function v(){i.sendEvent({related:!0})}function b(){i.sendEvent({register:!0})}function y(){i.sendEvent({save_cloud:!0})}function _(t){ga("send","event","article","scroll","page",t)}function w(t){var e={};e[t.split(/-/)[1]]=!0,i.sendEvent({sidepanel:e})}function x(t){var e={};e[t]=!0,i.sendEvent({share:e})}function S(){i.sendEvent({supplement:!0}),ga("send","event","article","supplement","view")}function C(){ga("send","event","article","video","view")}return r(),{access_denied:o,altmetric:a,cite:c,discover:l,download:u,highlight:d,linkout:h,login:f,note:p,print:g,purchase:m,related:v,register:b,saveCloud:y,sidepanel:w,scroll:_,share:x,supplement:S,video:C}}),define("viewer",["article","viewer-control","tracker"],function(t,e,n){var i=e("#reader");return i.init(t.get()),t.onAccess(function(t){i.setData(t)}),$(i).on("page-changed",function(t,e){n.scroll(e)}),window.viewer=i,i});var I18n=I18n||{};I18n.defaultLocale="en",I18n.fallbacks=!1,I18n.defaultSeparator=".",I18n.locale=null,I18n.PLACEHOLDER=/(?:\{\{|%\{)(.*?)(?:\}\}?)/gm,I18n.isValidNode=function(t,e,n){return null!==t[e]&&t[e]!==n},I18n.lookup=function(t,e){var n,e=e||{},i=t,r=this.prepareOptions(I18n.translations),s=r[e.locale||I18n.currentLocale()],e=this.prepareOptions(e);if(s){for("object"==typeof t&&(t=t.join(this.defaultSeparator)),e.scope&&(t=e.scope.toString()+this.defaultSeparator+t),t=t.split(this.defaultSeparator);t.length>0;)if(n=t.shift(),s=s[n],!s){I18n.fallbacks&&!e.fallback&&(s=I18n.lookup(i,this.prepareOptions({locale:I18n.defaultLocale,fallback:!0},e)));break}return!s&&this.isValidNode(e,"defaultValue")&&(s=e.defaultValue),s}},I18n.prepareOptions=function(){for(var t,e={},n=arguments.length,i=0;n>i;i++)if(t=arguments[i])for(var r in t)this.isValidNode(e,r)||(e[r]=t[r]);return e},I18n.interpolate=function(t,e){e=this.prepareOptions(e);var n,i,r,s=t.match(this.PLACEHOLDER);if(!s)return t;for(var o=0;n=s[o];o++)r=n.replace(this.PLACEHOLDER,"$1"),i=e[r],this.isValidNode(e,r)||(i="[missing "+n+" value]"),regex=new RegExp(n.replace(/\{/gm,"\\{").replace(/\}/gm,"\\}")),t=t.replace(regex,i);return t},I18n.translate=function(t,e){e=this.prepareOptions(e);var n=this.lookup(t,e);try{return"object"==typeof n?"number"==typeof e.count?this.pluralize(e.count,t,e):n:this.interpolate(n,e)}catch(i){return this.missingTranslation(t)}},I18n.localize=function(t,e){switch(t){case"currency":return this.toCurrency(e);case"number":return t=this.lookup("number.format"),this.toNumber(e,t);case"percentage":return this.toPercentage(e);default:return t.match(/^(date|time)/)?this.toTime(t,e):e.toString()}},I18n.parseDate=function(t){var e,n;if("object"==typeof t)return t;if(e=t.toString().match(/(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2}):(\d{2}))?(Z|\+0000)?/)){for(var i=1;6>=i;i++)e[i]=parseInt(e[i],10)||0;e[2]-=1,n=e[7]?new Date(Date.UTC(e[1],e[2],e[3],e[4],e[5],e[6])):new Date(e[1],e[2],e[3],e[4],e[5],e[6])}else"number"==typeof t?(n=new Date,n.setTime(t)):t.match(/\d+ \d+:\d+:\d+ [+-]\d+ \d+/)?(n=new Date,n.setTime(Date.parse(t))):(n=new Date,n.setTime(Date.parse(t)));return n},I18n.toTime=function(t,e){var n=this.parseDate(e),i=this.lookup(t);return n.toString().match(/invalid/i)?n.toString():i?this.strftime(n,i):n.toString()},I18n.strftime=function(t,e){var n=this.lookup("date");if(!n)return t.toString();n.meridian=n.meridian||["AM","PM"];var i=t.getDay(),r=t.getDate(),s=t.getFullYear(),o=t.getMonth()+1,a=t.getHours(),c=a,l=a>11?1:0,u=t.getSeconds(),d=t.getMinutes(),h=t.getTimezoneOffset(),f=Math.floor(Math.abs(h/60)),p=Math.abs(h)-60*f,g=(h>0?"-":"+")+(f.toString().length<2?"0"+f:f)+(p.toString().length<2?"0"+p:p);c>12?c-=12:0===c&&(c=12);var m=function(t){var e="0"+t.toString();return e.substr(e.length-2)},v=e;return v=v.replace("%a",n.abbr_day_names[i]),v=v.replace("%A",n.day_names[i]),v=v.replace("%b",n.abbr_month_names[o]),v=v.replace("%B",n.month_names[o]),v=v.replace("%d",m(r)),v=v.replace("%e",r),v=v.replace("%-d",r),v=v.replace("%H",m(a)),v=v.replace("%-H",a),v=v.replace("%I",m(c)),v=v.replace("%-I",c),v=v.replace("%m",m(o)),v=v.replace("%-m",o),v=v.replace("%M",m(d)),v=v.replace("%-M",d),v=v.replace("%p",n.meridian[l]),v=v.replace("%S",m(u)),v=v.replace("%-S",u),v=v.replace("%w",i),v=v.replace("%y",m(s)),v=v.replace("%-y",m(s).replace(/^0+/,"")),v=v.replace("%Y",s),v=v.replace("%z",g)},I18n.toNumber=function(t,e){e=this.prepareOptions(e,this.lookup("number.format"),{precision:3,separator:".",delimiter:",",strip_insignificant_zeros:!1});var n,i,r=0>t,s=Math.abs(t).toFixed(e.precision).toString(),o=s.split("."),a=[];for(t=o[0],n=o[1];t.length>0;)a.unshift(t.substr(Math.max(0,t.length-3),3)),t=t.substr(0,t.length-3);if(i=a.join(e.delimiter),e.precision>0&&(i+=e.separator+o[1]),r&&(i="-"+i),e.strip_insignificant_zeros){var c={separator:new RegExp(e.separator.replace(/\./,"\\.")+"$"),zeros:/0+$/};i=i.replace(c.zeros,"").replace(c.separator,"")}return i},I18n.toCurrency=function(t,e){return e=this.prepareOptions(e,this.lookup("number.currency.format"),this.lookup("number.format"),{unit:"$",precision:2,format:"%u%n",delimiter:",",separator:"."}),t=this.toNumber(t,e),t=e.format.replace("%u",e.unit).replace("%n",t)},I18n.toHumanSize=function(t,e){for(var n,i,r=1024,s=t,o=0;s>=r&&4>o;)s/=r,o+=1;return 0===o?(n=this.t("number.human.storage_units.units.byte",{count:s}),i=0):(n=this.t("number.human.storage_units.units."+[null,"kb","mb","gb","tb"][o]),i=0===s-Math.floor(s)?0:1),e=this.prepareOptions(e,{precision:i,format:"%n%u",delimiter:""}),t=this.toNumber(s,e),t=e.format.replace("%u",n).replace("%n",t)},I18n.toPercentage=function(t,e){return e=this.prepareOptions(e,this.lookup("number.percentage.format"),this.lookup("number.format"),{precision:3,separator:".",delimiter:""}),t=this.toNumber(t,e),t+"%"},I18n.pluralize=function(t,e,n){var i;try{i=this.lookup(e,n)}catch(r){}if(!i)return this.missingTranslation(e);var s;switch(n=this.prepareOptions(n),n.count=t.toString(),Math.abs(t)){case 0:s=this.isValidNode(i,"zero")?i.zero:this.isValidNode(i,"none")?i.none:this.isValidNode(i,"other")?i.other:this.missingTranslation(e,"zero");break;case 1:s=this.isValidNode(i,"one")?i.one:this.missingTranslation(e,"one");break;default:s=this.isValidNode(i,"other")?i.other:this.missingTranslation(e,"other")}return this.interpolate(s,n)},I18n.missingTranslation=function(){for(var t='[missing "'+this.currentLocale(),e=arguments.length,n=0;e>n;n++)t+="."+arguments[n];return t+='" translation]'},I18n.currentLocale=function(){return I18n.locale||I18n.defaultLocale},I18n.t=I18n.translate,I18n.l=I18n.localize,I18n.p=I18n.pluralize;var I18n=I18n||{};I18n.translations={en:{js:{checkout:{tier_name:{tier_1:"48-hour Rental",tier_2:"Cloud Access",tier_3:"PDF"},errors:{non_selected_plan:"Please select a subscription plan.",invalid_number:"The card number you entered is not valid.",invalid_cvc:"The CVC code you entered is not valid.",invalid_expiry:"The expiry date you entered is not valid.",invalid_country:"The country you entered does not match the credit card country.",ajax_error:"There has been an error with your request. Please try again."}},ajax_error:"A communication error has occurred. Please check your internet connection and try again.",password_too_short:"Password must be at least %{len} characters long.",invalid_email:"You entered an invalid email address.",models:{purchase:{stripe_error:"An error has occurred, please try again later.",error:"An error has occurred, please try again later."}},reader:{set_institution:{set:"Set your institution",select:"Select your institution",save:"Save"},article_info_references:{readcube:"ReadCube Article",pubmed:"PubMed",crossref:"DOI"},content_menu:{more:"show more",less:"show less"},action_denied:{print:{title:"This article cannot be printed due to copyright restrictions.",message:"Please contact support@readcube.com for assistance."},save:{title:"This article cannot be saved due to copyright restrictions.",message:"Please contact support@readcube.com for assistance."}}},purchase:{purchase_finalize_step:{success:"Purchase has been successfully completed",error:"A communication error has occurred. Please check your internet connection and try again."},wileyonline_purchase:{thank_you:"Thank you for your purchase!",receipt_emailed:"A receipt has been emailed to {{email}}. You may access this article from the link in your email receipt, or by signing into readcube.com",reading_formats:"Reading formats",view_enhanced_pdf:"View Enhanced PDF",read_wiley_text:"Access article on Wiley Online Library",download_pdf:"Download PDF for offline viewing"}}}}},define("sync-primitives",["util","endpoint","article"],function(t,e,n){function i(i){$.ajax(t.merge(a,i,{type:"POST",url:e("add_to_sync"),data:{"ext_ids[doi]":n.get().doi,"return":!0,access_token:n.get().access_token}}))}function r(e){$.ajax(t.merge(a,e,{type:"DELETE"}))}function s(n,i){$.ajax(t.merge(a,i,{url:e("sync_item",{seq:n}),cache:!1}))}function o(n,i){$.ajax(t.merge(a,i,{type:"POST",url:e("sync_item_update"),data:{_json:JSON.stringify(n)}}))}var a={url:e("sync_item"),crossDomain:!0,dataType:"json",xhrFields:{withCredentials:!0},success:function(){},complete:function(){},error:function(){}};return{add:i,remove:r,pull:s,push:o}}),define("storage",["user"],function(t){function e(){var e="readcube-storage";return t.signedIn()&&(e+=":"+t.get().id),e}function n(){var t=localStorage.getItem(e());l=t?JSON.parse(t):{}}function i(){localStorage.setItem(e(),JSON.stringify(l))}function r(t){return l[t]}function s(t,e){l[t]=e,i()}function o(t){delete l[t],i()}function a(){n(),$(t).on("change",function(){n(),$(c).trigger("reload")})}var c={},l=null;return a(),c.getItem=r,c.setItem=s,c.removeItem=o,c}),define("sync-storage",["util","storage","article"],function(t,e,n){function i(){return t.merge(f,e.getItem(h))}function r(t){e.setItem(h,t)}function s(){return d=i(),d.tip}function o(){return d=i(),d.item}function a(t){t&&(d.tip=t,r(d))}function c(t){t&&(d.item=t,r(d))}function l(){d=i(),d.version!=u&&(d=t.clone(f),d.version=u),r(d)}var u=.5,d=null,h="sync:"+n.get().doi,f={tip:0,item:{seq:0}};return l(),{tip:s,item:o,setTip:a,setItem:c}}),define("sync",["util","enviroment","endpoint","message-receiver","user","sync-primitives","sync-storage","storage"],function(t,e,n,i,r,s,o,a){function c(){z--}function l(){z++}function u(){return 0>z}function d(t,e){c(),setTimeout(function(){t(),l()},e)}function h(e,n){var i=arguments.callee;s.pull(e,{success:function(r){t.log("sync pull:",r),"wait"==r.status?d(function(){i(e,n)},Math.ceil(1e3*r.timeout)):"ok"==r.status&&n(r)}})}function f(){h(o.item().seq,function(t){o.setTip(t.tip),o.setItem(t.item),t.item&&$(P).trigger("changed",[T()])})}function p(t,e,n){h(0,function(i){i.item?(t=e(t,i.item),i.item.user_data=t.user_data,i.item.seq=i.tip+1,o.setTip(i.tip),o.setItem(i.item),n(i.item,e)):C()})}function g(e,n){var i=arguments.callee;s.push(e,{success:function(r){t.log("sync push:",r),"resync"==r.status?p(e,n,i):"wait"==r.status?d(function(){i(e,n)},Math.ceil(1e3*r.timeout)):"ok"==r.status&&(o.setTip(r.tip),o.setItem(r.item),$(P).trigger("private:push"))}})}function m(t,e){return function(){p(t,e,g)}}function v(){var t=j;j=null,t&&t()}function b(){return 0==B%D}function y(){return 0==B%R}function _(){M&&!u()&&(j&&b()?v():y()&&f(),++B)}function w(){F=setInterval(_,A),_()}function x(t){r.signedIn()?null!=M?t(M):h(0,function(e){t(!!e.item)}):t(!1)}function S(){M=!0,a.getItem("sync-used")||(a.setItem("sync-used",!0),$(P).trigger("first-time-added")),$(P).trigger("added",[T()])}function C(){M=!1,j=null,$(P).trigger("removed")}function k(){r.onSignIn(function(){x(function(t){t&&S()})}),$(i).on("checkout:success",function(){!function(t){var e=arguments.callee;setTimeout(function(){x(function(n){n?S():e(1.5*t)})},t)}(2e3)}),w()}function T(){return o.item()}function I(t,e,n){r.signedIn()?(o.setItem(t),j=m(t,e),n&&$(P).one("private:push",n)):n&&n()}function O(e){x(function(n){n?(S(),e&&e()):s.add({complete:e,success:function(e){t.log("sync add:",e),"ok"==e.status&&S()}})})}function E(e){x(function(n){n?s.remove({complete:e,success:function(e){t.log("sync remove:",e),"ok"==e.status&&C()},error:function(t){404==t.status&&C()}}):e&&e()})}function N(t){M&&t(),$(P).on("added",t)}function L(t){M||t(),$(P).on("removed",t)}var A=1e3,R=e.production()?60:10,D=10,P={},M=null,j=null,F=null,z=0,B=0;return k(),P.get=T,P.set=I,P.add=O,P.remove=E,P.onAdd=N,P.onRemove=L,P.isAdded=x,window.sync=P,P}),function(t){t.fn.scrollParent||t.fn.extend({scrollParent:function(){var e;return e=t.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(t.css(this,"position"))&&/(auto|scroll)/.test(t.css(this,"overflow")+t.css(this,"overflow-y")+t.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(t.css(this,"overflow")+t.css(this,"overflow-y")+t.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!e.length?t(document.body):e}})}(jQuery),define("popover",["util"],function(t){function e(e){function r(){l.removeClass("up down left right"),l.css({top:"",left:""}),d.css({top:"",left:""})}function h(){r(),l.addClass("up"),k=t.measureElement(u),l.css({top:I.top-E-T.height-k.height-o.top,left:O.x-N-T.width/2});var e=t.getBoundingRect(d);return Math.max(0,C.top-(e.top-s.top))}function f(){r(),l.addClass("down"),k=t.measureElement(u),l.css({top:I.bottom-E+k.height+o.bottom,left:O.x-N-T.width/2});var e=t.getBoundingRect(d);return Math.max(0,e.bottom+s.bottom-C.bottom)}function p(){r(),l.addClass("left"),k=t.measureElement(u),l.css({top:O.y-E-T.height/2,left:I.left-N-T.width-k.width-o.left});var e=t.getBoundingRect(d);return Math.max(0,C.left-(e.left-s.left))}function g(){r(),l.addClass("right"),k=t.measureElement(u),l.css({top:O.y-E-T.height/2,left:I.right-N+k.width+o.right});var e=t.getBoundingRect(d);return Math.max(0,e.right+s.right-C.right)}function m(t){var e=[],n=[h,f],i="up"==t?0:1;(e[i]=n[i]())&&(e[1-i]=n[1-i]())&&(e[i]<=e[1-i]?n[i]():n[1-i]())}function v(t){var e=[],n=[p,g],i="left"==t?0:1;(e[i]=n[i]())&&(e[1-i]=n[1-i]())&&(e[i]<=e[1-i]?n[i]():n[1-i]())}function b(t){var e=t.left>0,n=t.right>0;return n&&e?t.left>=t.right?"right":"left":n?"left":e?"right":null}function y(t){var e=t.top>0,n=t.bottom>0;return n&&e?t.top>=t.bottom?"bottom":"top":n?"top":e?"bottom":null}function _(){var e=t.getBoundingRect(d),n={left:C.left-e.left+s.left,right:e.right-C.right+s.right},i=b(n);"left"==i&&d.css("left",Math.max(-(T.width/2)+k.width,-n.right)),"right"==i&&d.css("left",Math.min(T.width/2-k.width,n.left))}function w(){var e=t.getBoundingRect(d),n={top:C.top-e.top+s.top,bottom:e.bottom-C.bottom+s.bottom},i=y(n);"top"==i&&d.css("top",Math.max(-(T.height/2)+k.height,-n.bottom)),"bottom"==i&&d.css("top",Math.min(T.height/2-k.height,n.top))}i()&&n(),a=e.anchor,c=e.content;var x=a.scrollParent(),S=x.offset(),C=t.getBoundingRect(x);r(),d.removeClass(),d.addClass("container"),e.klass&&d.addClass(e.klass),d.children().detach(),d.append(c),l.appendTo(x),l.css({visibility:"hidden",display:"block"});var k=null,T=t.measureElement(c),I=t.getBoundingRect(a),O={x:(I.left+I.right)/2,y:(I.top+I.bottom)/2},E=S.top-x.scrollTop(),N=S.left-x.scrollLeft();switch(e.placement){case"up":case"down":m(e.placement),_();break;case"left":case"right":v(e.placement),w()}$(window).one("resize.popover",function(){n()}),t.queueExec(function(){$(document).on("click.popover",function(t){$(t.target).is(a)||($(document).off("click.popover"),n())})}),l.css("visibility","visible"),a.trigger("open.popover")}function n(t){return i(t)?($(window).off("resize.popover"),$(document).off("click.popover"),l.css({visibility:"hidden",display:"none"}),a.trigger("close.popover"),c=null,a=null,!0):!1}function i(t){return a?t?t.is(a):!0:!1}function r(t){n(t.anchor)||e(t)}var s={top:10,right:20,bottom:10,left:20},o={top:7,right:2,bottom:2,left:2},a=null,c=null,l=$(['<div class="popover">','<div class="container"></div>','<div class="arrow"></div>',"</div>"].join(""));l.on("mousedown mouseup click",function(t){t.stopImmediatePropagation()});var u=l.find(".arrow"),d=l.find(".container");return{open:e,close:n,toggle:r,isOpen:i}}),/**
 * Copyright (c) 2011-2013 Felix Gnass
 * Licensed under the MIT license
 */
function(t,e){t.Spinner=e(),"function"==typeof define&&define.amd&&define("spin",[],function(){return t.Spinner})}(this,function(){"use strict";function t(t,e){var n,i=document.createElement(t||"div");for(n in e)i[n]=e[n];return i}function e(t){for(var e=1,n=arguments.length;n>e;e++)t.appendChild(arguments[e]);return t}function n(t,e,n,i){var r=["opacity",e,~~(100*t),n,i].join("-"),s=.01+100*(n/i),o=Math.max(1-(1-t)/e*(100-s),t),a=u.substring(0,u.indexOf("Animation")).toLowerCase(),c=a&&"-"+a+"-"||"";return h[r]||(f.insertRule("@"+c+"keyframes "+r+"{"+"0%{opacity:"+o+"}"+s+"%{opacity:"+t+"}"+(s+.01)+"%{opacity:1}"+(s+e)%100+"%{opacity:"+t+"}"+"100%{opacity:"+o+"}"+"}",f.cssRules.length),h[r]=1),r}function i(t,e){var n,i,r=t.style;for(e=e.charAt(0).toUpperCase()+e.slice(1),i=0;i<d.length;i++)if(n=d[i]+e,void 0!==r[n])return n;return void 0!==r[e]?e:void 0}function r(t,e){for(var n in e)t.style[i(t,n)||n]=e[n];return t}function s(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)void 0===t[i]&&(t[i]=n[i])}return t}function o(t){for(var e={x:t.offsetLeft,y:t.offsetTop};t=t.offsetParent;)e.x+=t.offsetLeft,e.y+=t.offsetTop;return e}function a(t,e){return"string"==typeof t?t:t[e%t.length]}function c(t){return"undefined"==typeof this?new c(t):(this.opts=s(t||{},c.defaults,p),void 0)}function l(){function n(e,n){return t("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',n)}f.addRule(".spin-vml","behavior:url(#default#VML)"),c.prototype.lines=function(t,i){function s(){return r(n("group",{coordsize:u+" "+u,coordorigin:-l+" "+-l}),{width:u,height:u})}function o(t,o,c){e(h,e(r(s(),{rotation:360/i.lines*t+"deg",left:~~o}),e(r(n("roundrect",{arcsize:i.corners}),{width:l,height:i.width,left:i.radius,top:-i.width>>1,filter:c}),n("fill",{color:a(i.color,t),opacity:i.opacity}),n("stroke",{opacity:0}))))}var c,l=i.length+i.width,u=2*l,d=2*-(i.width+i.length)+"px",h=r(s(),{position:"absolute",top:d,left:d});if(i.shadow)for(c=1;c<=i.lines;c++)o(c,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(c=1;c<=i.lines;c++)o(c);return e(t,h)},c.prototype.opacity=function(t,e,n,i){var r=t.firstChild;i=i.shadow&&i.lines||0,r&&e+i<r.childNodes.length&&(r=r.childNodes[e+i],r=r&&r.firstChild,r=r&&r.firstChild,r&&(r.opacity=n))}}var u,d=["webkit","Moz","ms","O"],h={},f=function(){var n=t("style",{type:"text/css"});return e(document.getElementsByTagName("head")[0],n),n.sheet||n.styleSheet}(),p={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};c.defaults={},s(c.prototype,{spin:function(e){this.stop();var n,i,s=this,a=s.opts,c=s.el=r(t(0,{className:a.className}),{position:a.position,width:0,zIndex:a.zIndex}),l=a.radius+a.length+a.width;if(e&&(e.insertBefore(c,e.firstChild||null),i=o(e),n=o(c),r(c,{left:("auto"==a.left?i.x-n.x+(e.offsetWidth>>1):parseInt(a.left,10)+l)+"px",top:("auto"==a.top?i.y-n.y+(e.offsetHeight>>1):parseInt(a.top,10)+l)+"px"})),c.setAttribute("role","progressbar"),s.lines(c,s.opts),!u){var d,h=0,f=(a.lines-1)*(1-a.direction)/2,p=a.fps,g=p/a.speed,m=(1-a.opacity)/(g*a.trail/100),v=g/a.lines;!function b(){h++;for(var t=0;t<a.lines;t++)d=Math.max(1-(h+(a.lines-t)*v)%g*m,a.opacity),s.opacity(c,t*a.direction+f,d,a);s.timeout=s.el&&setTimeout(b,~~(1e3/p))}()}return s},stop:function(){var t=this.el;return t&&(clearTimeout(this.timeout),t.parentNode&&t.parentNode.removeChild(t),this.el=void 0),this},lines:function(i,s){function o(e,n){return r(t(),{position:"absolute",width:s.length+s.width+"px",height:s.width+"px",background:e,boxShadow:n,transformOrigin:"left",transform:"rotate("+~~(360/s.lines*l+s.rotate)+"deg) translate("+s.radius+"px"+",0)",borderRadius:(s.corners*s.width>>1)+"px"})}for(var c,l=0,d=(s.lines-1)*(1-s.direction)/2;l<s.lines;l++)c=r(t(),{position:"absolute",top:1+~(s.width/2)+"px",transform:s.hwaccel?"translate3d(0,0,0)":"",opacity:s.opacity,animation:u&&n(s.opacity,s.trail,d+l*s.direction,s.lines)+" "+1/s.speed+"s linear infinite"}),s.shadow&&e(c,r(o("#000","0 0 4px #000"),{top:"2px"})),e(i,e(c,o(a(s.color,l),"0 0 1px rgba(0,0,0,.1)")));return i},opacity:function(t,e,n){e<t.childNodes.length&&(t.childNodes[e].style.opacity=n)}});var g=r(t("group"),{behavior:"url(#default#VML)"});return!i(g,"transform")&&g.adj?l():u=i(g,"animation"),c}),define("spin-btn",["spin"],function(t){function e(t,e){this._elem=t,this._spinner=null,this._options=$.extend({color:"#FFF",radius:4,length:4,width:2},e)}return e.prototype={spin:function(){this._spinner||(this._elem.children().css("visibility","hidden"),this._spinner=new t(this._options).spin(this._elem[0]))},stop:function(){this._spinner&&(this._spinner.stop(),this._elem.children().css("visibility","visible"),this._spinner=null)},spinning:function(){return!!this._spinner}},e}),define("savecloud-view",["util","sync","user","article","access-control","tracker","popover","spin-btn"],function(t,e,n,i,r,s,o,a){function c(t){m.spinning()||(m.spin(),e.add(function(){m.stop(),e.isAdded(function(e){t&&t(e)})}),s.saveCloud())}function l(){m.spinning()||(m.spin(),e.remove(function(){m.stop()}))}function u(){g.hasClass("saved")?l():c()}function d(){$(function(){g=$("#cloud-save"),f=$("#cloud-save-menu"),p=$("#cloud-first-add-dialog"),m=new a(g),i.onAccessCheck(function(){$(document.body).toggleClass("rainbow",!i.get().sync_enabled)}),e.onAdd(function(){g.addClass("saved")}),e.onRemove(function(){g.removeClass("saved")}),$(e).on("first-time-added",function(){o.open({placement:"up",content:p,anchor:g})}),f.find(".sign-in").click(function(){return o.close(g),n.showRegister({tracking_action:"add_to_library"},function(){r.onLoginCheck(c)}),!1}),g.click(function(){n.signedIn()?u():o.toggle({placement:"up",content:f,anchor:g})})})}var h={},f=null,p=null,g=null,m=null;return d(),h.saveToCloud=c,h}),define("checkout-view",["util","message-receiver","user","article","access-control","viewer","tracker","spin"],function(t,e,n,i,r,s,o,a){function c(){y.attr("src")||(u(),$(e).one("checkout:new",d),y.on("load",d),y.attr("src",y.data("src")))}function l(){y.attr("src")&&(y.removeAttr("src"),c())}function u(){y.css("visibility","hidden"),_.show(),w.spin(_.find(".spinner")[0]),x=t.timer.tic()}function d(){t.log("checkout load time:",t.timer.toc(x)+"ms"),y.off("load"),w.stop(),_.hide(),y.css("visibility","visible")}function h(){arguments.callee.initalized||(arguments.callee.initalized=!0,$(s).on("scroll.checkout",t.throttle(function(){s.eachVisiblePage(function(t,e){return e.hasAccess()?void 0:($(s).off("scroll.checkout"),g(),!1)})},500)))}function f(t){$("#content").toggleClass("non-purchasable",!t.purchasable)}function p(){$(e).on("checkout:success",function(t,e){o.purchase(e),r.checkAccess()}),$(e).on("checkout:login",function(t,e){$(n).off("login.checkout"),n.set(e.user),$(n).on("login.checkout",l)}),$(e).on("checkout:redirect",function(t,e){location.href=e.url}),$(function(){b=$("#sidepanel-checkout"),y=b.find("iframe.checkout"),_=b.find(".loading-screen"),w=new a({color:"#0697fe",radius:20,length:40,width:2}),b.one("open",c),$(n).on("login.checkout",l),i.onceAccessChecked(h),i.onceAccessChecked(f),i.onAccessCheck(function(){i.hasAccess()?b.trigger("hide"):(b.trigger("show"),window.readcube.show_checkout&&g())})})}function g(){b.trigger("tab:open")}function m(){b.trigger("tab:close")}var v={},b=null,y=null,_=null,w=null,x=null;return p(),v.open=g,v.close=m,v}),define("dialog-modal",function(){var t=200,e=400,n=function(n){function i(){return $('<div class="modal-bg"></div>')}function r(t){return $('<div class="modal '+b+'"></div>').click(function(t){t.stopPropagation()}).append(t)}function s(){$(document.body).addClass("modal-open")}function o(){$(document.body).removeClass("modal-open")}function a(){$(window).unbind("keydown.dialog-modal")}function c(){a(),$(window).bind("keydown.dialog-modal",function(t){return t.metaKey||t.ctrlKey?void 0:27==t.keyCode&&h()?(l(),!1):void 0})}function l(n){return v||!g?(n&&n(),!1):(v=!0,a(),m.animate({top:"-100%",bottom:"100%"},e,function(){m.detach(),m=null,g.fadeOut(t,function(){g.remove(),o(),g=null,v=!1,n&&n()})}),!0)}function u(){return v||!g?!1:(a(),m.detach(),g.remove(),o(),m=null,g=null,v=!1,!0)}function d(n,o){return v||g?(o&&o(),!1):(v=!0,s(),g=i(),m=r(n),g.appendTo(document.body),m.appendTo(g),g.click(function(){return l(),!1}),g.fadeIn(t,function(){m.animate({top:"0%",bottom:"0%"},e,function(){c(),v=!1,o&&o()})}),!0)}function h(){return null!=g}function f(t,e){h()?l(e):d(t,e)}function p(t){m&&m.removeClass(b).addClass(t),b=t}var g=null,m=null,v=!1,b=n;return{show:d,hide:l,hideIm:u,isOpen:h,toggle:f,setClass:p}};return n}),define("print-modal",["dialog-modal"],function(t){var e=function(){function e(t){return u.show(l,t)}function n(t){return u.hide(t)}function i(){return u.hideIm()}function r(){return u.isOpen()}function s(t){return u.toggle(l,t)}function o(t){return u.setClass(t)}function a(){var t=$("#templates #print-dialog");l=t.clone().removeAttr("id"),l.find(".print-pdf").click(function(){$(c).trigger("print-pdf")}),l.find(".send-to-tablet").click(function(){$(c).trigger("send-to-tablet")}),l.find(".google-cloud-print").click(function(){$(c).trigger("google-cloud-print")}),l.find(".close-btn").click(function(){n()})}var c={},l=null,u=t("print-options");return a(),c.show=e,c.hide=n,c.hideIm=i,c.isOpen=r,c.toggle=s,c.setClass=o,c};return e}),define("format",function(){function t(t){return d[t]}function e(t,e){if(t=(0|t).toString(),t.length<e)for(var n=t.length;e>n;n++)t="0"+t;return t}function n(t){var n=e(t.getFullYear(),4),i=e(t.getMonth()+1,2),r=e(t.getDate(),2),s=e(t.getHours(),2),o=e(t.getMinutes(),2),a=e(t.getSeconds(),2);return[n,"/",i,"/",r," ",s,":",o,":",a].join("")}function i(t){var e=Date.now(),n=e-u,i=new Date(e),r=new Date(n),s=t.toLocaleDateString(),o=t.toLocaleTimeString(),a=s;return s==i.toLocaleDateString()?a="Today,":s==r.toLocaleDateString()&&(a="Yesterday,"),a+=" "+o}function r(t){var n=e(t.getFullYear(),4),i=e(t.getMonth()+1,2),r=e(t.getDate(),2);return[n,"/",i,"/",r].join("")}function s(t){return{hours:Math.floor(t/l),minutes:Math.floor(t%l/c),seconds:Math.round(t%c/a)}}function o(t){var e=s(t),n="hh hours, mm minutes";return 0==e.hours&&(n="mm minutes, ss seconds"),1==e.hours&&n.replace("hours","hour"),1==e.minutes&&n.replace("minutes","minute"),1==e.seconds&&n.replace("seconds","second"),n=n.replace("hh",e.hours),n=n.replace("mm",e.minutes),n.replace("ss",e.seconds)}var a=1e3,c=60*a,l=60*c,u=24*l,d={1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"};return{zfill:e,month:t,preciseDate:n,simpleDate:r,friendlyDate:i,friendlyDuration:o}}),define("article-export",["user","article","tracker","checkout-view","savecloud-view","print-modal","popover","browser-detect","format","util"],function(t,e,n,i,r,s,o,a,c,l){function u(){e.onceAccessChecked(function(){e.get().pdf_url?(n.download(!0),window.location=e.get().pdf_url):e.hasAccess()?(o.open({placement:"up",content:m("download"),anchor:$("#save")}),n.download(!1)):(i.open(),n.download(!1))})}function d(){e.onceAccessChecked(function(){e.get().print_url?h():e.hasAccess()?o.open({placement:"up",content:m("print"),anchor:$("#print")}):i.open()})}function h(){_.setClass("print-options"),_.show()}function f(){n.print("hd"),_.hideIm();var t=e.get().print_url;"Chrome"==a.browser&&(t=l.addParams(t,{salt:l.guid()})),window.open(t,"_blank").focus()}function p(){n.print("cloud"),_.hideIm(),y=y||new cloudprint.Gadget,y.setPrintDocument("url","",e.get().print_url),y.openPrintDialog()}function g(){n.print("mobile");var e=function(){r.saveToCloud(function(t){t&&(_.setClass("sync-success"),_.show())})};t.signedIn()?e():(_.hideIm(),t.showLogin({tracking_action:"print_send_to_mobile"},e))}function m(t){var n=e.get().purchase,i=e.get().access_shared,r=i?"shared":"purchase",s=$("#"+t+"-"+r+"-unavailable-notice").clone().removeAttr("id");return n?(s.find(".info .purchase-type").html(I18n.t("js.checkout.tier_name.tier_"+n.tier)),s.find(".info .purchase-date").html(c.simpleDate(new Date(1e3*n.purchasedAt))),s.find(".info").show()):s.find(".info").hide(),s}function v(){_=s(),$(_).on("print-pdf",f),$(_).on("google-cloud-print",p),$(_).on("send-to-tablet",g)}var b={},y=null,_=null;return v(),b.download=u,b.print=d,b}),define("key-handler",["viewer","article-export"],function(t,e){function n(){$(window).on("keydown",function(n){(n.metaKey||n.ctrlKey)&&(70==n.keyCode?t.loadAll():80==n.keyCode&&(n.preventDefault(),e.print()))})}n()}),define("copy-control",["article"],function(t){function e(){$(document).on("contextmenu","#reader",function(t){t.preventDefault()})}function n(){$(document).on("keydown","#reader",function(t){(t.metaKey||t.ctrlKey)&&67==t.keyCode&&t.preventDefault()})}function i(){t.onAccess(function(t){t.access_shared&&$(function(){e(),n()})})}i()}),define("banner",["article","viewer"],function(t,e){function n(){return e.getPageObj(1).getWidth()}function i(){return e.getPageObj(1).getScale()}function r(){var t=n()*i(),e=t/l.data("original-width"),r=l.data("original-height")*e;l.css({width:t,height:r}),l.find("img").each(function(){var t=$(this);t.css({width:t.data("original-width")*e,height:t.data("original-height")*e})})}function s(){$(function(){l=$("#reader .banner"),l.data("original-width",l.width()),l.data("original-height",l.height()),t.onData(function(t){t.banner&&(o(t.banner),$(e).on("scale",r),e.onInit(r))})})}function o(t){a(t.background,function(){function e(t){l.data("original-height",Math.max($(t).data("original-height"),l.data("original-height")))}l.css("background-image","url("+t.background+")").show(),a(t.left,function(t){t.className="left",l.append(t),e(t),r()}),a(t.center,function(t){t.className="center",l.append(t),e(t),r()}),a(t.right,function(t){t.className="right",l.append(t),e(t),r()})})}function a(t,e){var n=new Image;n.onload=function(){$(n).data("original-width",n.width),$(n).data("original-height",n.height),e(n)},n.src=t}var c={},l=null;return s(),c}),define("input-handler",function(){function t(t){var e=t.attr("class").split(" ");return e=$.grep(e,function(t){return!!h[t]}).sort(function(t,e){return h[t]-h[e]}),e[0]}function e(e,n){n.getElems().on(e+"."+n.getId(),function(n){var i=$(n.target),r=t(i);if(r){var s=i.data(r+f).split(" ").pop();return $(d[s]).trigger(e),!1}})}function n(t,e){e.getElems().off(t+"."+e.getId())}function i(t){for(var n=0;n<u.length;n++)e(u[n],t)}function r(t){for(var e=0;e<u.length;e++)n(u[e],t)}function s(t){var e=t.getId(),n=t.getKlass()+f;t.getElems().each(function(){var t=$(this),i=t.data(n),r=i?[i,e].join(" "):e;t.data(n,r)})}function o(t){var e=t.getId(),n=t.getKlass()+f;t.getElems().each(function(){var t=$(this),i=t.data(n).split(" ");i=$.grep(i,function(t){return t!=e}),t.data(n,i.join(" "))})}function a(t){d[t.getId()]=t,s(t),i(t)}function c(t){r(t),o(t),delete d[t.getId()]}var l={},u=["mouseenter","mouseleave","click"],d={},h={"current-selection":1,"enhanced-reference":2,"enhanced-author":3,annotation:4},f="-input-id";return l.add=a,l.remove=c,l}),define("citations-drawer",["util","viewer"],function(t,e){function n(t){t.addClass("animate-enhanced show-enhanced"),setTimeout(function(){t.removeClass("show-enhanced")},1e3),setTimeout(function(){t.removeClass("animate-enhanced")},1500)}function i(){var t=e.getPage(),i=e.getPageObj(t);return i.hasText()?(n(i.getElem()),!0):!1}function r(e){var n=e.getKlass()+c,i=e.getElems().addClass(n);"author"==e.getType()?i.filter(function(){return t.containsDiacritic(this.innerText)}).addClass("diacritic"):i.length>1&&i.each(function(t){0==t?$(this).addClass("leftmost"):t==i.length-1?$(this).addClass("rightmost"):$(this).addClass("middle")}),i.on({mouseenter:function(){i.addClass("hover")},mouseleave:function(){i.removeClass("hover")},"open.popover":function(){i.addClass("active")},"close.popover":function(){i.removeClass("active")}})}function s(){}function o(){e.onInit(function(){$(document).one("mousemove.animate-citations",function(){$(document).on("mousemove.animate-citations",function(){i()&&$(document).off("mousemove.animate-citations")})}),$(window).on("keydown",function(t){t.metaKey||t.ctrlKey||82==t.keyCode&&i()})})}var a={},c="-elem-draw";return o(),a.add=r,a.remove=s,a}),/**
 * Rangy, a cross-browser JavaScript range and selection library
 * http://code.google.com/p/rangy/
 *
 * Copyright 2014, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3alpha.20140716
 * Build date: 16 July 2014
 */
function(t){function e(t,e){var n=typeof t[e];return n==_||!(n!=y||!t[e])||"unknown"==n}function n(t,e){return!(typeof t[e]!=y||!t[e])}function i(t,e){return typeof t[e]!=w}function r(t){return function(e,n){for(var i=n.length;i--;)if(!t(e,n[i]))return!1;return!0}}function s(t){return t&&T(t,k)&&O(t,C)}function o(t){return n(t,"body")?t.body:t.getElementsByTagName("body")[0]}function a(t){n(window,"console")&&e(window.console,"log")&&window.console.log(t)}function c(t,e){e?window.alert(t):a(t)}function l(t){N.initialized=!0,N.supported=!1,c("Rangy is not supported on this page in your browser. Reason: "+t,N.config.alertOnFail)}function u(t){c("Rangy warning: "+t,N.config.alertOnWarn)}function d(t){return t.message||t.description||String(t)}function h(){if(!N.initialized){var t,n=!1,i=!1;e(document,"createRange")&&(t=document.createRange(),T(t,S)&&O(t,x)&&(n=!0));var r=o(document);if(!r||"body"!=r.nodeName.toLowerCase())return l("No body element found"),void 0;if(r&&e(r,"createTextRange")&&(t=r.createTextRange(),s(t)&&(i=!0)),!n&&!i)return l("Neither Range nor TextRange are available"),void 0;N.initialized=!0,N.features={implementsDomRange:n,implementsTextRange:i};var c,u;for(var h in E)(c=E[h])instanceof p&&c.init(c,N);for(var f=0,g=A.length;g>f;++f)try{A[f](N)}catch(m){u="Rangy init listener threw an exception. Continuing. Detail: "+d(m),a(u)}}}function f(t){t=t||window,h();for(var e=0,n=R.length;n>e;++e)R[e](t)}function p(t,e,n){this.name=t,this.dependencies=e,this.initialized=!1,this.supported=!1,this.initializer=n}function g(t,e,n,i){var r=new p(e,n,function(t){if(!t.initialized){t.initialized=!0;try{i(N,t),t.supported=!0}catch(n){var r="Module '"+e+"' failed to load: "+d(n);a(r)}}});E[e]=r}function m(){}function v(){}var b=!1,y="object",_="function",w="undefined",x=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],S=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],C=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],k=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],T=r(e),I=r(n),O=r(i),E={},N={version:"1.3alpha.20140716",initialized:!1,supported:!0,util:{isHostMethod:e,isHostObject:n,isHostProperty:i,areHostMethods:T,areHostObjects:I,areHostProperties:O,isTextRange:s,getBody:o},features:{},modules:E,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1}};N.fail=l,N.warn=u,{}.hasOwnProperty?N.util.extend=function(t,e,n){var i,r;for(var s in e)e.hasOwnProperty(s)&&(i=t[s],r=e[s],n&&null!==i&&"object"==typeof i&&null!==r&&"object"==typeof r&&N.util.extend(i,r,!0),t[s]=r);return e.hasOwnProperty("toString")&&(t.toString=e.toString),t}:l("hasOwnProperty not supported"),function(){var t=document.createElement("div");t.appendChild(document.createElement("span"));var e,n=[].slice;try{1==n.call(t.childNodes,0)[0].nodeType&&(e=function(t){return n.call(t,0)})}catch(i){}e||(e=function(t){for(var e=[],n=0,i=t.length;i>n;++n)e[n]=t[n];return e}),N.util.toArray=e}();var L;e(document,"addEventListener")?L=function(t,e,n){t.addEventListener(e,n,!1)}:e(document,"attachEvent")?L=function(t,e,n){t.attachEvent("on"+e,n)}:l("Document does not have required addEventListener or attachEvent method"),N.util.addListener=L;var A=[];N.init=h,N.addInitListener=function(t){N.initialized?t(N):A.push(t)};var R=[];N.addCreateMissingNativeApiListener=function(t){R.push(t)},N.createMissingNativeApi=f,p.prototype={init:function(){for(var t,e,n=this.dependencies||[],i=0,r=n.length;r>i;++i){if(e=n[i],t=E[e],!(t&&t instanceof p))throw new Error("required module '"+e+"' not found");if(t.init(),!t.supported)throw new Error("required module '"+e+"' not supported")}this.initializer(this)},fail:function(t){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+t)},warn:function(t){N.warn("Module "+this.name+": "+t)},deprecationNotice:function(t,e){N.warn("DEPRECATED: "+t+" in module "+this.name+"is deprecated. Please use "+e+" instead")},createError:function(t){return new Error("Error in Rangy "+this.name+" module: "+t)}},N.createModule=function(t){var e,n;2==arguments.length?(e=arguments[1],n=[]):(e=arguments[2],n=arguments[1]),g(!1,t,n,e)},N.createCoreModule=function(t,e,n){g(!0,t,e,n)},N.RangePrototype=m,N.rangePrototype=new m,N.selectionPrototype=new v;var $=!1,D=function(){$||($=!0,N.initialized||h())};return typeof window==w?(l("No window found"),void 0):typeof document==w?(l("No document found"),void 0):(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",D,!1),L(window,"load",D),b&&!function(t){t(function(){return N.amd=!0,N})}(t.define),t.rangy=N,void 0)}(this),rangy.createCoreModule("DomUtil",[],function(t,e){function n(t){var e;return typeof t.namespaceURI==E||null===(e=t.namespaceURI)||"http://www.w3.org/1999/xhtml"==e}function i(t){var e=t.parentNode;return 1==e.nodeType?e:null}function r(t){for(var e=0;t=t.previousSibling;)++e;return e}function s(t){switch(t.nodeType){case 7:case 10:return 0;case 3:case 8:return t.length;default:return t.childNodes.length}}function o(t,e){var n,i=[];for(n=t;n;n=n.parentNode)i.push(n);for(n=e;n;n=n.parentNode)if(R(i,n))return n;return null}function a(t,e,n){for(var i=n?e:e.parentNode;i;){if(i===t)return!0;i=i.parentNode}return!1}function c(t,e){return a(t,e,!0)}function l(t,e,n){for(var i,r=n?t:t.parentNode;r;){if(i=r.parentNode,i===e)return r;r=i}return null}function u(t){var e=t.nodeType;return 3==e||4==e||8==e}function d(t){if(!t)return!1;var e=t.nodeType;return 3==e||8==e}function h(t,e){var n=e.nextSibling,i=e.parentNode;return n?i.insertBefore(t,n):i.appendChild(t),t}function f(t,e,n){var i=t.cloneNode(!1);if(i.deleteData(0,e),t.deleteData(e,t.length-e),h(i,t),n)for(var s,o=0;s=n[o++];)s.node==t&&s.offset>e?(s.node=i,s.offset-=e):s.node==t.parentNode&&s.offset>r(t)&&++s.offset;return i}function p(t){if(9==t.nodeType)return t;if(typeof t.ownerDocument!=E)return t.ownerDocument;if(typeof t.document!=E)return t.document;if(t.parentNode)return p(t.parentNode);throw e.createError("getDocument: no document found for node")}function g(t){var n=p(t);if(typeof n.defaultView!=E)return n.defaultView;if(typeof n.parentWindow!=E)return n.parentWindow;throw e.createError("Cannot get a window object for node")}function m(t){if(typeof t.contentDocument!=E)return t.contentDocument;if(typeof t.contentWindow!=E)return t.contentWindow.document;throw e.createError("getIframeDocument: No Document object found for iframe element")}function v(t){if(typeof t.contentWindow!=E)return t.contentWindow;if(typeof t.contentDocument!=E)return t.contentDocument.defaultView;throw e.createError("getIframeWindow: No Window object found for iframe element")}function b(t){return t&&N.isHostMethod(t,"setTimeout")&&N.isHostObject(t,"document")}function y(t,e,n){var i;if(t?N.isHostProperty(t,"nodeType")?i=1==t.nodeType&&"iframe"==t.tagName.toLowerCase()?m(t):p(t):b(t)&&(i=t.document):i=document,!i)throw e.createError(n+"(): Parameter must be a Window object or DOM node");return i}function _(t){for(var e;e=t.parentNode;)t=e;return t}function w(t,n,i,s){var a,c,u,d,h;if(t==i)return n===s?0:s>n?-1:1;if(a=l(i,t,!0))return n<=r(a)?-1:1;if(a=l(t,i,!0))return r(a)<s?-1:1;if(c=o(t,i),!c)throw new Error("comparePoints error: nodes have no common ancestor");if(u=t===c?c:l(t,c,!0),d=i===c?c:l(i,c,!0),u===d)throw e.createError("comparePoints got to case 4 and childA and childB are the same!");for(h=c.firstChild;h;){if(h===u)return-1;if(h===d)return 1;h=h.nextSibling}}function x(t){var e;try{return e=t.parentNode,!1}catch(n){return!0}}function S(t){if(!t)return"[No node]";if($&&x(t))return"[Broken node]";if(u(t))return'"'+t.data+'"';if(1==t.nodeType){var e=t.id?' id="'+t.id+'"':"";return"<"+t.nodeName+e+">[index:"+r(t)+",length:"+t.childNodes.length+"]["+(t.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return t.nodeName}function C(t){for(var e,n=p(t).createDocumentFragment();e=t.firstChild;)n.appendChild(e);return n}function k(t){this.root=t,this._next=t}function T(t){return new k(t)}function I(t,e){this.node=t,this.offset=e}function O(t){this.code=this[t],this.codeName=t,this.message="DOMException: "+this.codeName}var E="undefined",N=t.util;N.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||e.fail("document missing a Node creation method"),N.isHostMethod(document,"getElementsByTagName")||e.fail("document missing getElementsByTagName method");var L=document.createElement("div");N.areHostMethods(L,["insertBefore","appendChild","cloneNode"]||!N.areHostObjects(L,["previousSibling","nextSibling","childNodes","parentNode"]))||e.fail("Incomplete Element implementation"),N.isHostProperty(L,"innerHTML")||e.fail("Element is missing innerHTML property");var A=document.createTextNode("test");N.areHostMethods(A,["splitText","deleteData","insertData","appendData","cloneNode"]||!N.areHostObjects(L,["previousSibling","nextSibling","childNodes","parentNode"])||!N.areHostProperties(A,["data"]))||e.fail("Incomplete Text Node implementation");var R=function(t,e){for(var n=t.length;n--;)if(t[n]===e)return!0;return!1},$=!1;!function(){var e=document.createElement("b");e.innerHTML="1";var n=e.firstChild;e.innerHTML="<br>",$=x(n),t.features.crashyTextNodes=$}();var D;typeof window.getComputedStyle!=E?D=function(t,e){return g(t).getComputedStyle(t,null)[e]}:typeof document.documentElement.currentStyle!=E?D=function(t,e){return t.currentStyle[e]}:e.fail("No means of obtaining computed style properties found"),k.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var t,e,n=this._current=this._next;if(this._current)if(t=n.firstChild)this._next=t;else{for(e=null;n!==this.root&&!(e=n.nextSibling);)n=n.parentNode;this._next=e}return this._current},detach:function(){this._current=this._next=this.root=null}},I.prototype={equals:function(t){return!!t&&this.node===t.node&&this.offset==t.offset},inspect:function(){return"[DomPosition("+S(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},O.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},O.prototype.toString=function(){return this.message},t.dom={arrayContains:R,isHtmlNamespace:n,parentElement:i,getNodeIndex:r,getNodeLength:s,getCommonAncestor:o,isAncestorOf:a,isOrIsAncestorOf:c,getClosestAncestorIn:l,isCharacterDataNode:u,isTextOrCommentNode:d,insertAfter:h,splitDataNode:f,getDocument:p,getWindow:g,getIframeWindow:v,getIframeDocument:m,getBody:N.getBody,isWindow:b,getContentDocument:y,getRootContainer:_,comparePoints:w,isBrokenNode:x,inspectNode:S,getComputedStyleProperty:D,fragmentFromNodeChildren:C,createIterator:T,DomPosition:I},t.DOMException=O}),rangy.createCoreModule("DomRange",["DomUtil"],function(t){function e(t,e){return 3!=t.nodeType&&(F(t,e.startContainer)||F(t,e.endContainer))}function n(t){return t.document||z(t.startContainer)}function i(t){return new D(t.parentNode,j(t))}function r(t){return new D(t.parentNode,j(t)+1)}function s(t,e,n){var i=11==t.nodeType?t.firstChild:t;return M(e)?n==e.length?R.insertAfter(t,e):e.parentNode.insertBefore(t,0==n?e:U(e,n)):n>=e.childNodes.length?e.appendChild(t):e.insertBefore(t,e.childNodes[n]),i}function o(t,e,i){if(C(t),C(e),n(e)!=n(t))throw new P("WRONG_DOCUMENT_ERR");var r=B(t.startContainer,t.startOffset,e.endContainer,e.endOffset),s=B(t.endContainer,t.endOffset,e.startContainer,e.startOffset);return i?0>=r&&s>=0:0>r&&s>0}function a(t){for(var e,i,r,s=n(t.range).createDocumentFragment();i=t.next();){if(e=t.isPartiallySelectedSubtree(),i=i.cloneNode(!e),e&&(r=t.getSubtreeIterator(),i.appendChild(a(r)),r.detach()),10==i.nodeType)throw new P("HIERARCHY_REQUEST_ERR");s.appendChild(i)}return s}function c(t,e,n){var i,r;n=n||{stop:!1};for(var s,o;s=t.next();)if(t.isPartiallySelectedSubtree()){if(e(s)===!1)return n.stop=!0,void 0;if(o=t.getSubtreeIterator(),c(o,e,n),o.detach(),n.stop)return}else for(i=R.createIterator(s);r=i.next();)if(e(r)===!1)return n.stop=!0,void 0}function l(t){for(var e;t.next();)t.isPartiallySelectedSubtree()?(e=t.getSubtreeIterator(),l(e),e.detach()):t.remove()}function u(t){for(var e,i,r=n(t.range).createDocumentFragment();e=t.next();){if(t.isPartiallySelectedSubtree()?(e=e.cloneNode(!1),i=t.getSubtreeIterator(),e.appendChild(u(i)),i.detach()):t.remove(),10==e.nodeType)throw new P("HIERARCHY_REQUEST_ERR");r.appendChild(e)}return r}function d(t,e,n){var i,r=!(!e||!e.length),s=!!n;r&&(i=new RegExp("^("+e.join("|")+")$"));var o=[];return c(new f(t,!1),function(e){if(!(r&&!i.test(e.nodeType)||s&&!n(e))){var a=t.startContainer;if(e!=a||!M(a)||t.startOffset!=a.length){var c=t.endContainer;e==c&&M(c)&&0==t.endOffset||o.push(e)}}}),o}function h(t){var e="undefined"==typeof t.getName?"Range":t.getName();return"["+e+"("+R.inspectNode(t.startContainer)+":"+t.startOffset+", "+R.inspectNode(t.endContainer)+":"+t.endOffset+")]"}function f(t,e){if(this.range=t,this.clonePartiallySelectedTextNodes=e,!t.collapsed){this.sc=t.startContainer,this.so=t.startOffset,this.ec=t.endContainer,this.eo=t.endOffset;var n=t.commonAncestorContainer;this.sc===this.ec&&M(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||M(this.sc)?Y(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||M(this.ec)?Y(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function p(t){return function(e,n){for(var i,r=n?e:e.parentNode;r;){if(i=r.nodeType,W(t,i))return r;r=r.parentNode}return null}}function g(t,e){if(ee(t,e))throw new P("INVALID_NODE_TYPE_ERR")}function m(t,e){if(!W(e,t.nodeType))throw new P("INVALID_NODE_TYPE_ERR")}function v(t,e){if(0>e||e>(M(t)?t.length:t.childNodes.length))throw new P("INDEX_SIZE_ERR")}function b(t,e){if(J(t,!0)!==J(e,!0))throw new P("WRONG_DOCUMENT_ERR")}function y(t){if(te(t,!0))throw new P("NO_MODIFICATION_ALLOWED_ERR")}function _(t,e){if(!t)throw new P(e)}function w(t){return V&&R.isBrokenNode(t)||!W(Q,t.nodeType)&&!J(t,!0)}function x(t,e){return e<=(M(t)?t.length:t.childNodes.length)}function S(t){return!!t.startContainer&&!!t.endContainer&&!w(t.startContainer)&&!w(t.endContainer)&&x(t.startContainer,t.startOffset)&&x(t.endContainer,t.endOffset)}function C(t){if(!S(t))throw new Error("Range error: Range is no longer valid after DOM mutation ("+t.inspect()+")")}function k(t,e){C(t);var n=t.startContainer,i=t.startOffset,r=t.endContainer,s=t.endOffset,o=n===r;M(r)&&s>0&&s<r.length&&U(r,s,e),M(n)&&i>0&&i<n.length&&(n=U(n,i,e),o?(s-=i,r=n):r==n.parentNode&&s>=j(n)&&s++,i=0),t.setStartAndEnd(n,i,r,s)}function T(t){t.START_TO_START=ae,t.START_TO_END=ce,t.END_TO_END=le,t.END_TO_START=ue,t.NODE_BEFORE=de,t.NODE_AFTER=he,t.NODE_BEFORE_AND_AFTER=fe,t.NODE_INSIDE=pe}function I(t){T(t),T(t.prototype)}function O(t,e){return function(){C(this);var n,i,s=this.startContainer,o=this.startOffset,a=this.commonAncestorContainer,l=new f(this,!0);s!==a&&(n=Y(s,a,!0),i=r(n),s=i.node,o=i.offset),c(l,y),l.reset();var u=t(l);return l.detach(),e(this,s,o,s,o),u}}function E(n,s){function o(t,e){return function(n){m(n,G),m(q(n),Q);var s=(t?i:r)(n);(e?a:c)(this,s.node,s.offset)}}function a(t,e,n){var i=t.endContainer,r=t.endOffset;(e!==t.startContainer||n!==t.startOffset)&&((q(e)!=q(i)||1==B(e,n,i,r))&&(i=e,r=n),s(t,e,n,i,r))}function c(t,e,n){var i=t.startContainer,r=t.startOffset;(e!==t.endContainer||n!==t.endOffset)&&((q(e)!=q(i)||-1==B(e,n,i,r))&&(i=e,r=n),s(t,i,r,e,n))}var d=function(){};d.prototype=t.rangePrototype,n.prototype=new d,$.extend(n.prototype,{setStart:function(t,e){g(t,!0),v(t,e),a(this,t,e)},setEnd:function(t,e){g(t,!0),v(t,e),c(this,t,e)},setStartAndEnd:function(){var t=arguments,e=t[0],n=t[1],i=e,r=n;switch(t.length){case 3:r=t[2];break;case 4:i=t[2],r=t[3]}s(this,e,n,i,r)},setBoundary:function(t,e,n){this["set"+(n?"Start":"End")](t,e)},setStartBefore:o(!0,!0),setStartAfter:o(!1,!0),setEndBefore:o(!0,!1),setEndAfter:o(!1,!1),collapse:function(t){C(this),t?s(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):s(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(t){g(t,!0),s(this,t,0,t,H(t))},selectNode:function(t){g(t,!1),m(t,G);var e=i(t),n=r(t);s(this,e.node,e.offset,n.node,n.offset)},extractContents:O(u,s),deleteContents:O(l,s),canSurroundContents:function(){C(this),y(this.startContainer),y(this.endContainer);var t=new f(this,!0),n=t._first&&e(t._first,this)||t._last&&e(t._last,this);return t.detach(),!n},splitBoundaries:function(){k(this)},splitBoundariesPreservingPositions:function(t){k(this,t)},normalizeBoundaries:function(){C(this);var t=this.startContainer,e=this.startOffset,n=this.endContainer,i=this.endOffset,r=function(t){var e=t.nextSibling;e&&e.nodeType==t.nodeType&&(n=t,i=t.length,t.appendData(e.data),e.parentNode.removeChild(e))},o=function(r){var s=r.previousSibling;if(s&&s.nodeType==r.nodeType){t=r;var o=r.length;if(e=s.length,r.insertData(0,s.data),s.parentNode.removeChild(s),t==n)i+=e,n=t;else if(n==r.parentNode){var a=j(r);i==a?(n=r,i=o):i>a&&i--}}},a=!0;if(M(n))n.length==i&&r(n);else{if(i>0){var c=n.childNodes[i-1];c&&M(c)&&r(c)}a=!this.collapsed}if(a){if(M(t))0==e&&o(t);else if(e<t.childNodes.length){var l=t.childNodes[e];l&&M(l)&&o(l)}}else t=n,e=i;s(this,t,e,n,i)},collapseToPoint:function(t,e){g(t,!0),v(t,e),this.setStartAndEnd(t,e)}}),I(n)}function N(t){t.collapsed=t.startContainer===t.endContainer&&t.startOffset===t.endOffset,t.commonAncestorContainer=t.collapsed?t.startContainer:R.getCommonAncestor(t.startContainer,t.endContainer)}function L(t,e,n,i,r){t.startContainer=e,t.startOffset=n,t.endContainer=i,t.endOffset=r,t.document=R.getDocument(e),N(t)}function A(t){this.startContainer=t,this.startOffset=0,this.endContainer=t,this.endOffset=0,this.document=t,N(this)}var R=t.dom,$=t.util,D=R.DomPosition,P=t.DOMException,M=R.isCharacterDataNode,j=R.getNodeIndex,F=R.isOrIsAncestorOf,z=R.getDocument,B=R.comparePoints,U=R.splitDataNode,Y=R.getClosestAncestorIn,H=R.getNodeLength,W=R.arrayContains,q=R.getRootContainer,V=t.features.crashyTextNodes;f.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var t=this._current=this._next;return t&&(this._next=t!==this._last?t.nextSibling:null,M(t)&&this.clonePartiallySelectedTextNodes&&(t===this.ec&&(t=t.cloneNode(!0)).deleteData(this.eo,t.length-this.eo),this._current===this.sc&&(t=t.cloneNode(!0)).deleteData(0,this.so))),t},remove:function(){var t,e,n=this._current;!M(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(t=n===this.sc?this.so:0,e=n===this.ec?this.eo:n.length,t!=e&&n.deleteData(t,e-t))},isPartiallySelectedSubtree:function(){var t=this._current;return e(t,this.range)},getSubtreeIterator:function(){var t;if(this.isSingleCharacterDataNode)t=this.range.cloneRange(),t.collapse(!1);else{t=new A(n(this.range));var e=this._current,i=e,r=0,s=e,o=H(e);F(e,this.sc)&&(i=this.sc,r=this.so),F(e,this.ec)&&(s=this.ec,o=this.eo),L(t,i,r,s,o)}return new f(t,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var G=[1,3,4,5,7,8,10],Q=[2,9,11],K=[5,6,10,12],X=[1,3,4,5,7,8,10,11],Z=[1,3,4,5,7,8],J=p([9,11]),te=p(K),ee=p([6,10,12]),ne=document.createElement("style"),ie=!1;try{ne.innerHTML="<b>x</b>",ie=3==ne.firstChild.nodeType}catch(re){}t.features.htmlParsingConforms=ie;var se=ie?function(t){var e=this.startContainer,n=z(e);if(!e)throw new P("INVALID_STATE_ERR");var i=null;return 1==e.nodeType?i=e:M(e)&&(i=R.parentElement(e)),i=null===i||"HTML"==i.nodeName&&R.isHtmlNamespace(z(i).documentElement)&&R.isHtmlNamespace(i)?n.createElement("body"):i.cloneNode(!1),i.innerHTML=t,R.fragmentFromNodeChildren(i)}:function(t){var e=n(this),i=e.createElement("body");return i.innerHTML=t,R.fragmentFromNodeChildren(i)},oe=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ae=0,ce=1,le=2,ue=3,de=0,he=1,fe=2,pe=3;$.extend(t.rangePrototype,{compareBoundaryPoints:function(t,e){C(this),b(this.startContainer,e.startContainer);var n,i,r,s,o=t==ue||t==ae?"start":"end",a=t==ce||t==ae?"start":"end";return n=this[o+"Container"],i=this[o+"Offset"],r=e[a+"Container"],s=e[a+"Offset"],B(n,i,r,s)},insertNode:function(t){if(C(this),m(t,X),y(this.startContainer),F(t,this.startContainer))throw new P("HIERARCHY_REQUEST_ERR");var e=s(t,this.startContainer,this.startOffset);this.setStartBefore(e)},cloneContents:function(){C(this);var t,e;if(this.collapsed)return n(this).createDocumentFragment();if(this.startContainer===this.endContainer&&M(this.startContainer))return t=this.startContainer.cloneNode(!0),t.data=t.data.slice(this.startOffset,this.endOffset),e=n(this).createDocumentFragment(),e.appendChild(t),e;var i=new f(this,!0);return t=a(i),i.detach(),t},canSurroundContents:function(){C(this),y(this.startContainer),y(this.endContainer);var t=new f(this,!0),n=t._first&&e(t._first,this)||t._last&&e(t._last,this);return t.detach(),!n},surroundContents:function(t){if(m(t,Z),!this.canSurroundContents())throw new P("INVALID_STATE_ERR");var e=this.extractContents();if(t.hasChildNodes())for(;t.lastChild;)t.removeChild(t.lastChild);s(t,this.startContainer,this.startOffset),t.appendChild(e),this.selectNode(t)},cloneRange:function(){C(this);for(var t,e=new A(n(this)),i=oe.length;i--;)t=oe[i],e[t]=this[t];return e},toString:function(){C(this);var t=this.startContainer;if(t===this.endContainer&&M(t))return 3==t.nodeType||4==t.nodeType?t.data.slice(this.startOffset,this.endOffset):"";var e=[],n=new f(this,!0);return c(n,function(t){(3==t.nodeType||4==t.nodeType)&&e.push(t.data)}),n.detach(),e.join("")},compareNode:function(t){C(this);var e=t.parentNode,n=j(t);if(!e)throw new P("NOT_FOUND_ERR");var i=this.comparePoint(e,n),r=this.comparePoint(e,n+1);return 0>i?r>0?fe:de:r>0?he:pe},comparePoint:function(t,e){return C(this),_(t,"HIERARCHY_REQUEST_ERR"),b(t,this.startContainer),B(t,e,this.startContainer,this.startOffset)<0?-1:B(t,e,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:se,toHtml:function(){C(this);var t=this.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(this.cloneContents()),t.innerHTML},intersectsNode:function(t,e){if(C(this),_(t,"NOT_FOUND_ERR"),z(t)!==n(this))return!1;var i=t.parentNode,r=j(t);_(i,"NOT_FOUND_ERR");var s=B(i,r,this.endContainer,this.endOffset),o=B(i,r+1,this.startContainer,this.startOffset);return e?0>=s&&o>=0:0>s&&o>0},isPointInRange:function(t,e){return C(this),_(t,"HIERARCHY_REQUEST_ERR"),b(t,this.startContainer),B(t,e,this.startContainer,this.startOffset)>=0&&B(t,e,this.endContainer,this.endOffset)<=0},intersectsRange:function(t){return o(this,t,!1)},intersectsOrTouchesRange:function(t){return o(this,t,!0)},intersection:function(t){if(this.intersectsRange(t)){var e=B(this.startContainer,this.startOffset,t.startContainer,t.startOffset),n=B(this.endContainer,this.endOffset,t.endContainer,t.endOffset),i=this.cloneRange();return-1==e&&i.setStart(t.startContainer,t.startOffset),1==n&&i.setEnd(t.endContainer,t.endOffset),i}return null},union:function(t){if(this.intersectsOrTouchesRange(t)){var e=this.cloneRange();return-1==B(t.startContainer,t.startOffset,this.startContainer,this.startOffset)&&e.setStart(t.startContainer,t.startOffset),1==B(t.endContainer,t.endOffset,this.endContainer,this.endOffset)&&e.setEnd(t.endContainer,t.endOffset),e}throw new P("Ranges do not intersect")},containsNode:function(t,e){return e?this.intersectsNode(t,!1):this.compareNode(t)==pe},containsNodeContents:function(t){return this.comparePoint(t,0)>=0&&this.comparePoint(t,H(t))<=0},containsRange:function(t){var e=this.intersection(t);return null!==e&&t.equals(e)},containsNodeText:function(t){var e=this.cloneRange();e.selectNode(t);var n=e.getNodes([3]);if(n.length>0){e.setStart(n[0],0);var i=n.pop();return e.setEnd(i,i.length),this.containsRange(e)}return this.containsNodeContents(t)},getNodes:function(t,e){return C(this),d(this,t,e)},getDocument:function(){return n(this)},collapseBefore:function(t){this.setEndBefore(t),this.collapse(!1)},collapseAfter:function(t){this.setStartAfter(t),this.collapse(!0)},getBookmark:function(e){var i=n(this),r=t.createRange(i);e=e||R.getBody(i),r.selectNodeContents(e);var s=this.intersection(r),o=0,a=0;return s&&(r.setEnd(s.startContainer,s.startOffset),o=r.toString().length,a=o+s.toString().length),{start:o,end:a,containerNode:e}},moveToBookmark:function(t){var e=t.containerNode,n=0;this.setStart(e,0),this.collapse(!0);for(var i,r,s,o,a=[e],c=!1,l=!1;!l&&(i=a.pop());)if(3==i.nodeType)r=n+i.length,!c&&t.start>=n&&t.start<=r&&(this.setStart(i,t.start-n),c=!0),c&&t.end>=n&&t.end<=r&&(this.setEnd(i,t.end-n),l=!0),n=r;else for(o=i.childNodes,s=o.length;s--;)a.push(o[s])},getName:function(){return"DomRange"},equals:function(t){return A.rangesEqual(this,t)},isValid:function(){return S(this)},inspect:function(){return h(this)},detach:function(){}}),E(A,L),$.extend(A,{rangeProperties:oe,RangeIterator:f,copyComparisonConstants:I,createPrototypeRange:E,inspect:h,getRangeDocument:n,rangesEqual:function(t,e){return t.startContainer===e.startContainer&&t.startOffset===e.startOffset&&t.endContainer===e.endContainer&&t.endOffset===e.endOffset}}),t.DomRange=A}),rangy.createCoreModule("WrappedRange",["DomRange"],function(t,e){var n,i,r=t.dom,s=t.util,o=r.DomPosition,a=t.DomRange,c=r.getBody,l=r.getContentDocument,u=r.isCharacterDataNode;if(t.features.implementsDomRange&&!function(){function i(t){for(var e,n=h.length;n--;)e=h[n],t[e]=t.nativeRange[e];t.collapsed=t.startContainer===t.endContainer&&t.startOffset===t.endOffset}function o(t,e,n,i,r){var s=t.startContainer!==e||t.startOffset!=n,o=t.endContainer!==i||t.endOffset!=r,a=!t.equals(t.nativeRange);(s||o||a)&&(t.setEnd(i,r),t.setStart(e,n))}var u,d,h=a.rangeProperties;n=function(t){if(!t)throw e.createError("WrappedRange: Range must be specified");this.nativeRange=t,i(this)},a.createPrototypeRange(n,o),u=n.prototype,u.selectNode=function(t){this.nativeRange.selectNode(t),i(this)},u.cloneContents=function(){return this.nativeRange.cloneContents()},u.surroundContents=function(t){this.nativeRange.surroundContents(t),i(this)},u.collapse=function(t){this.nativeRange.collapse(t),i(this)},u.cloneRange=function(){return new n(this.nativeRange.cloneRange())},u.refresh=function(){i(this)},u.toString=function(){return this.nativeRange.toString()};var f=document.createTextNode("test");c(document).appendChild(f);var p=document.createRange();p.setStart(f,0),p.setEnd(f,0);try{p.setStart(f,1),u.setStart=function(t,e){this.nativeRange.setStart(t,e),i(this)},u.setEnd=function(t,e){this.nativeRange.setEnd(t,e),i(this)},d=function(t){return function(e){this.nativeRange[t](e),i(this)}}}catch(g){u.setStart=function(t,e){try{this.nativeRange.setStart(t,e)}catch(n){this.nativeRange.setEnd(t,e),this.nativeRange.setStart(t,e)}i(this)},u.setEnd=function(t,e){try{this.nativeRange.setEnd(t,e)}catch(n){this.nativeRange.setStart(t,e),this.nativeRange.setEnd(t,e)}i(this)},d=function(t,e){return function(n){try{this.nativeRange[t](n)}catch(r){this.nativeRange[e](n),this.nativeRange[t](n)}i(this)}}}u.setStartBefore=d("setStartBefore","setEndBefore"),u.setStartAfter=d("setStartAfter","setEndAfter"),u.setEndBefore=d("setEndBefore","setStartBefore"),u.setEndAfter=d("setEndAfter","setStartAfter"),u.selectNodeContents=function(t){this.setStartAndEnd(t,0,r.getNodeLength(t))},p.selectNodeContents(f),p.setEnd(f,3);var m=document.createRange();m.selectNodeContents(f),m.setEnd(f,4),m.setStart(f,2),u.compareBoundaryPoints=-1==p.compareBoundaryPoints(p.START_TO_END,m)&&1==p.compareBoundaryPoints(p.END_TO_START,m)?function(t,e){return e=e.nativeRange||e,t==e.START_TO_END?t=e.END_TO_START:t==e.END_TO_START&&(t=e.START_TO_END),this.nativeRange.compareBoundaryPoints(t,e)}:function(t,e){return this.nativeRange.compareBoundaryPoints(t,e.nativeRange||e)};var v=document.createElement("div");v.innerHTML="123";var b=v.firstChild,y=c(document);y.appendChild(v),p.setStart(b,1),p.setEnd(b,2),p.deleteContents(),"13"==b.data&&(u.deleteContents=function(){this.nativeRange.deleteContents(),i(this)},u.extractContents=function(){var t=this.nativeRange.extractContents();return i(this),t}),y.removeChild(v),y=null,s.isHostMethod(p,"createContextualFragment")&&(u.createContextualFragment=function(t){return this.nativeRange.createContextualFragment(t)}),c(document).removeChild(f),u.getName=function(){return"WrappedRange"},t.WrappedRange=n,t.createNativeRange=function(t){return t=l(t,e,"createNativeRange"),t.createRange()}}(),t.features.implementsTextRange){var d=function(t){var e=t.parentElement(),n=t.duplicate();n.collapse(!0);var i=n.parentElement();n=t.duplicate(),n.collapse(!1);var s=n.parentElement(),o=i==s?i:r.getCommonAncestor(i,s);return o==e?o:r.getCommonAncestor(e,o)},h=function(t){return 0==t.compareEndPoints("StartToEnd",t)},f=function(t,e,n,i,s){var a=t.duplicate();a.collapse(n);var c=a.parentElement();if(r.isOrIsAncestorOf(e,c)||(c=e),!c.canHaveHTML){var l=new o(c.parentNode,r.getNodeIndex(c));return{boundaryPosition:l,nodeInfo:{nodeIndex:l.offset,containerElement:l.node}}}var d=r.getDocument(c).createElement("span");d.parentNode&&d.parentNode.removeChild(d);for(var h,f,p,g,m,v=n?"StartToStart":"StartToEnd",b=s&&s.containerElement==c?s.nodeIndex:0,y=c.childNodes.length,_=y,w=_;;){if(w==y?c.appendChild(d):c.insertBefore(d,c.childNodes[w]),a.moveToElementText(d),h=a.compareEndPoints(v,t),0==h||b==_)break;if(-1==h){if(_==b+1)break;b=w}else _=_==b+1?b:w;w=Math.floor((b+_)/2),c.removeChild(d)}if(m=d.nextSibling,-1==h&&m&&u(m)){a.setEndPoint(n?"EndToStart":"EndToEnd",t);var x;if(/[\r\n]/.test(m.data)){var S=a.duplicate(),C=S.text.replace(/\r\n/g,"\r").length;for(x=S.moveStart("character",C);-1==(h=S.compareEndPoints("StartToEnd",S));)x++,S.moveStart("character",1)}else x=a.text.length;g=new o(m,x)}else f=(i||!n)&&d.previousSibling,p=(i||n)&&d.nextSibling,g=p&&u(p)?new o(p,0):f&&u(f)?new o(f,f.data.length):new o(c,r.getNodeIndex(d));return d.parentNode.removeChild(d),{boundaryPosition:g,nodeInfo:{nodeIndex:w,containerElement:c}}},p=function(t,e){var n,i,s,o,a=t.offset,l=r.getDocument(t.node),d=c(l).createTextRange(),h=u(t.node);return h?(n=t.node,i=n.parentNode):(o=t.node.childNodes,n=a<o.length?o[a]:null,i=t.node),s=l.createElement("span"),s.innerHTML="&#feff;",n?i.insertBefore(s,n):i.appendChild(s),d.moveToElementText(s),d.collapse(!e),i.removeChild(s),h&&d[e?"moveStart":"moveEnd"]("character",a),d};if(i=function(t){this.textRange=t,this.refresh()},i.prototype=new a(document),i.prototype.refresh=function(){var t,e,n,i=d(this.textRange);h(this.textRange)?e=t=f(this.textRange,i,!0,!0).boundaryPosition:(n=f(this.textRange,i,!0,!1),t=n.boundaryPosition,e=f(this.textRange,i,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(t.node,t.offset),this.setEnd(e.node,e.offset)},i.prototype.getName=function(){return"WrappedTextRange"},a.copyComparisonConstants(i),i.rangeToTextRange=function(t){if(t.collapsed)return p(new o(t.startContainer,t.startOffset),!0);var e=p(new o(t.startContainer,t.startOffset),!0),n=p(new o(t.endContainer,t.endOffset),!1),i=c(a.getRangeDocument(t)).createTextRange();return i.setEndPoint("StartToStart",e),i.setEndPoint("EndToEnd",n),i},t.WrappedTextRange=i,!t.features.implementsDomRange||t.config.preferTextRange){var g=function(){return this}();"undefined"==typeof g.Range&&(g.Range=i),t.createNativeRange=function(t){return t=l(t,e,"createNativeRange"),c(t).createTextRange()},t.WrappedRange=i}}t.createRange=function(n){return n=l(n,e,"createRange"),new t.WrappedRange(t.createNativeRange(n))},t.createRangyRange=function(t){return t=l(t,e,"createRangyRange"),new a(t)},t.createIframeRange=function(n){return e.deprecationNotice("createIframeRange()","createRange(iframeEl)"),t.createRange(n)},t.createIframeRangyRange=function(n){return e.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),t.createRangyRange(n)},t.addCreateMissingNativeApiListener(function(e){var n=e.document;"undefined"==typeof n.createRange&&(n.createRange=function(){return t.createRange(n)}),n=e=null})}),rangy.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(t,e){function n(t){return"string"==typeof t?/^backward(s)?$/i.test(t):!!t
}function i(t,n){if(t){if(O.isWindow(t))return t;if(t instanceof v)return t.win;var i=O.getContentDocument(t,e,n);return O.getWindow(i)}return window}function r(t){return i(t,"getWinSelection").getSelection()}function s(t){return i(t,"getDocSelection").document.selection}function o(t){var e=!1;return t.anchorNode&&(e=1==O.comparePoints(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)),e}function a(t,e,n){var i=n?"end":"start",r=n?"start":"end";t.anchorNode=e[i+"Container"],t.anchorOffset=e[i+"Offset"],t.focusNode=e[r+"Container"],t.focusOffset=e[r+"Offset"]}function c(t){var e=t.nativeSelection;t.anchorNode=e.anchorNode,t.anchorOffset=e.anchorOffset,t.focusNode=e.focusNode,t.focusOffset=e.focusOffset}function l(t){t.anchorNode=t.focusNode=null,t.anchorOffset=t.focusOffset=0,t.rangeCount=0,t.isCollapsed=!0,t._ranges.length=0}function u(e){var n;return e instanceof L?(n=t.createNativeRange(e.getDocument()),n.setEnd(e.endContainer,e.endOffset),n.setStart(e.startContainer,e.startOffset)):e instanceof A?n=e.nativeRange:D.implementsDomRange&&e instanceof O.getWindow(e.startContainer).Range&&(n=e),n}function d(t){if(!t.length||1!=t[0].nodeType)return!1;for(var e=1,n=t.length;n>e;++e)if(!O.isAncestorOf(t[0],t[e]))return!1;return!0}function h(t){var n=t.getNodes();if(!d(n))throw e.createError("getSingleElementFromRange: range "+t.inspect()+" did not consist of a single element");return n[0]}function f(t){return!!t&&"undefined"!=typeof t.text}function p(t,e){var n=new A(e);t._ranges=[n],a(t,n,!1),t.rangeCount=1,t.isCollapsed=n.collapsed}function g(e){if(e._ranges.length=0,"None"==e.docSelection.type)l(e);else{var n=e.docSelection.createRange();if(f(n))p(e,n);else{e.rangeCount=n.length;for(var i,r=M(n.item(0)),s=0;s<e.rangeCount;++s)i=t.createRange(r),i.selectNode(n.item(s)),e._ranges.push(i);e.isCollapsed=1==e.rangeCount&&e._ranges[0].collapsed,a(e,e._ranges[e.rangeCount-1],!1)}}}function m(t,n){for(var i=t.docSelection.createRange(),r=h(n),s=M(i.item(0)),o=j(s).createControlRange(),a=0,c=i.length;c>a;++a)o.add(i.item(a));try{o.add(r)}catch(l){throw e.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}o.select(),g(t)}function v(t,e,n){this.nativeSelection=t,this.docSelection=e,this._ranges=[],this.win=n,this.refresh()}function b(t){t.win=t.anchorNode=t.focusNode=t._ranges=null,t.rangeCount=t.anchorOffset=t.focusOffset=0,t.detached=!0}function y(t,e){for(var n,i,r=ee.length;r--;)if(n=ee[r],i=n.selection,"deleteAll"==e)b(i);else if(n.win==t)return"delete"==e?(ee.splice(r,1),!0):i;return"deleteAll"==e&&(ee.length=0),null}function _(t,n){for(var i,r=M(n[0].startContainer),s=j(r).createControlRange(),o=0,a=n.length;a>o;++o){i=h(n[o]);try{s.add(i)}catch(c){throw e.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}s.select(),g(t)}function w(t,e){if(t.win.document!=M(e))throw new R("WRONG_DOCUMENT_ERR")}function x(e){return function(n,i){var r;this.rangeCount?(r=this.getRangeAt(0),r["set"+(e?"Start":"End")](n,i)):(r=t.createRange(this.win.document),r.setStartAndEnd(n,i)),this.setSingleRange(r,this.isBackward())}}function S(t){var e=[],n=new $(t.anchorNode,t.anchorOffset),i=new $(t.focusNode,t.focusOffset),r="function"==typeof t.getName?t.getName():"Selection";if("undefined"!=typeof t.rangeCount)for(var s=0,o=t.rangeCount;o>s;++s)e[s]=L.inspect(t.getRangeAt(s));return"["+r+"(Ranges: "+e.join(", ")+")(anchor: "+n.inspect()+", focus: "+i.inspect()+"]"}t.config.checkSelectionRanges=!0;var C,k,T="boolean",I="number",O=t.dom,E=t.util,N=E.isHostMethod,L=t.DomRange,A=t.WrappedRange,R=t.DOMException,$=O.DomPosition,D=t.features,P="Control",M=O.getDocument,j=O.getBody,F=L.rangesEqual,z=N(window,"getSelection"),B=E.isHostObject(document,"selection");D.implementsWinGetSelection=z,D.implementsDocSelection=B;var U=B&&(!z||t.config.preferTextRange);U?(C=s,t.isSelectionValid=function(t){var e=i(t,"isSelectionValid").document,n=e.selection;return"None"!=n.type||M(n.createRange().parentElement())==e}):z?(C=r,t.isSelectionValid=function(){return!0}):e.fail("Neither document.selection or window.getSelection() detected."),t.getNativeSelection=C;var Y=C(),H=t.createNativeRange(document),W=j(document),q=E.areHostProperties(Y,["anchorNode","focusNode","anchorOffset","focusOffset"]);D.selectionHasAnchorAndFocus=q;var V=N(Y,"extend");D.selectionHasExtend=V;var G=typeof Y.rangeCount==I;D.selectionHasRangeCount=G;var Q=!1,K=!0,X=V?function(e,n){var i=L.getRangeDocument(n),r=t.createRange(i);r.collapseToPoint(n.endContainer,n.endOffset),e.addRange(u(r)),e.extend(n.startContainer,n.startOffset)}:null;E.areHostMethods(Y,["addRange","getRangeAt","removeAllRanges"])&&typeof Y.rangeCount==I&&D.implementsDomRange&&!function(){var e=window.getSelection();if(e){for(var n=e.rangeCount,i=[],r=o(e),s=0;n>s;++s)i[s]=e.getRangeAt(s);var a=j(document),c=a.appendChild(document.createElement("div"));c.contentEditable="false";var l=c.appendChild(document.createTextNode("   ")),u=document.createRange();for(u.setStart(l,1),u.collapse(!0),e.addRange(u),K=1==e.rangeCount,e.removeAllRanges(),a.removeChild(c),e.removeAllRanges(),s=0;n>s;++s)0==s&&r?X?X(e,i[s]):(t.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),e.addRange(i[s])):e.addRange(i[s])}}(),D.selectionSupportsMultipleRanges=Q,D.collapsedNonEditableSelectionsSupported=K;var Z,J=!1;W&&N(W,"createControlRange")&&(Z=W.createControlRange(),E.areHostProperties(Z,["item","add"])&&(J=!0)),D.implementsControlRange=J,k=q?function(t){return t.anchorNode===t.focusNode&&t.anchorOffset===t.focusOffset}:function(t){return t.rangeCount?t.getRangeAt(t.rangeCount-1).collapsed:!1};var te;N(Y,"getRangeAt")?te=function(t,e){try{return t.getRangeAt(e)}catch(n){return null}}:q&&(te=function(e){var n=M(e.anchorNode),i=t.createRange(n);return i.setStartAndEnd(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset),i.collapsed!==this.isCollapsed&&i.setStartAndEnd(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset),i}),v.prototype=t.selectionPrototype;var ee=[],ne=function(t){if(t&&t instanceof v)return t.refresh(),t;t=i(t,"getNativeSelection");var e=y(t),n=C(t),r=B?s(t):null;return e?(e.nativeSelection=n,e.docSelection=r,e.refresh()):(e=new v(n,r,t),ee.push({win:t,selection:e})),e};t.getSelection=ne,t.getIframeSelection=function(n){return e.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),t.getSelection(O.getIframeWindow(n))};var ie=v.prototype;if(!U&&q&&E.areHostMethods(Y,["removeAllRanges","addRange"])){ie.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),l(this)};var re=function(t,e){X(t.nativeSelection,e),t.refresh()};ie.addRange=G?function(e,i){if(J&&B&&this.docSelection.type==P)m(this,e);else if(n(i)&&V)re(this,e);else{var r;if(Q?r=this.rangeCount:(this.removeAllRanges(),r=0),this.nativeSelection.addRange(u(e).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==r+1){if(t.config.checkSelectionRanges){var s=te(this.nativeSelection,this.rangeCount-1);s&&!F(s,e)&&(e=new A(s))}this._ranges[this.rangeCount-1]=e,a(this,e,ae(this.nativeSelection)),this.isCollapsed=k(this)}else this.refresh()}}:function(t,e){n(e)&&V?re(this,t):(this.nativeSelection.addRange(u(t)),this.refresh())},ie.setRanges=function(t){if(J&&t.length>1)_(this,t);else{this.removeAllRanges();for(var e=0,n=t.length;n>e;++e)this.addRange(t[e])}}}else{if(!(N(Y,"empty")&&N(H,"select")&&J&&U))return e.fail("No means of selecting a Range or TextRange was found"),!1;ie.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var t;if(this.anchorNode)t=M(this.anchorNode);else if(this.docSelection.type==P){var e=this.docSelection.createRange();e.length&&(t=M(e.item(0)))}if(t){var n=j(t).createTextRange();n.select(),this.docSelection.empty()}}}catch(i){}l(this)},ie.addRange=function(e){this.docSelection.type==P?m(this,e):(t.WrappedTextRange.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,a(this,e,!1))},ie.setRanges=function(t){this.removeAllRanges();var e=t.length;e>1?_(this,t):e&&this.addRange(t[0])}}ie.getRangeAt=function(t){if(0>t||t>=this.rangeCount)throw new R("INDEX_SIZE_ERR");return this._ranges[t].cloneRange()};var se;if(U)se=function(e){var n;t.isSelectionValid(e.win)?n=e.docSelection.createRange():(n=j(e.win.document).createTextRange(),n.collapse(!0)),e.docSelection.type==P?g(e):f(n)?p(e,n):l(e)};else if(N(Y,"getRangeAt")&&typeof Y.rangeCount==I)se=function(e){if(J&&B&&e.docSelection.type==P)g(e);else if(e._ranges.length=e.rangeCount=e.nativeSelection.rangeCount,e.rangeCount){for(var n=0,i=e.rangeCount;i>n;++n)e._ranges[n]=new t.WrappedRange(e.nativeSelection.getRangeAt(n));a(e,e._ranges[e.rangeCount-1],ae(e.nativeSelection)),e.isCollapsed=k(e)}else l(e)};else{if(!q||typeof Y.isCollapsed!=T||typeof H.collapsed!=T||!D.implementsDomRange)return e.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;se=function(t){var e,n=t.nativeSelection;n.anchorNode?(e=te(n,0),t._ranges=[e],t.rangeCount=1,c(t),t.isCollapsed=k(t)):l(t)}}ie.refresh=function(t){var e=t?this._ranges.slice(0):null,n=this.anchorNode,i=this.anchorOffset;if(se(this),t){var r=e.length;if(r!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=i)return!0;for(;r--;)if(!F(e[r],this._ranges[r]))return!0;return!1}};var oe=function(t,e){var n=t.getAllRanges();t.removeAllRanges();for(var i=0,r=n.length;r>i;++i)F(e,n[i])||t.addRange(n[i]);t.rangeCount||l(t)};ie.removeRange=J?function(t){if(this.docSelection.type==P){for(var e,n=this.docSelection.createRange(),i=h(t),r=M(n.item(0)),s=j(r).createControlRange(),o=!1,a=0,c=n.length;c>a;++a)e=n.item(a),e!==i||o?s.add(n.item(a)):o=!0;s.select(),g(this)}else oe(this,t)}:function(t){oe(this,t)};var ae;!U&&q&&D.implementsDomRange?(ae=o,ie.isBackward=function(){return ae(this)}):ae=ie.isBackward=function(){return!1},ie.isBackwards=ie.isBackward,ie.toString=function(){for(var t=[],e=0,n=this.rangeCount;n>e;++e)t[e]=""+this._ranges[e];return t.join("")},ie.collapse=function(e,n){w(this,e);var i=t.createRange(e);i.collapseToPoint(e,n),this.setSingleRange(i),this.isCollapsed=!0},ie.collapseToStart=function(){if(!this.rangeCount)throw new R("INVALID_STATE_ERR");var t=this._ranges[0];this.collapse(t.startContainer,t.startOffset)},ie.collapseToEnd=function(){if(!this.rangeCount)throw new R("INVALID_STATE_ERR");var t=this._ranges[this.rangeCount-1];this.collapse(t.endContainer,t.endOffset)},ie.selectAllChildren=function(e){w(this,e);var n=t.createRange(e);n.selectNodeContents(e),this.setSingleRange(n)},ie.deleteFromDocument=function(){if(J&&B&&this.docSelection.type==P){for(var t,e=this.docSelection.createRange();e.length;)t=e.item(0),e.remove(t),t.parentNode.removeChild(t);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var i=0,r=n.length;r>i;++i)n[i].deleteContents();this.addRange(n[r-1])}}},ie.eachRange=function(t,e){for(var n=0,i=this._ranges.length;i>n;++n)if(t(this.getRangeAt(n)))return e},ie.getAllRanges=function(){var t=[];return this.eachRange(function(e){t.push(e)}),t},ie.setSingleRange=function(t,e){this.removeAllRanges(),this.addRange(t,e)},ie.callMethodOnEachRange=function(t,e){var n=[];return this.eachRange(function(i){n.push(i[t].apply(i,e))}),n},ie.setStart=x(!0),ie.setEnd=x(!1),t.rangePrototype.select=function(t){ne(this.getDocument()).setSingleRange(this,t)},ie.changeEachRange=function(t){var e=[],n=this.isBackward();this.eachRange(function(n){t(n),e.push(n)}),this.removeAllRanges(),n&&1==e.length?this.addRange(e[0],"backward"):this.setRanges(e)},ie.containsNode=function(t,e){return this.eachRange(function(n){return n.containsNode(t,e)},!0)},ie.getBookmark=function(t){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[t])}},ie.moveToBookmark=function(e){for(var n,i,r=[],s=0;n=e.rangeBookmarks[s++];)i=t.createRange(this.win),i.moveToBookmark(n),r.push(i);e.backward?this.setSingleRange(r[0],"backward"):this.setRanges(r)},ie.toHtml=function(){return this.callMethodOnEachRange("toHtml").join("")},ie.getName=function(){return"WrappedSelection"},ie.inspect=function(){return S(this)},ie.detach=function(){y(this.win,"delete"),b(this)},v.detachAll=function(){y(null,"deleteAll")},v.inspect=S,v.isDirectionBackward=n,t.Selection=v,t.selectionPrototype=ie,t.addCreateMissingNativeApiListener(function(t){"undefined"==typeof t.getSelection&&(t.getSelection=function(){return ne(t)}),t=null})}),/**
 * Text range module for Rangy.
 * Text-based manipulation and searching of ranges and selections.
 *
 * Features
 *
 * - Ability to move range boundaries by character or word offsets
 * - Customizable word tokenizer
 * - Ignores text nodes inside <script> or <style> elements or those hidden by CSS display and visibility properties
 * - Range findText method to search for text or regex within the page or within a range. Flags for whole words and case
 *   sensitivity
 * - Selection and range save/restore as text offsets within a node
 * - Methods to return visible text within a range or selection
 * - innerText method for elements
 *
 * References
 *
 * https://www.w3.org/Bugs/Public/show_bug.cgi?id=13145
 * http://aryeh.name/spec/innertext/innertext.html
 * http://dvcs.w3.org/hg/editing/raw-file/tip/editing.html
 *
 * Part of Rangy, a cross-browser JavaScript range and selection library
 * http://code.google.com/p/rangy/
 *
 * Depends on Rangy core.
 *
 * Copyright 2014, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3alpha.20140716
 * Build date: 16 July 2014
 */
rangy.createModule("TextRange",["WrappedSelection"],function(t,e){function n(t,e){function n(e,n,i){for(var r=t.slice(e,n),s={isWord:i,chars:r,toString:function(){return r.join("")}},o=0,c=r.length;c>o;++o)r[o].token=s;a.push(s)}for(var i,r,s,o=t.join(""),a=[],c=0;i=e.wordRegex.exec(o);){if(r=i.index,s=r+i[0].length,r>c&&n(c,r,!1),e.includeTrailingSpace)for(;K.test(t[s]);)++s;n(r,s,!0),c=s}return c<t.length&&n(c,t.length,!1),a}function i(t,e){if(t){var n={};return W(n,e),W(n,t,!0),n}return e}function r(t){var e,n;return t?(e=t.language||X,n={},W(n,oe[e]||oe[X]),W(n,t),n):oe[X]}function s(t){return i(t,re)}function o(t){return i(t,se)}function a(t){var e=i(t,ae);return e.characterOptions=s(e.wordOptions),e}function c(t,e){var n=de(t,"display",e),i=t.tagName.toLowerCase();return"block"==n&&ie&&he.hasOwnProperty(i)?he[i]:n}function l(t){for(var e=p(t),n=0,i=e.length;i>n;++n)if(1==e[n].nodeType&&"none"==c(e[n]))return!0;return!1}function u(t){var e;return 3==t.nodeType&&(e=t.parentNode)&&"hidden"==de(e,"visibility")}function d(t){return t&&(1==t.nodeType&&!/^(inline(-block|-table)?|none)$/.test(c(t))||9==t.nodeType||11==t.nodeType)}function h(t){return Y.isCharacterDataNode(t)||!/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(t.nodeName)}function f(t){for(var e=[];t.parentNode;)e.unshift(t.parentNode),t=t.parentNode;return e}function p(t){return f(t).concat([t])}function g(t){for(;t&&!t.nextSibling;)t=t.parentNode;return t?t.nextSibling:null}function m(t,e){return!e&&t.hasChildNodes()?t.firstChild:g(t)}function v(t){var e=t.previousSibling;if(e){for(t=e;t.hasChildNodes();)t=t.lastChild;return t}var n=t.parentNode;return n&&1==n.nodeType?n:null}function b(t){if(!t||3!=t.nodeType)return!1;var e=t.data;if(""===e)return!0;var n=t.parentNode;if(!n||1!=n.nodeType)return!1;var i=de(t.parentNode,"whiteSpace");return/^[\t\n\r ]+$/.test(e)&&/^(normal|nowrap)$/.test(i)||/^[\t\r ]+$/.test(e)&&"pre-line"==i}function y(t){if(""===t.data)return!0;if(!b(t))return!1;var e=t.parentNode;return e?l(t)?!0:!1:!0}function _(t){var e=t.nodeType;return 7==e||8==e||l(t)||/^(script|style)$/i.test(t.nodeName)||u(t)||y(t)}function w(t,e){var n=t.nodeType;return 7==n||8==n||1==n&&"none"==c(t,e)}function x(){this.store={}}function S(t,e,n){return function(i){var r=this.cache;if(r.hasOwnProperty(t))return fe++,r[t];pe++;var s=e.call(this,n?this[n]:this,i);return r[t]=s,s}}function C(t,e){this.node=t,this.session=e,this.cache=new x,this.positions=new x}function k(t,e){this.offset=e,this.nodeWrapper=t,this.node=t.node,this.session=t.session,this.cache=new x}function T(){return"[Position("+Y.inspectNode(this.node)+":"+this.offset+")]"}function I(){return E(),Te=new Ie}function O(){return Te||I()}function E(){Te&&Te.detach(),Te=null}function N(t,n,i,r){function s(){var t=null;return n?(t=a,c||(a=a.previousVisible(),c=!a||i&&a.equals(i))):c||(t=a=a.nextVisible(),c=!a||i&&a.equals(i)),c&&(a=null),t}i&&(n?_(i.node)&&(i=t.previousVisible()):_(i.node)&&(i=i.nextVisible()));var o,a=t,c=!1,l=!1;return{next:function(){if(l)return l=!1,o;for(var t,e;t=s();)if(e=t.getCharacter(r))return o=t,t;return null},rewind:function(){if(!o)throw e.createError("createCharacterIterator: cannot rewind. Only one position can be rewound.");l=!0},dispose:function(){t=i=null}}}function L(t,e,n){function i(t){for(var e,n,i=[],o=t?r:s,a=!1,c=!1;e=o.next();){if(n=e.character,Q.test(n))c&&(c=!1,a=!0);else{if(a){o.rewind();break}c=!0}i.push(e)}return i}var r=N(t,!1,null,e),s=N(t,!0,null,e),o=n.tokenizer,a=i(!0),c=i(!1).reverse(),l=o(c.concat(a),n),u=a.length?l.slice(Oe(l,a[0].token)):[],d=c.length?l.slice(0,Oe(l,c.pop().token)+1):[];return{nextEndToken:function(){for(var t,e;1==u.length&&!(t=u[0]).isWord&&(e=i(!0)).length>0;)u=o(t.chars.concat(e),n);return u.shift()},previousStartToken:function(){for(var t,e;1==d.length&&!(t=d[0]).isWord&&(e=i(!1)).length>0;)d=o(e.reverse().concat(t.chars),n);return d.pop()},dispose:function(){r.dispose(),s.dispose(),u=d=null}}}function A(t,e,n,i,r){var s,o,a,c,l=0,u=t,d=Math.abs(n);if(0!==n){var h=0>n;switch(e){case B:for(o=N(t,h,null,i);(s=o.next())&&d>l;)++l,u=s;a=s,o.dispose();break;case U:for(var f=L(t,i,r),p=h?f.previousStartToken:f.nextEndToken;(c=p())&&d>l;)c.isWord&&(++l,u=h?c.chars[0]:c.chars[c.chars.length-1]);break;default:throw new Error("movePositionBy: unit '"+e+"' not implemented")}h?(u=u.previousVisible(),l=-l):u&&u.isLeadingSpace&&(e==U&&(o=N(t,!1,null,i),a=o.next(),o.dispose()),a&&(u=a.previousVisible()))}return{position:u,unitsMoved:l}}function R(t,e,n,i){var r=t.getRangeBoundaryPosition(e,!0),s=t.getRangeBoundaryPosition(e,!1),o=i?s:r,a=i?r:s;return N(o,!!i,a,n)}function $(t,e,n){for(var i,r=[],s=R(t,e,n);i=s.next();)r.push(i);return s.dispose(),r}function D(e,n,i){var r=t.createRange(e.node);r.setStartAndEnd(e.node,e.offset,n.node,n.offset);var s=!r.expand("word",i);return s}function P(t,e,n,i,r){function s(t,e){var n=g[t].previousVisible(),i=g[e-1],s=!r.wholeWordsOnly||D(n,i,r.wordOptions);return{startPos:n,endPos:i,valid:s}}for(var o,a,c,l,u,d,h=Z(r.direction),f=N(t,h,t.session.getRangeBoundaryPosition(i,h),r.characterOptions),p="",g=[],m=null;o=f.next();)if(a=o.character,n||r.caseSensitive||(a=a.toLowerCase()),h?(g.unshift(o),p=a+p):(g.push(o),p+=a),n){if(u=e.exec(p))if(d){if(c=u.index,l=c+u[0].length,!h&&l<p.length||h&&c>0){m=s(c,l);break}}else d=!0}else if(-1!=(c=p.indexOf(e))){m=s(c,c+e.length);break}return d&&(m=s(c,l)),f.dispose(),m}function M(t){return function(){var e=!!Te,n=O(),i=[n].concat(H.toArray(arguments)),r=t.apply(this,i);return e||E(),r}}function j(t,e){return M(function(n,o,a,c){"undefined"==typeof a&&(a=o,o=B),c=i(c,ce);var l=s(c.characterOptions),u=r(c.wordOptions),d=t;e&&(d=a>=0,this.collapse(!d));var h=A(n.getRangeBoundaryPosition(this,d),o,a,l,u),f=h.position;return this[d?"setStart":"setEnd"](f.node,f.offset),h.unitsMoved})}function F(t){return M(function(e,n){n=s(n);for(var i,r=R(e,this,n,!t),o=0;(i=r.next())&&Q.test(i.character);)++o;r.dispose();var a=o>0;return a&&this[t?"moveStart":"moveEnd"]("character",t?o:-o,{characterOptions:n}),a})}function z(t){return M(function(e,n){var i=!1;return this.changeEachRange(function(e){i=e[t](n)||i}),i})}var B="character",U="word",Y=t.dom,H=t.util,W=H.extend,q=Y.getBody,V=/^[ \t\f\r\n]+$/,G=/^[ \t\f\r]+$/,Q=/^[\t-\r \u0085\u00A0\u1680\u180E\u2000-\u200B\u2028\u2029\u202F\u205F\u3000]+$/,K=/^[\t \u00A0\u1680\u180E\u2000-\u200B\u202F\u205F\u3000]+$/,X="en",Z=t.Selection.isDirectionBackward,J=!1,te=!1,ee=!1,ne=!0;!function(){var e=document.createElement("div");e.contentEditable="true",e.innerHTML="<p>1 </p><p></p>";var n=q(document),i=e.firstChild,r=t.getSelection();n.appendChild(e),r.collapse(i.lastChild,2),r.setStart(i.firstChild,0),J=1==(""+r).length,e.innerHTML="1 <br>",r.collapse(e,2),r.setStart(e.firstChild,0),te=1==(""+r).length,e.innerHTML="1 <p>1</p>",r.collapse(e,2),r.setStart(e.firstChild,0),ee=1==(""+r).length,n.removeChild(e),r.removeAllRanges()}();var ie,re={includeBlockContentTrailingSpace:!0,includeSpaceBeforeBr:!0,includeSpaceBeforeBlock:!0,includePreLineTrailingSpace:!0},se={includeBlockContentTrailingSpace:!ne,includeSpaceBeforeBr:!te,includeSpaceBeforeBlock:!ee,includePreLineTrailingSpace:!0},oe={en:{wordRegex:/[a-z0-9]+('[a-z0-9]+)*/gi,includeTrailingSpace:!1,tokenizer:n}},ae={caseSensitive:!1,withinRange:null,wholeWordsOnly:!1,wrap:!1,direction:"forward",wordOptions:null,characterOptions:null},ce={wordOptions:null,characterOptions:null},le={wordOptions:null,characterOptions:null,trim:!1,trimStart:!0,trimEnd:!0},ue={wordOptions:null,characterOptions:null,direction:"forward"},de=Y.getComputedStyleProperty;!function(){var t=document.createElement("table"),e=q(document);e.appendChild(t),ie="block"==de(t,"display"),e.removeChild(t)}(),t.features.tableCssDisplayBlock=ie;var he={table:"table",caption:"table-caption",colgroup:"table-column-group",col:"table-column",thead:"table-header-group",tbody:"table-row-group",tfoot:"table-footer-group",tr:"table-row",td:"table-cell",th:"table-cell"};x.prototype={get:function(t){return this.store.hasOwnProperty(t)?this.store[t]:null},set:function(t,e){return this.store[t]=e}};var fe=0,pe=0,ge={getPosition:function(t){var e=this.positions;return e.get(t)||e.set(t,new k(this,t))},toString:function(){return"[NodeWrapper("+Y.inspectNode(this.node)+")]"}};C.prototype=ge;var me="EMPTY",ve="NON_SPACE",be="UNCOLLAPSIBLE_SPACE",ye="COLLAPSIBLE_SPACE",_e="TRAILING_SPACE_BEFORE_BLOCK",we="TRAILING_SPACE_IN_BLOCK",xe="TRAILING_SPACE_BEFORE_BR",Se="PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK",Ce="TRAILING_LINE_BREAK_AFTER_BR";W(ge,{isCharacterDataNode:S("isCharacterDataNode",Y.isCharacterDataNode,"node"),getNodeIndex:S("nodeIndex",Y.getNodeIndex,"node"),getLength:S("nodeLength",Y.getNodeLength,"node"),containsPositions:S("containsPositions",h,"node"),isWhitespace:S("isWhitespace",b,"node"),isCollapsedWhitespace:S("isCollapsedWhitespace",y,"node"),getComputedDisplay:S("computedDisplay",c,"node"),isCollapsed:S("collapsed",_,"node"),isIgnored:S("ignored",w,"node"),next:S("nextPos",m,"node"),previous:S("previous",v,"node"),getTextNodeInfo:S("textNodeInfo",function(t){var e=null,n=!1,i=de(t.parentNode,"whiteSpace"),r="pre-line"==i;return r?(e=G,n=!0):("normal"==i||"nowrap"==i)&&(e=V,n=!0),{node:t,text:t.data,spaceRegex:e,collapseSpaces:n,preLine:r}},"node"),hasInnerText:S("hasInnerText",function(t,e){for(var n=this.session,i=n.getPosition(t.parentNode,this.getNodeIndex()+1),r=n.getPosition(t,0),s=e?i:r,o=e?r:i;s!==o;){if(s.prepopulateChar(),s.isDefinitelyNonEmpty())return!0;s=e?s.previousVisible():s.nextVisible()}return!1},"node"),isRenderedBlock:S("isRenderedBlock",function(t){for(var e=t.getElementsByTagName("br"),n=0,i=e.length;i>n;++n)if(!_(e[n]))return!0;return this.hasInnerText()},"node"),getTrailingSpace:S("trailingSpace",function(t){if("br"==t.tagName.toLowerCase())return"";switch(this.getComputedDisplay()){case"inline":for(var e=t.lastChild;e;){if(!w(e))return 1==e.nodeType?this.session.getNodeWrapper(e).getTrailingSpace():"";e=e.previousSibling}break;case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":break;case"table-cell":return"	";default:return this.isRenderedBlock(!0)?"\n":""}return""},"node"),getLeadingSpace:S("leadingSpace",function(){switch(this.getComputedDisplay()){case"inline":case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":case"table-cell":break;default:return this.isRenderedBlock(!1)?"\n":""}return""},"node")});var ke={character:"",characterType:me,isBr:!1,prepopulateChar:function(){var t=this;if(!t.prepopulatedChar){var e=t.node,n=t.offset,i="",r=me,s=!1;if(n>0)if(3==e.nodeType){var o=e.data,a=o.charAt(n-1),c=t.nodeWrapper.getTextNodeInfo(),l=c.spaceRegex;c.collapseSpaces?l.test(a)?n>1&&l.test(o.charAt(n-2))||(c.preLine&&"\n"===o.charAt(n)?(i=" ",r=Se):(i=" ",r=ye)):(i=a,r=ve,s=!0):(i=a,r=be,s=!0)}else{var u=e.childNodes[n-1];if(u&&1==u.nodeType&&!_(u)&&("br"==u.tagName.toLowerCase()?(i="\n",t.isBr=!0,r=ye,s=!1):t.checkForTrailingSpace=!0),!i){var d=e.childNodes[n];d&&1==d.nodeType&&!_(d)&&(t.checkForLeadingSpace=!0)}}t.prepopulatedChar=!0,t.character=i,t.characterType=r,t.isCharInvariant=s}},isDefinitelyNonEmpty:function(){var t=this.characterType;return t==ve||t==be},resolveLeadingAndTrailingSpaces:function(){if(this.prepopulatedChar||this.prepopulateChar(),this.checkForTrailingSpace){var t=this.session.getNodeWrapper(this.node.childNodes[this.offset-1]).getTrailingSpace();t&&(this.isTrailingSpace=!0,this.character=t,this.characterType=ye),this.checkForTrailingSpace=!1}if(this.checkForLeadingSpace){var e=this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace();e&&(this.isLeadingSpace=!0,this.character=e,this.characterType=ye),this.checkForLeadingSpace=!1}},getPrecedingUncollapsedPosition:function(t){for(var e,n=this;n=n.previousVisible();)if(e=n.getCharacter(t),""!==e)return n;return null},getCharacter:function(t){function e(){return c||(s=l.getPrecedingUncollapsedPosition(t),c=!0),s}if(this.resolveLeadingAndTrailingSpaces(),this.isCharInvariant)return this.character;var n=["character",t.includeSpaceBeforeBr,t.includeBlockContentTrailingSpace,t.includePreLineTrailingSpace].join("_"),i=this.cache.get(n);if(null!==i)return i;var r,s,o="",a=this.characterType==ye,c=!1,l=this;return a?(" "!=this.character||e()&&!s.isTrailingSpace&&"\n"!=s.character)&&("\n"==this.character&&this.isLeadingSpace?e()&&"\n"!=s.character&&(o="\n"):(r=this.nextUncollapsed(),r&&(r.isBr?this.type=xe:r.isTrailingSpace&&"\n"==r.character?this.type=we:r.isLeadingSpace&&"\n"==r.character&&(this.type=_e),"\n"===r.character?(this.type!=xe||t.includeSpaceBeforeBr)&&(this.type!=_e||t.includeSpaceBeforeBlock)&&(this.type==we&&r.isTrailingSpace&&!t.includeBlockContentTrailingSpace||(this.type!=Se||r.type!=ve||t.includePreLineTrailingSpace)&&("\n"===this.character?r.isTrailingSpace?this.isTrailingSpace||this.isBr&&(r.type=Ce,e()&&s.isLeadingSpace&&"\n"==s.character&&(r.character="")):o="\n":" "===this.character&&(o=" "))):o=this.character))):"\n"===this.character&&(!(r=this.nextUncollapsed())||r.isTrailingSpace),this.cache.set(n,o),o},equals:function(t){return!!t&&this.node===t.node&&this.offset===t.offset},inspect:T,toString:function(){return this.character}};k.prototype=ke,W(ke,{next:S("nextPos",function(t){var e=t.nodeWrapper,n=t.node,i=t.offset,r=e.session;if(!n)return null;var s,o,a;return i==e.getLength()?(s=n.parentNode,o=s?e.getNodeIndex()+1:0):e.isCharacterDataNode()?(s=n,o=i+1):(a=n.childNodes[i],r.getNodeWrapper(a).containsPositions()?(s=a,o=0):(s=n,o=i+1)),s?r.getPosition(s,o):null}),previous:S("previous",function(t){var e,n,i,r=t.nodeWrapper,s=t.node,o=t.offset,a=r.session;return 0==o?(e=s.parentNode,n=e?r.getNodeIndex():0):r.isCharacterDataNode()?(e=s,n=o-1):(i=s.childNodes[o-1],a.getNodeWrapper(i).containsPositions()?(e=i,n=Y.getNodeLength(i)):(e=s,n=o-1)),e?a.getPosition(e,n):null}),nextVisible:S("nextVisible",function(t){var e=t.next();if(!e)return null;var n=e.nodeWrapper,i=e.node,r=e;return n.isCollapsed()&&(r=n.session.getPosition(i.parentNode,n.getNodeIndex()+1)),r}),nextUncollapsed:S("nextUncollapsed",function(t){for(var e=t;e=e.nextVisible();)if(e.resolveLeadingAndTrailingSpaces(),""!==e.character)return e;return null}),previousVisible:S("previousVisible",function(t){var e=t.previous();if(!e)return null;var n=e.nodeWrapper,i=e.node,r=e;return n.isCollapsed()&&(r=n.session.getPosition(i.parentNode,n.getNodeIndex())),r})});var Te=null,Ie=function(){function t(t){var e=new x;return{get:function(n){var i=e.get(n[t]);if(i)for(var r,s=0;r=i[s++];)if(r.node===n)return r;return null},set:function(n){var i=n.node[t],r=e.get(i)||e.set(i,[]);r.push(n)}}}function e(){this.initCaches()}var n=H.isHostProperty(document.documentElement,"uniqueID");return e.prototype={initCaches:function(){this.elementCache=n?function(){var t=new x;return{get:function(e){return t.get(e.uniqueID)},set:function(e){t.set(e.node.uniqueID,e)}}}():t("tagName"),this.textNodeCache=t("data"),this.otherNodeCache=t("nodeName")},getNodeWrapper:function(t){var e;switch(t.nodeType){case 1:e=this.elementCache;break;case 3:e=this.textNodeCache;break;default:e=this.otherNodeCache}var n=e.get(t);return n||(n=new C(t,this),e.set(n)),n},getPosition:function(t,e){return this.getNodeWrapper(t).getPosition(e)},getRangeBoundaryPosition:function(t,e){var n=e?"start":"end";return this.getPosition(t[n+"Container"],t[n+"Offset"])},detach:function(){this.elementCache=this.textNodeCache=this.otherNodeCache=null}},e}();W(Y,{nextNode:m,previousNode:v});var Oe=Array.prototype.indexOf?function(t,e){return t.indexOf(e)}:function(t,e){for(var n=0,i=t.length;i>n;++n)if(t[n]===e)return n;return-1};W(t.rangePrototype,{moveStart:j(!0,!1),moveEnd:j(!1,!1),move:j(!0,!0),trimStart:F(!0),trimEnd:F(!1),trim:M(function(t,e){var n=this.trimStart(e),i=this.trimEnd(e);return n||i}),expand:M(function(t,e,n){var o=!1;n=i(n,le);var a=s(n.characterOptions);if(e||(e=B),e==U){var c,l,u=r(n.wordOptions),d=t.getRangeBoundaryPosition(this,!0),h=t.getRangeBoundaryPosition(this,!1),f=L(d,a,u),p=f.nextEndToken(),g=p.chars[0].previousVisible();if(this.collapsed)c=p;else{var m=L(h,a,u);c=m.previousStartToken()}return l=c.chars[c.chars.length-1],g.equals(d)||(this.setStart(g.node,g.offset),o=!0),l&&!l.equals(h)&&(this.setEnd(l.node,l.offset),o=!0),n.trim&&(n.trimStart&&(o=this.trimStart(a)||o),n.trimEnd&&(o=this.trimEnd(a)||o)),o}return this.moveEnd(B,1,n)}),text:M(function(t,e){return this.collapsed?"":$(t,this,s(e)).join("")}),selectCharacters:M(function(t,e,n,i,r){var s={characterOptions:r};e||(e=q(this.getDocument())),this.selectNodeContents(e),this.collapse(!0),this.moveStart("character",n,s),this.collapse(!0),this.moveEnd("character",i-n,s)}),toCharacterRange:M(function(t,e,n){e||(e=q(this.getDocument()));var i,r,s=e.parentNode,o=Y.getNodeIndex(e),a=-1==Y.comparePoints(this.startContainer,this.endContainer,s,o),c=this.cloneRange();return a?(c.setStartAndEnd(this.startContainer,this.startOffset,s,o),i=-c.text(n).length):(c.setStartAndEnd(s,o,this.startContainer,this.startOffset),i=c.text(n).length),r=i+this.text(n).length,{start:i,end:r}}),findText:M(function(e,n,i){i=a(i),i.wholeWordsOnly&&(i.wordOptions=r(i.wordOptions),i.wordOptions.includeTrailingSpace=!1);var s=Z(i.direction),o=i.withinRange;o||(o=t.createRange(),o.selectNodeContents(this.getDocument()));var c=n,l=!1;"string"==typeof c?i.caseSensitive||(c=c.toLowerCase()):l=!0;var u=e.getRangeBoundaryPosition(this,!s),d=o.comparePoint(u.node,u.offset);-1===d?u=e.getRangeBoundaryPosition(o,!0):1===d&&(u=e.getRangeBoundaryPosition(o,!1));for(var h,f=u,p=!1;;)if(h=P(f,c,l,o,i)){if(h.valid)return this.setStartAndEnd(h.startPos.node,h.startPos.offset,h.endPos.node,h.endPos.offset),!0;f=s?h.startPos:h.endPos}else{if(!i.wrap||p)return!1;o=o.cloneRange(),f=e.getRangeBoundaryPosition(o,!s),o.setBoundary(u.node,u.offset,s),p=!0}}),pasteHtml:function(t){if(this.deleteContents(),t){var e=this.createContextualFragment(t),n=e.lastChild;this.insertNode(e),this.collapseAfter(n)}}}),W(t.selectionPrototype,{expand:M(function(t,e,n){this.changeEachRange(function(t){t.expand(e,n)})}),move:M(function(t,e,n,i){var r=0;if(this.focusNode){this.collapse(this.focusNode,this.focusOffset);var s=this.getRangeAt(0);i||(i={}),i.characterOptions=o(i.characterOptions),r=s.move(e,n,i),this.setSingleRange(s)}return r}),trimStart:z("trimStart"),trimEnd:z("trimEnd"),trim:z("trim"),selectCharacters:M(function(e,n,i,r,s,o){var a=t.createRange(n);a.selectCharacters(n,i,r,o),this.setSingleRange(a,s)}),saveCharacterRanges:M(function(t,e,n){for(var i=this.getAllRanges(),r=i.length,s=[],o=1==r&&this.isBackward(),a=0,c=i.length;c>a;++a)s[a]={characterRange:i[a].toCharacterRange(e,n),backward:o,characterOptions:n};return s}),restoreCharacterRanges:M(function(e,n,i){this.removeAllRanges();for(var r,s,o,a=0,c=i.length;c>a;++a)s=i[a],o=s.characterRange,r=t.createRange(n),r.selectCharacters(n,o.start,o.end,s.characterOptions),this.addRange(r,s.backward)}),text:M(function(t,e){for(var n=[],i=0,r=this.rangeCount;r>i;++i)n[i]=this.getRangeAt(i).text(e);return n.join("")})}),t.innerText=function(e,n){var i=t.createRange(e);i.selectNodeContents(e);var r=i.text(n);return r},t.createWordIterator=function(t,e,n){var o=O();n=i(n,ue);var a=s(n.characterOptions),c=r(n.wordOptions),l=o.getPosition(t,e),u=L(l,a,c),d=Z(n.direction);return{next:function(){return d?u.previousStartToken():u.nextEndToken()},dispose:function(){u.dispose(),this.next=function(){}}}},t.noMutation=function(t){var e=O();t(e),E()},t.noMutation.createEntryPointFunction=M,t.textRange={isBlockNode:d,isCollapsedWhitespaceNode:y,createPosition:M(function(t,e,n){return t.getPosition(e,n)})}}),/**
 * Class Applier module for Rangy.
 * Adds, removes and toggles classes on Ranges and Selections
 *
 * Part of Rangy, a cross-browser JavaScript range and selection library
 * http://code.google.com/p/rangy/
 *
 * Depends on Rangy core.
 *
 * Copyright 2014, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3alpha.20140716
 * Build date: 16 July 2014
 */
rangy.createModule("ClassApplier",["WrappedSelection"],function(t,e){function n(t,e){for(var n in t)if(t.hasOwnProperty(n)&&e(n,t[n])===!1)return!1;return!0}function i(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function r(t,e){return t.className&&new RegExp("(?:^|\\s)"+e+"(?:\\s|$)").test(t.className)}function s(t,e){t.className?r(t,e)||(t.className+=" "+e):t.className=e}function o(t){return t&&t.split(/\s+/).sort().join(" ")}function a(t){return o(t.className)}function c(t,e){return a(t)==a(e)}function l(t,e,n,i,r){var s=t.node,o=t.offset,a=s,c=o;s==i&&o>r&&++c,s!=e||o!=n&&o!=n+1||(a=i,c+=r-n),s==e&&o>n+1&&--c,t.node=a,t.offset=c}function u(t,e,n){t.node==e&&t.offset>n&&--t.offset}function d(t,e,n,i){-1==n&&(n=e.childNodes.length);for(var r,s=t.parentNode,o=R.getNodeIndex(t),a=0;r=i[a++];)l(r,s,o,e,n);e.childNodes.length==n?e.appendChild(t):e.insertBefore(t,e.childNodes[n])}function h(t,e){for(var n,i=t.parentNode,r=R.getNodeIndex(t),s=0;n=e[s++];)u(n,i,r);t.parentNode.removeChild(t)}function f(t,e,n,i,r){for(var s,o=[];s=t.firstChild;)d(s,e,n++,r),o.push(s);return i&&h(t,r),o}function p(t,e){return f(t,t.parentNode,R.getNodeIndex(t),!0,e)}function g(t,e){var n=t.cloneRange();n.selectNodeContents(e);var i=n.intersection(t),r=i?i.toString():"";return""!=r}function m(t){for(var e,n=t.getNodes([3]),i=0;(e=n[i])&&!g(t,e);)++i;for(var r=n.length-1;(e=n[r])&&!g(t,e);)--r;return n.slice(i,r+1)}function v(t,e){if(t.attributes.length!=e.attributes.length)return!1;for(var n,i,r,s=0,o=t.attributes.length;o>s;++s)if(n=t.attributes[s],r=n.name,"class"!=r){if(i=e.attributes.getNamedItem(r),null===n!=(null===i))return!1;if(n.specified!=i.specified)return!1;if(n.specified&&n.nodeValue!==i.nodeValue)return!1}return!0}function b(t,e){for(var n,i=0,r=t.attributes.length;r>i;++i)if(n=t.attributes[i].name,(!e||!D(e,n))&&t.attributes[i].specified&&"class"!=n)return!0;return!1}function y(t,e){return n(e,function(e,n){if("object"==typeof n){if(!y(t[e],n))return!1}else if(t[e]!==n)return!1})}function _(t){var e;return t&&1==t.nodeType&&((e=t.parentNode)&&9==e.nodeType&&"on"==e.designMode||z(t)&&!z(t.parentNode))}function w(t){return(z(t)||1!=t.nodeType&&z(t.parentNode))&&!_(t)}function x(t){return t&&1==t.nodeType&&!B.test(F(t,"display"))}function S(t){if(0==t.data.length)return!0;if(U.test(t.data))return!1;var e=F(t.parentNode,"whiteSpace");switch(e){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(t.data))return!1}return x(t.previousSibling)||x(t.nextSibling)}function C(t){var e,n,i=[];for(e=0;n=t[e++];)i.push(new $(n.startContainer,n.startOffset),new $(n.endContainer,n.endOffset));return i}function k(t,e){for(var n,i,r,s=0,o=t.length;o>s;++s)n=t[s],i=e[2*s],r=e[2*s+1],n.setStartAndEnd(i.node,i.offset,r.node,r.offset)}function T(t,e){return R.isCharacterDataNode(t)?0==e?!!t.previousSibling:e==t.length?!!t.nextSibling:!0:e>0&&e<t.childNodes.length}function I(t,n,i,r){var s,o,a=0==i;if(R.isAncestorOf(n,t))return t;if(R.isCharacterDataNode(n)){var c=R.getNodeIndex(n);if(0==i)i=c;else{if(i!=n.length)throw e.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+i+" in "+n.data);i=c+1}n=n.parentNode}if(T(n,i)){s=n.cloneNode(!1),o=n.parentNode,s.id&&s.removeAttribute("id");for(var l,u=0;l=n.childNodes[i];)d(l,s,u++,r);return d(s,o,R.getNodeIndex(n)+1,r),n==t?s:I(t,o,R.getNodeIndex(s),r)}if(t!=n){s=n.parentNode;var h=R.getNodeIndex(n);return a||h++,I(t,s,h,r)}return t}function O(t,e){return t.namespaceURI==e.namespaceURI&&t.tagName.toLowerCase()==e.tagName.toLowerCase()&&c(t,e)&&v(t,e)&&"inline"==F(t,"display")&&"inline"==F(e,"display")}function E(t){var e=t?"nextSibling":"previousSibling";return function(n,i){var r=n.parentNode,s=n[e];if(s){if(s&&3==s.nodeType)return s}else if(i&&(s=r[e],s&&1==s.nodeType&&O(r,s))){var o=s[t?"firstChild":"lastChild"];if(o&&3==o.nodeType)return o}return null}}function N(t){this.isElementMerge=1==t.nodeType,this.textNodes=[];var e=this.isElementMerge?t.lastChild:t;e&&(this.textNodes[0]=e)}function L(t,e,r){var s,o,a,c,l=this;l.cssClass=t;var u=null,d={};if("object"==typeof e&&null!==e){for(r=e.tagNames,u=e.elementProperties,d=e.elementAttributes,o=0;c=W[o++];)e.hasOwnProperty(c)&&(l[c]=e[c]);s=e.normalize}else s=e;l.normalize="undefined"==typeof s?!0:s,l.attrExceptions=[];var h=document.createElement(l.elementTagName);l.elementProperties=l.copyPropertiesToElement(u,h,!0),n(d,function(t){l.attrExceptions.push(t)}),l.elementAttributes=d,l.elementSortedClassName=l.elementProperties.hasOwnProperty("className")?l.elementProperties.className:t,l.applyToAnyTagName=!1;var f=typeof r;if("string"==f)"*"==r?l.applyToAnyTagName=!0:l.tagNames=i(r.toLowerCase()).split(/\s*,\s*/);else if("object"==f&&"number"==typeof r.length)for(l.tagNames=[],o=0,a=r.length;a>o;++o)"*"==r[o]?l.applyToAnyTagName=!0:l.tagNames.push(r[o].toLowerCase());else l.tagNames=[l.elementTagName]}function A(t,e,n){return new L(t,e,n)}var R=t.dom,$=R.DomPosition,D=R.arrayContains,P=R.isHtmlNamespace,M="span",j=function(){function t(t,e,n){return e&&n?" ":""}return function(e,n){e.className&&(e.className=e.className.replace(new RegExp("(^|\\s)"+n+"(\\s|$)"),t))}}(),F=R.getComputedStyleProperty,z=function(){var t=document.createElement("div");return"boolean"==typeof t.isContentEditable?function(t){return t&&1==t.nodeType&&t.isContentEditable}:function(t){return t&&1==t.nodeType&&"false"!=t.contentEditable?"true"==t.contentEditable||z(t.parentNode):!1}}(),B=/^inline(-block|-table)?$/i,U=/[^\r\n\t\f \u200B]/,Y=E(!1),H=E(!0);N.prototype={doMerge:function(t){var e=this.textNodes,n=e[0];if(e.length>1){for(var i,r,s,o,a=R.getNodeIndex(n),c=[],l=0,u=0,d=e.length;d>u;++u){if(i=e[u],r=i.parentNode,u>0&&(r.removeChild(i),r.hasChildNodes()||r.parentNode.removeChild(r),t))for(s=0;o=t[s++];)o.node==i&&(o.node=n,o.offset+=l),o.node==r&&o.offset>a&&(--o.offset,o.offset==a+1&&d-1>u&&(o.node=n,o.offset=l));c[u]=i.data,l+=i.data.length}n.data=c.join("")}return n.data},getLength:function(){for(var t=this.textNodes.length,e=0;t--;)e+=this.textNodes[t].length;return e},toString:function(){for(var t=[],e=0,n=this.textNodes.length;n>e;++e)t[e]="'"+this.textNodes[e].data+"'";return"[Merge("+t.join(",")+")]"}};var W=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],q={};L.prototype={elementTagName:M,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(t,e,n){var i,r,a,c,l,u,d={};for(var h in t)if(t.hasOwnProperty(h))if(c=t[h],l=e[h],"className"==h)s(e,c),s(e,this.cssClass),e[h]=o(e[h]),n&&(d[h]=e[h]);else if("style"==h){r=l,n&&(d[h]=a={});for(i in t[h])r[i]=c[i],n&&(a[i]=r[i]);this.attrExceptions.push(h)}else e[h]=c,n&&(d[h]=e[h],u=q.hasOwnProperty(h)?q[h]:h,this.attrExceptions.push(u));return n?d:""},copyAttributesToElement:function(t,e){for(var n in t)t.hasOwnProperty(n)&&e.setAttribute(n,t[n])},hasClass:function(t){return 1==t.nodeType&&D(this.tagNames,t.tagName.toLowerCase())&&r(t,this.cssClass)},getSelfOrAncestorWithClass:function(t){for(;t;){if(this.hasClass(t))return t;t=t.parentNode}return null},isModifiable:function(t){return!this.applyToEditableOnly||w(t)},isIgnorableWhiteSpaceNode:function(t){return this.ignoreWhiteSpace&&t&&3==t.nodeType&&S(t)},postApply:function(t,e,n,i){for(var r,s,o,a=t[0],c=t[t.length-1],l=[],u=a,d=c,h=0,f=c.length,p=0,g=t.length;g>p;++p)s=t[p],o=Y(s,!i),o?(r||(r=new N(o),l.push(r)),r.textNodes.push(s),s===a&&(u=r.textNodes[0],h=u.length),s===c&&(d=r.textNodes[0],f=r.getLength())):r=null;var m=H(c,!i);if(m&&(r||(r=new N(c),l.push(r)),r.textNodes.push(m)),l.length){for(p=0,g=l.length;g>p;++p)l[p].doMerge(n);e.setStartAndEnd(u,h,d,f)}},createContainer:function(t){var e=t.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,e,!1),this.copyAttributesToElement(this.elementAttributes,e),s(e,this.cssClass),this.onElementCreate&&this.onElementCreate(e,this),e},applyToTextNode:function(t){var e=t.parentNode;if(1==e.childNodes.length&&this.useExistingElements&&P(e)&&D(this.tagNames,e.tagName.toLowerCase())&&y(e,this.elementProperties))s(e,this.cssClass);else{var n=this.createContainer(R.getDocument(t));t.parentNode.insertBefore(n,t),n.appendChild(t)}},isRemovable:function(t){return P(t)&&t.tagName.toLowerCase()==this.elementTagName&&a(t)==this.elementSortedClassName&&y(t,this.elementProperties)&&!b(t,this.attrExceptions)&&this.isModifiable(t)},isEmptyContainer:function(t){var e=t.childNodes.length;return 1==t.nodeType&&this.isRemovable(t)&&(0==e||1==e&&this.isEmptyContainer(t.firstChild))},removeEmptyContainers:function(t){for(var e,n=this,i=t.getNodes([1],function(t){return n.isEmptyContainer(t)}),r=[t],s=C(r),o=0;e=i[o++];)h(e,s);k(r,s)},undoToTextNode:function(t,e,n,i){if(!e.containsNode(n)){var r=e.cloneRange();r.selectNode(n),r.isPointInRange(e.endContainer,e.endOffset)&&(I(n,e.endContainer,e.endOffset,i),e.setEndAfter(n)),r.isPointInRange(e.startContainer,e.startOffset)&&(n=I(n,e.startContainer,e.startOffset,i))}this.isRemovable(n)?p(n,i):j(n,this.cssClass)},applyToRange:function(t,e){e=e||[];var n=C(e||[]);t.splitBoundariesPreservingPositions(n),this.removeEmptyElements&&this.removeEmptyContainers(t);var i=m(t);if(i.length){for(var r,s=0;r=i[s++];)this.isIgnorableWhiteSpaceNode(r)||this.getSelfOrAncestorWithClass(r)||!this.isModifiable(r)||this.applyToTextNode(r,n);r=i[i.length-1],t.setStartAndEnd(i[0],0,r,r.length),this.normalize&&this.postApply(i,t,n,!1),k(e,n)}},applyToRanges:function(t){for(var e=t.length;e--;)this.applyToRange(t[e],t);return t},applyToSelection:function(e){var n=t.getSelection(e);n.setRanges(this.applyToRanges(n.getAllRanges()))},undoToRange:function(t,e){e=e||[];var n=C(e);t.splitBoundariesPreservingPositions(n),this.removeEmptyElements&&this.removeEmptyContainers(t,n);var i,r,s=m(t),o=s[s.length-1];if(s.length){for(var a=0,c=s.length;c>a;++a)i=s[a],r=this.getSelfOrAncestorWithClass(i),r&&this.isModifiable(i)&&this.undoToTextNode(i,t,r,n),t.setStartAndEnd(s[0],0,o,o.length);this.normalize&&this.postApply(s,t,n,!0),k(e,n)}},undoToRanges:function(t){for(var e=t.length;e--;)this.undoToRange(t[e],t);return t},undoToSelection:function(e){var n=t.getSelection(e),i=t.getSelection(e).getAllRanges();this.undoToRanges(i),n.setRanges(i)},isAppliedToRange:function(t){if(t.collapsed||""==t.toString())return!!this.getSelfOrAncestorWithClass(t.commonAncestorContainer);var e=t.getNodes([3]);if(e.length)for(var n,i=0;n=e[i++];)if(!this.isIgnorableWhiteSpaceNode(n)&&g(t,n)&&this.isModifiable(n)&&!this.getSelfOrAncestorWithClass(n))return!1;return!0},isAppliedToRanges:function(t){var e=t.length;if(0==e)return!1;for(;e--;)if(!this.isAppliedToRange(t[e]))return!1;return!0},isAppliedToSelection:function(e){var n=t.getSelection(e);return this.isAppliedToRanges(n.getAllRanges())},toggleRange:function(t){this.isAppliedToRange(t)?this.undoToRange(t):this.applyToRange(t)},toggleSelection:function(t){this.isAppliedToSelection(t)?this.undoToSelection(t):this.applyToSelection(t)},getElementsWithClassIntersectingRange:function(t){var e=[],n=this;return t.getNodes([3],function(t){var i=n.getSelfOrAncestorWithClass(t);i&&!D(e,i)&&e.push(i)}),e},detach:function(){}},L.util={hasClass:r,addClass:s,removeClass:j,hasSameClasses:c,replaceWithOwnChildren:p,elementsHaveSameNonClassAttributes:v,elementHasNonClassAttributes:b,splitNodeAt:I,isEditableElement:z,isEditingHost:_,isEditable:w},t.CssClassApplier=t.ClassApplier=L,t.createCssClassApplier=t.createClassApplier=A}),define("rangy",function(){return rangy.init(),rangy}),define("findtxt",function(){function t(t,r,s,o){var a,c=[],l=[],u=n(r);if(!u)return l;if(t.global)for(;a=t.exec(u);)c.push(e(a,o));else a=u.match(t),a&&c.push(e(a,o));return c.length&&(l=i(r,c,s)),l}function e(t,e){if(e=e||0,!t[0])throw"findTxt cannot handle zero-length matches";var n=t.index;if(e>0){var i=t[e];if(!i)throw"Invalid capture group";n+=t[0].indexOf(i),t[0]=i}return[n,n+t[0].length,[t[0]]]}function n(t){if(3===t.nodeType)return t.data;var e="";if(t=t.firstChild)do e+=n(t);while(t=t.nextSibling);return e}function i(t,e,n){var i,r,s,o,a=t,c=0,l=[],u=[],d=e.shift();t:for(;;){if(3===a.nodeType&&(!r&&a.length+c>=d[1]?(r=a,o=d[1]-c):i&&u.push(a),!i&&a.length+c>d[0]&&(i=a,s=d[0]-c),c+=a.length),i&&r){var h={startNode:i,startNodeIndex:s,endNode:r,endNodeIndex:o,matchIndex:l.length+1};if(l.push(h),n&&!1===n(h))break;if(a=r,c-=r.length-o,i=null,r=null,u=[],d=e.shift(),!d)break}else if(a.firstChild||a.nextSibling){a=a.firstChild||a.nextSibling;continue}for(;;){if(a.nextSibling){a=a.nextSibling;break}if(a.parentNode===t)break t;a=a.parentNode}}return n?void 0:l}return t}),define("rect",function(){function t(t,e,n,i){this.left=t,this.top=e,this.width=n,this.height=i}return t.prototype.intersects=function(t){return this.left<=t.left+t.width&&t.left<=this.left+this.width&&this.top<=t.top+t.height&&t.top<=this.top+this.height},t.prototype.boundingRect=function(t){var e=Math.max(this.left+this.width,t.left+t.width),n=Math.max(this.top+this.height,t.top+t.height);this.left=Math.min(this.left,t.left),this.top=Math.min(this.top,t.top),this.width=e-this.left,this.height=n-this.top},t.prototype.translate=function(t,e){return this.left+=t,this.top+=e,this},t.prototype.scale=function(t,e){return this.left*=t,this.width*=t,this.top*=e,this.height*=e,this},t.prototype.clone=function(){return new t(this.left,this.top,this.width,this.height)},t}),define("range-serializer",["util","rangy","findtxt","rect"],function(t,e,n,i){function r(e,n){n=$.extend({minLength:128,validate:function(){return!0}},n);var i=arguments.callee,r=e.cloneRange(),s=r.toString(),o=s.length,a=o-n.minLength;if(0>a){if(r.moveStart("character",a),!n.validate(r))return i(e,t.merge(n,{minLength:n.minLength>>1}));s=r.text()}return{text:s.substr(-o),prefix:s.substring(0,s.length-o)}}function s(t){var n=e.createRange();return n.setStart(t.startNode,t.startNodeIndex),n.setEnd(t.endNode,t.endNodeIndex),n}function o(e,r){r=$.extend({matchWeirdCitations:!1,insertWhitespace:!1,matchBrokenTxt:!1,matchTranslits:!1,boundingRects:null},r);var o=e.text,a=e.prefix,c=r.boundingRects;r.insertWhitespace&&(o=o.replace(/\s+/g,"").split("").join(" "),a=a.replace(/\s+/g,"").split("").join(" "));var l=t.regexEscape(o),u=t.regexEscape(a);r.matchTranslits&&(l=l.replace(/([szcaeoui]{1})/gi,"$1[¸ˇ´¨`'\"~]? ").replace(/i/gi,"(i|ı)")),r.matchBrokenTxt&&e.text.match(/[a-z]+/i)&&e.text.match(/\d{4}/)&&(l=l.replace(/([a-z0-9]{1})/gi,"($1|[^\\x20-\\x7F]{1})")),r.matchWeirdCitations&&(l=l.replace(/(•|∗ )/gi,"($1|.{1})"),u.length>0&&(u=u.replace(/(\d+)\\\)/,"$1 \\)"))),l="("+l.replace(/\s+/g,"\\s*")+")",u=u.replace(/\s+/g,"\\s*");var d=null,h=new RegExp(u+"\\s*"+l,"ig"),f=n(h,r.container[0],null,1);if(f.length)if(c&&c.length)for(var p=function(e){var n=e.nodeType==Node.TEXT_NODE;n&&(e=t.wrapTextNode(e));var r=e.getBoundingClientRect();n&&(e=t.unwrapTextNode(e));for(var s=new i(r.left,r.top,r.width,r.height),o=0;o<c.length;o++)if(s.intersects(c[o]))return!0;return!1},g=0,m=0;m<f.length;m++){var v=s(f[m]),b=v.getNodes([Node.TEXT_NODE,Node.ELEMENT_NODE],p);b.length>g&&(g=b.length,d=v)}else d=s(f[0]);return d}return{serialize:r,deserialize:o}}),define("citation",["util","rangy","range-serializer"],function(t,e,n){function i(t,e){var n=[];-1!=t.indexOf("'",1)&&(t=t.replace(/\'$/,"’"),n.push(t)),-1!=t.indexOf("”",1)&&(t=t.replace(/\”/,"’’"),n.push(t)),n.push(t.replace(" "," "));for(var i=1;i<t.length-2;i++)n.push(t.substring(0,i)+t.substring(i,t.length).replace(/(.{1})/,"$1-"));return n.push(".”",".","”"),e.match(/^\s*\d{1}\s*$/)||n.push(""),n}var r=function(e,n){this.klass="enhanced-"+n.type,this.id=t.guid(),this.range=e,this.data=n,this.elems=null,this.clapp=null,this._init()};return r.prototype={_init:function(){this.clapp=e.createClassApplier([this.klass,this.id].join(" ")),this.clapp.applyToRange(this.range),this.elems=this._getNodes()},_getNodes:function(){var t=this.range.commonAncestorContainer;return t.nodeType==Node.TEXT_NODE&&(t=t.parentNode.parentNode),$(t).find("."+this.id)},getElems:function(){return this.elems},getId:function(){return this.id},getKlass:function(){return this.klass},getType:function(){return this.data.type},getData:function(){return t.clone(this.data)},destroy:function(){this.clapp.undoToRange(this.range),this.clapp=null,this.range=null,this.elems=null,this.data=null}},r.deserialize=function(e,s){var o=null,a={matchTranslits:"author"==s.type,matchWeirdCitations:!0,container:e};if(!o&&s.text.match(/^\d{4}$/)&&(o=n.deserialize({prefix:s.prefix.split(/\(|\[|;/g).pop().trim(),text:s.text},t.merge(a,{matchTranslits:!1}))),o||(o=n.deserialize({prefix:s.prefix.split(/\s+|\n/).pop(),text:s.text},a)),!o&&s.text.match(/\d+\s+-\s+\d+/)&&(o=n.deserialize({prefix:s.prefix,text:s.text.replace(/\s+-\s+/g," - - ")},a)),o||(o=n.deserialize({prefix:s.prefix.replace(/(;)/g," $1 "),text:s.text.replace(/(\d+|[a-zA-Z\.]+|,|;)/g," $1 ")},a)),!o&&s.prefix.length)for(var c=i(s.prefix,s.text),l=0;l<c.length&&!(o=n.deserialize({prefix:c[l],text:s.text},a));l++);return o||(o=n.deserialize(s,t.merge(a,{matchBrokenTxt:!0}))),o?new r(o,s):(e.children().length&&t.log("* missed citation: ["+s.prefix+"]["+s.text+"]"),null)},r}),define("citations-model",["util","article","viewer","input-handler","citations-drawer","citation"],function(t,e,n,i,r,s){function o(t){var e=t.getId();f[e]=t,i.add(t),r.add(t),$(h).trigger("add",[t])}function a(t,e){var i=g[t-1][e];if("figure"!=i.type){var r=n.getPageObj(t);i.references=$.map(i.ids,function(t){return m[t-1]});var a=s.deserialize(r.getElem(),i);a&&o(a)}}function c(e,n){if(!p[e]&&n.hasText()&&g[e-1]){for(var i=t.timer.tic(),r=0;r<g[e-1].length;r++)a(e,r);t.log("citations("+e+") duration: "+t.timer.toc(i)+"ms"),p[e]=!0}}function l(){e.onData(function(){g=e.get().citations,m=e.get().references,$(n).on("page-loaded",function(t,e){c(e,n.getPageObj(e))}),n.onInit(function(){n.eachPage(c)})})}function u(t){for(var e in f)if(!1===t(f[e]))break}function d(){return t.clone(f)}var h={},f={},p={},g=null,m=null;return l(),h.forEach=u,h.getAll=d,h}),define("author-template",function(){function t(t,e){return t?'<a href="'+t+'" target="_blank"> '+e+" </a>":null}function e(e){var n=[];return n.push(t(e.search_npg,"NPG Journals")),n.push(t(e.search_pm,"PubMed")),n.push(t(e.search_gs,"Google Scholar")),$.grep(n,function(t){return!!t}).join(" • ")}function n(n){var r=i.clone().removeAttr("id");if(r.find(".name").html(n.text),n.affiliations&&n.affiliations.length?r.find(".affiliations").html(n.affiliations.join("<br>")):r.find(".affiliations").hide(),n.email){var s=t(n.email,"Contact "+n.text);r.find(".contact-link").html(s)}else r.find(".contact").hide();return r.find(".links").html(e(n)),r}var i=$("#article-author-template");return{create:n}}),define("references-template",function(){function t(t){for(var i=$('<div class="references articles"></div>'),o=0,a=t.length;a>o;o++){var c=t[o],l=s.clone().removeAttr("id");l.find(".number").html(c.label||c.ordinal),l.find(".title").html(e(c.title)),l.find(".authors").html((c.authors||[]).join(", ")),l.find(".published").html(r(c)),l.find(".links").html(n(c)),i.append(l)}return i}function e(t){return t&&(t=t.replace(/<(http[^>]+)>/g,function(t,e){return i(e)})),t}function n(t){var e=[];return e.push(i(t.find_article_url,"Find Article")),e.push(i(t.article_url,"Article")),$.grep(e,function(t){return!!t}).join(" | ")}function i(t,e){return t?'<a href="'+t+'" target="_blank"> '+(e||t)+" </a>":null}function r(t){return t.journal&&t.year?t.journal+", "+t.year:t.journal||t.year}var s=$("#article-reference-template");return{create:t}}),define("citations-view",["citations-model","author-template","references-template","popover"],function(t,e,n,i){function r(t){var r;r="author"==t.getType()?e.create(t.getData()):n.create(t.getData().references),$(t).on("click",function(){i.open({placement:"up",content:r,anchor:t.getElems().first()})})}function s(){t.forEach(r),$(t).on("add",function(t,e){r(e)})}var o={};return s(),o}),define("annotations-store",["util","user","sync","storage","article"],function(t,e,n,i,r){function s(t,e){return JSON.stringify(t)==JSON.stringify(e)}function o(){P=t.merge(j,i.getItem(M))}function a(){i.setItem(M,P)}function c(){return t.merge(F,{user_data:n.get().user_data})}function l(){return t.merge(F,{user_data:{modified:D,annotations:t.hashToArray(R)}})}function u(t,e){var n=new Date(t.user_data.modified),i=new Date(e.user_data.modified);return n>=i}function d(t){return t}function h(e,n){var i=t.arrayToHash(e.user_data.annotations),r=t.arrayToHash(n.user_data.annotations);if(u(e,n))for(var o in r)i[o]||P.removed[o]||N(o,r[o],!0);else{g(n.user_data.modified);for(var o in i)r[o]||P.added[o]||L(o,!0);for(var o in r)i[o]&&s(i[o],r[o])||N(o,r[o],!0)}return l()}function f(){P.added={},P.updated={},P.removed={},a()}function p(){for(var t in P.added)return!0;for(var t in P.updated)return!0;for(var t in P.removed)return!0;return!1}function g(t){D=t}function m(t){P.added[t]=!0,a()}function v(t){P.added[t]||(P.updated[t]=!0),a()}function b(t){P.added[t]?delete P.added[t]:P.removed[t]=!0,a()}function y(t,e,n){R[t]=e,n?$(A).trigger("add",[e]):m(t)}function _(t,e,n){R[t]=e,n?$(A).trigger("change",[e]):v(t)}function w(t,e,n){delete R[t],n?$(A).trigger("remove",[e]):b(t)}function x(){P=t.clone(j);for(var e in R)P.added[e]=!0;a()}function S(t){e.signedIn()?n.set(l(),t,f):(f(),$(A).trigger("not-saved"))}function C(){R={},D=null,$(A).trigger("clear")}function k(){h(l(),c())}function T(){C(),o(),k()}function I(){o(),k(),$(n).on("added changed",function(){k(),p()&&S(h)}),$(n).on("removed",x),$(i).on("reload",function(){e.signedIn()?n.isAdded(function(t){t||n.get().user_data?T():(a(),S(d))}):T()})}function O(){return t.clone(R)}function E(t){return R[t]}function N(t,e,n){return R[t]?_(t,e,n):y(t,e,n),!0}function L(t,e){return R[t]?(w(t,R[t],e),!0):!1}var A={},R={},D=null,P=null,M="annot-local-changes:"+r.get().doi,j={added:{},updated:{},removed:{}},F={user_data:{modified:t.dateISO(0),annotations:[]}};return I(),A.getAll=O,A.getItem=E,A.setItem=function(e,n){N(e,n)&&(g(t.dateISO()),S(h))},A.removeItem=function(e){L(e)&&(g(t.dateISO()),S(h))},A}),define("annotations-drawer",["util"],function(t){function e(e){var n=[e.getKlass()+r,e.getColor()].join(" ");e.getElems().addClass(n).filter(function(){return t.containsDiacritic(this.innerText)}).addClass("diacritic")}function n(t){var e=[t.getKlass()+r,t.getColor(),"diacritic"].join(" ");t.getElems().removeClass(e)}var i={},r="-elem-draw";return i.add=e,i.remove=n,i}),define("number",function(){function t(t,e,n){return"undefined"==typeof n||0===+n?Math[t](e):(e=+e,n=+n,isNaN(e)||"number"!=typeof n||0!==n%1?0/0:(e=e.toString().split("e"),e=Math[t](+(e[0]+"e"+(e[1]?+e[1]-n:-n))),e=e.toString().split("e"),+(e[0]+"e"+(e[1]?+e[1]+n:n))))}var e={};return e.round10=function(e,n){return t("round",e,n)},e.floor10=function(e,n){return t("floor",e,n)},e.ceil10=function(e,n){return t("ceil",e,n)},e}),define("annotation",["util","rangy","range-serializer","rect","number"],function(t,e,n,i,r){function s(t,e){var n=t[0].getBoundingClientRect(),r=new i(n.left,n.top,n.width,n.height),s=r.height/e.page_height,o=r.width/e.page_width,a=r.height/s;return $.map(e.rects,function(t){var e=new i(t[0],a-t[1]-t[3],t[2],t[3]);return e.scale(o,s),e.translate(r.left,r.top),e})}var o=function(e,n,i){var r=t.dateISO();this.data=$.extend({source:"sync",id:t.guid(),type:"highlight",renderer:"html5",created:r,color_id:"1"},i),this.range=e,this.container=n,this.id=this.data.id,this.klass="annotation",this.elems=null,this.clapp=null,this._init()};return o.prototype={_init:function(){this.clapp=e.createClassApplier([this.id,this.klass].join(" ")),this.clapp.applyToRange(this.range),this.elems=this._getNodes(),this.rects=this._getRects()},_getNodes:function(){var t=this.range.commonAncestorContainer;return t.nodeType==Node.TEXT_NODE&&(t=t.parentNode.parentNode),$(t).find("."+this.id)},_getRects:function(){return this.data.rects&&this.data.rects.length||(this.data.rects=this._getBoundingRects()),this.data.rects},_getBoundingRects:function(){var t=[],e=this.container[0].getBoundingClientRect(),n=new i(e.left,e.top,e.width,e.height),s=this.data.page_height/n.height,o=this.data.page_width/n.width;return this.elems.each(function(){var e=this.getBoundingClientRect(),r=new i(e.left,e.top,e.width,e.height);r.translate(-n.left,-n.top),r.scale(o,s);for(var a=0;a<t.length;a++)if(t[a].intersects(r))return t[a].boundingRect(r),void 0;t.push(r)}),n.scale(o,s),$.map(t,function(t){return[[r.round10(t.left,-1),r.round10(n.height-t.top-t.height,-1),r.round10(t.width,-1),r.round10(t.height,-1)]]})},getNote:function(){return this.data.note},setNote:function(t){this.data.has_note&&this.data.note==t||(this.data.has_note=!0,this.data.note=t,$(this).trigger("change"))},hasNote:function(){return this.data.has_note},getColor:function(){return"color-"+this.data.color_id},getElems:function(){return this.elems},getId:function(){return this.id},getKlass:function(){return this.klass},getRange:function(){return this.range.cloneRange()},getCreated:function(){return this.data.created},getPageStart:function(){return this.data.page_start},destroy:function(){this.clapp.undoToRange(this.range),this.clapp=null,this.range=null,this.elems=null,this.klass=null,this.data=null},serialize:function(){var e=this.container[0],i=n.serialize(this.range,{validate:function(t){return $.contains(e,t.commonAncestorContainer)}});return t.merge({preceeding_text:i.prefix,text:i.text},this.data)}},o.comparePositions=function(t,e){var n=t.getRange(),i=e.getRange();return n.compareBoundaryPoints(n.START_TO_START,i)},o.deserialize=function(e,i){var r="html5"==i.renderer,a="swf"==i.renderer,c=!r&&!a,l=null,u={container:e,insertWhitespace:!r};i.preceeding_text||(i.preceeding_text="");var d=parseInt(i.color_id);return(!d||1>d||d>4)&&delete i.color_id,c&&i.rects&&i.rects.length&&(u.boundingRects=s(e,i)),l||(l=n.deserialize({prefix:i.preceeding_text,text:i.text},u)),!l&&a&&(l=n.deserialize({prefix:i.preceeding_text.slice(0,-1),text:i.text.slice(0,-1)},u)),!l&&c&&(l=n.deserialize({prefix:"",text:i.text},u)),l?new o(l,e,i):(e.children().length&&t.log("* missed annotation: ["+i.preceeding_text+"]["+i.text+"]"),null)},o}),define("annotations-model",["util","viewer","article","input-handler","annotations-store","annotations-drawer","annotation"],function(t,e,n,i,r,s,o){function a(t){var e=t.getId();return b[e]=t,i.add(t),s.add(t),$(t).on("change.store",function(){r.setItem(e,t.serialize()),$(v).trigger("change",[t])}),$(v).trigger("add",[t]),t}function c(t){if(!b[t])return null;var e=b[t];return i.remove(e),s.remove(e),$(e).off("change.store"),delete b[t],e.destroy(),$(v).trigger("remove",[e]),e}function l(t){if(t.sha256==w){var n=t.page_start+1,i=e.getPageObj(n),r=o.deserialize(i.getElem(),t);r&&(y[r.getId()]=null,a(r))}}function u(t){e.onInit(function(){var n=t.page_start+1,i=e.getPageObj(n);_[n]=!1,y[t.id]=t,d(n,i)})}function d(e,n){if(!_[e]&&n.hasText()){var i=t.timer.tic();for(var r in y){var s=y[r];s&&s.page_start+1==e&&l(s)}t.log("annotations("+e+") duration: "+t.timer.toc(i)+"ms"),_[e]=!0}}function h(){y=r.getAll(),$(e).on("page-loaded",function(t,n){d(n,e.getPageObj(n))}),e.onInit(function(){e.eachPage(d)}),$(r).on("add",function(t,e){e.sha256==w&&u(e)}),$(r).on("change",function(t,e){e.sha256==w&&(c(e.id),u(e))}),$(r).on("remove",function(t,e){e.sha256==w&&c(e.id)}),$(r).on("clear",function(){var e=t.clone(b);for(var n in e)c(n);e=null})}function f(n,i){var s=e.getPageObj(i.page_start),c=new o(n,s.getElem(),t.merge(i,{has_note:t.definedKey("note",i),page_start:i.page_start-1,page_end:i.page_start-1,page_height:s.getHeight(),page_width:s.getWidth(),sha256:w}));return r.setItem(c.getId(),c.serialize()),a(c)}function p(t){return r.removeItem(t),c(t)}function g(t){for(var e in b)if(!1===t(b[e]))break}function m(){return t.clone(b)}var v={},b={},y={},_={},w=n.get().hash;return h(),v.addItem=f,v.removeItem=p,v.forEach=g,v.getAll=m,v}),define("selection",["util","rangy","input-handler"],function(t,e,n){function i(i,r){function s(){var t=f.commonAncestorContainer;return t.nodeType==Node.TEXT_NODE&&(t=t.parentNode.parentNode),$(t).find("."+h)}function o(){n.remove(u),s().removeClass(h),e.getSelection().removeAllRanges(),$(u).trigger("clear-selection")}function a(){var i=e.getSelection(),s=i.getAllRanges()[0];return r(s)?(d=t.guid(),f=s,p.applyToRange(f),i.setSingleRange(f),n.add(u),$(u).trigger("set-selection"),!0):(i.removeAllRanges(),!1)}function c(){var t=e.getSelection();return t.isCollapsed?!1:$.contains(i[0],t.anchorNode)?$.contains(i[0],t.focusNode)?!0:!1:!1}function l(){$(document).on("mousedown",function(){c()&&o(),i.one("mouseup",function(){return c()&&a()?(i.one("click",!1),!1):void 0})})}i=i||$(document.body),r=r||function(){return!0};var u={},d=null,h="current-selection",f=e.createRange(),p=e.createClassApplier(h);return l(),u.clear=function(){return o()},u.getRange=function(){return f.cloneRange()},u.getRangeAndClear=function(){var t=f.cloneRange();return o(),t},u.getElems=function(){return s()},u.getKlass=function(){return h},u.getId=function(){return d},u}return i}),define("base-toolbar",["popover"],function(t){var e=function(){};return e.prototype={_init:function(t,e){var n=this,i=$("#annotations-base-toolbar");this._elem=i.clone().removeAttr("id").addClass(t),this._elem.find(".annot-colors .sample").click(function(){$(n).trigger("highlight",[$(this).data("colorid")])}),this._elem.find(".add-note").click(function(){$(n).trigger("add-note")}),this._elem.find(".delete").click(function(){$(n).trigger("delete")});var r=null;this._textarea=this._elem.find("textarea"),this._textarea.val(e||""),this._textarea.on({blur:function(){$(n).trigger("change-note",[n._textarea.val()])},keydown:function(t){t.stopPropagation()},keyup:function(){clearTimeout(r),r=setTimeout(function(){$(n).trigger("change-note",[n._textarea.val()])},1e3)}}),this._initEvents()},_initEvents:function(){},_show:function(e,n){this._anchor=e,t.open({placement:"up",content:this._elem,anchor:this._anchor,klass:n})},addClass:function(t){this._elem.addClass(t)},removeClass:function(t){this._elem.removeClass(t)},show:function(t,e){this._show(t||this._anchor,e),this._textarea.is(":visible")&&!this._textarea.val()&&this._textarea.focus()},hide:function(){t.close(this._anchor)},destroy:function(){this.hide(),this._elem.remove(),this._elem=null,this._anchor=null}},e}),define("selection-toolbar",["base-toolbar"],function(t){var e=function(t){this.selection=t,this._init("selection")};return e.prototype=$.extend(new t,{_initEvents:function(){var t=this;$(this.selection).on({"set-selection":function(){t.show(t.selection.getElems().first())},"clear-selection":function(){t.hide()}})},destroy:function(){t.prototype.destroy.apply(this),this.selection=null}}),e}),define("annotation-toolbar",["base-toolbar"],function(t){var e=function(t){this.annotation=t,this.annotation.hasNote()?this._init("annotation note",this.annotation.getNote()):this._init("annotation")};return e.prototype=$.extend(new t,{_initEvents:function(){var t=this;$(this.annotation).on("click",function(){var e=t.annotation.getElems(),n=t.annotation.getColor();t.show(e.first(),n)})},destroy:function(){t.prototype.destroy.apply(this),this.selection=null}}),e}),define("annotations-view",["viewer","annotations-model","selection","selection-toolbar","annotation-toolbar","tracker"],function(t,e,n,i,r,s){function o(t){var n=new r(t);h[t.getId()]=n,$(n).on({"add-note":function(){t.setNote(""),n.addClass("note"),$(t).trigger("click")},"change-note":function(e,n){t.setNote(n)},"delete":function(){e.removeItem(t.getId())}})}function a(t){h[t.getId()].destroy()}function c(e){var n=-1,i=e.commonAncestorContainer;return t.eachPage(function(t,e){return $.contains(e.getElem()[0],i)?(n=t,!1):void 0}),n}function l(t){return-1!=c(t)}function u(){t.onInit(function(){var r=n(t.getElem(),l),o=new i(r);$(o).on({highlight:function(t,n){var i=r.getRangeAndClear();e.addItem(i,{page_start:c(i),color_id:n}),s.highlight()},"add-note":function(){var t=r.getRangeAndClear();$(e.addItem(t,{page_start:c(t),note:""})).trigger("click"),s.note()}})})}var d={},h={};return e.forEach(o),$(e).on({add:function(t,e){o(e)},remove:function(t,e){a(e)}}),u(),d}),define("related-template",function(){function t(t,e){return t?'<a href="'+t+'" class="link-out" target="_blank"> '+e+" </a>":void 0}function e(e){var n=[];return n.push(t(e.find_article_url,"Find Article")),n.push(t(e.article_url,"Article")),$.grep(n,function(t){return t}).join(" | ")}function n(t){return t.journal&&t.year?t.journal+", "+t.year:t.journal||t.year
}function i(t){var i=$('<div class="articles"></div>');0==t.length&&i.append('<div class="none-found">No related articles found.</div>');for(var s=0;s<t.length;s++){var o=r.clone().removeAttr("id");o.find(".title").html(t[s].title),o.find(".authors").html((t[s].authors||[]).join(", ")),o.find(".published").html(n(t[s])),o.find(".links").html(e(t[s])),i.append(o)}return i}var r=$("#related-article-template");return{createElement:i}}),define("related-view",["util","article","endpoint","popover","spin-btn","related-template","tracker"],function(t,e,n,i,r,s,o){function a(i){if(a.data)return i(a.data),void 0;var r=t.timer.tic(),s=e.get();$.ajax({url:n("related_articles",{doi:s.doi}),dataType:"json",success:function(e){t.log("related articles: "+t.timer.toc(r)+"ms"),a.data=e.slice(0,5),i(a.data)}})}function c(t,e){var n=s.createElement(e);n.find(".link-out").on("click",function(){o.linkout("related")}),i.open({placement:"up",content:n,anchor:t})}function l(){$(function(){var t=$("#related-articles"),e=new r(t);t.click(function(){return i.isOpen(t)?(i.close(),void 0):(e.spin(),a(function(n){e.stop(),c(t,n)}),o.related(),void 0)})})}var u={};return l(),u}),define("readcube-view",["user"],function(t){function e(){$(function(){o=$("#sidepanel-readcube"),o.find(".login-link").click(function(){t.showLogin({tracking_action:"readcube_sidepanel"},function(){i()})}),t.onSignIn(function(){o.find(".existing-user").hide()})})}function n(){o.trigger("tab:open")}function i(){o.trigger("tab:close")}function r(){o.hasClass("active")?i():n()}var s={},o=null;return e(),s.open=n,s.close=i,s.toggle=r,s}),define("supplement-normalize",function(){function t(t){return t=t.toLowerCase(),0==t.indexOf("vnd.")?-1!=t.indexOf("word")?"doc":-1!=t.indexOf("excel")||-1!=t.indexOf("sheet")?"xls":-1!=t.indexOf("powerpoint")||-1!=t.indexOf("presentation")?"ppt":"type":t}return function(e,n){return e.index=n,e.caption=e.caption||"Supplement "+(n+1),e.type=t(e.type),e}}),define("supplement-viewer",["util","article","endpoint","message-receiver","supplement-normalize","tracker","spin"],function(t,e,n,i,r,s,o){function a(t){var n=e.get().supplements[t];return r(n,t)}function c(){return $("<div></div>").addClass("supplement-bg")}function l(){return $("<iframe></iframe>").addClass("supplements-frame").attr("allowTransparency","true")}function u(){_||(_=c()),_.appendTo(document.body).fadeIn(v,function(){w.spin(_[0])})}function d(){_&&(w.stop(),_.fadeOut(v,function(){_.hide()}))}function h(t,e){var n=e[0].contentWindow.document;n.write(t),n.close()}function f(e){var n=t.timer.tic();y=l(),$(i).one("supplement:load",function(){t.log("loaded supplement frame:",t.timer.toc(n)+"ms"),w.stop(),y.show(),g()}),$(i).one("supplement:close",function(){y.hide().remove(),y=null,d()}),y.appendTo(document.body),h(e,y)}function p(e){var i=t.timer.tic();b=e,u(),$.ajax({type:"POST",url:n("show_supplement"),dataType:"html",data:{supplement:a(b)},success:function(e){t.log("rendered supplement:",t.timer.toc(i)+"ms"),f(e),s.supplement()}})}function g(){e.hasAccess()&&y&&y.is(":visible")&&y[0].contentWindow.postMessage({type:"supplement:access",supplement:a(b)},"*")}function m(){e.onAccess(g)}var v=200,b=null,y=null,_=null,w=new o({color:"#CCC",radius:16,length:32,width:2});return m(),{show:p}}),define("video-player",["util"],function(t){function e(){return!!window.videojs}function n(n){e()?n():(t.loadCss("//vjs.zencdn.net/4.2/video-js.css"),$.getScript("//vjs.zencdn.net/4.2/video.js",n))}function i(t,e){n(function(){var n=t+"-video";$("body").append('<div class="video-overlay"></div>'),$("body .video-overlay").append('<video id="'+n+'" class="video-js vjs-default-skin" controls></video>'),$("body .video-overlay video").append('<source src="'+e+'" type="video/mp4">');var i=videojs(n,{width:640,height:480});$("body .video-overlay").click(function(t){$(t.target).hasClass("video-overlay")&&(i.dispose(),$(this).remove())})})}return api={},{show:i}}),define("supplements-template",["tracker","supplement-normalize","supplement-viewer","video-player"],function(t,e,n,i){function r(t,e){if(t.thumb&&t.thumb.length){var n=t.thumb[0],i=$(new Image);i.attr("src",n).load(function(){i.remove(),e(n)})}}function s(e){var s=o.clone().removeAttr("id");return s.addClass(e.type),s.attr("href",e.url),s.find(".type").html("("+e.type+")"),s.find(".title").html(e.caption),r(e,function(t){s.find(".thumb").css("background-image","url("+t+")"),e.stylesheet&&s.click(function(){return n.show(e.index),!1})}),"video"==e.type&&s.click(function(){return i.show("supplement-"+e.index,e.url),t.video(),!1}),s}var o=$("#article-supplement-template");return function(t){for(var n=$('<div class="supplements"><h3>Supporting Information</h3></div>'),i=0;i<t.length;i++){var r=e(t[i],i);n.append(s(r))}return n}}),define("supplements-view",["article","supplements-template","popover"],function(t,e,n){function i(){$(function(){t.onData(function(t){var i=$("#supplements"),r=t.supplements;r.length>0?i.append('<div class="count">'+r.length+"</div>"):i.hide(),i.click(function(){n.open({placement:"up",content:e(r),anchor:i})})})})}var r={};return i(),r}),define("bottombar-view",["user","viewer","article-export","tracker","readcube-view","popover"],function(t,e,n,i,r,s){function o(){var e=u.find("#readcube-button"),n=u.find("#user-button"),i=$("#readcube-menu");e.click(function(){r.toggle()}),n.click(function(){t.signedIn()?s.toggle({placement:"up",content:i,anchor:n}):t.showRegister({tracking_action:"toolbar_signup"})}),i.find(".item").click(function(){s.close(n)}),t.onSignIn(function(){n.find(".user-name").html(t.get().name),n.addClass("logged-in")})}function a(){u.find("#zoom-in").click(function(){e.scaleBy(1.25)}),u.find("#zoom-out").click(function(){e.scaleBy(.8)}),u.find("#fit-width").click(function(){e.fitWidth()}),u.find("#print").click(function(){n.print()}),u.find("#save").click(function(){n.download()})}function c(){$(function(){u=$("#bottom"),o(),a()})}var l={},u=null;return c(),require("related-view"),require("supplements-view"),l}),define("topbar-view",["endpoint","tracker","util"],function(t,e,n){function i(){$(function(){t("parent")&&r(),$(".publisher-site-link").on("click",function(){e.linkout("publisher")})})}function r(){if($("#content").addClass("embedded"),window.readcube.show_close){$("#close-reader").show();var e=n.getScrollbarWidth();e&&$("#close-reader").css("right",e)}$("#close-reader, .publisher-site-link").click(function(e){e.preventDefault(),e.stopImmediatePropagation(),window.parent.postMessage({type:"close"},t("parent"))})}i()}),define("tabs",function(){function t(t,e,n){function i(t){c.removeClass("active"),c.filter('[data-pane="'+t+'"]').addClass("active"),l.filter(".active").removeClass("active").trigger("close"),$(t).addClass("active").trigger("open"),e&&e(t)}function r(){c.removeClass("active"),l.filter(".active").removeClass("active").trigger("close"),n&&n()}function s(t){var e=c.filter('[data-pane="'+t+'"]');e.hasClass("active")&&r(),e.hide()}function o(t){var e=c.filter('[data-pane="'+t+'"]');e.show()}function a(){c=t.find(".tab"),l=t.find(".tab-pane"),c.click(function(){$(this).hasClass("active")?r():i($(this).data("pane"))}),c.filter("[data-hide]").each(function(){$(this).hide()}),l.on("hide",function(){s("#"+$(this).attr("id"))}),l.on("show",function(){o("#"+$(this).attr("id"))}),l.on("tab:open",function(){i("#"+$(this).attr("id"))}),l.on("tab:close",function(){r()})}var c=null,l=null;return a(),{open:i,close:r}}return t}),define("summary-view",["article","format"],function(t,e){function n(){$(function(){var n=$("#sidepanel-info");t.onData(function(t){var i=t.meta,r=$.grep([i.journal,e.month(i.month),i.year],function(t){return!!t}).join(", ")+". "+t.doi,s=$.map(i.authors,function(t){return t.name}).join(", ");n.find(".info").html(r),n.find("h2.title").html(i.title),n.find("p.authors").html(s),n.find("p.abstract").html(i.abstract),i.editors_summary?n.find("p.editors-summary").html(i.editors_summary):n.find(".editors-summary").remove()})})}var i={};return n(),i}),define("figures-view",["article"],function(t){function e(t,e){var n=s.clone().removeAttr("id"),i=e.caption,a=i.indexOf(":"),c="<b>"+i.substr(0,a)+" |</b> "+i.substr(a+1);return n.find(".figure-caption").html(c),n.find(".figure-thumb").data("src",e.thumb),$(o).one("open",function(){var t=n.find(".figure-thumb");t.attr("src",t.data("src"))}),n.click(function(){$(r).trigger("show-figure",[t])}),n}function n(t){if(t.length){o.removeClass("empty");for(var n=0;n<t.length;n++)a.append(e(n,t[n]))}}function i(){$(function(){s=$("#templates #figure-template"),o=$("#sidepanel-figures"),a=o.find(".figures-list"),t.onData(function(t){n(t.figures)})})}var r={},s=null,o=null,a=null;return i(),r}),define("figures-carousel",["article","figures-view","spin"],function(t,e,n){function i(){if(!u||!u.hasClass("open"))return s(),void 0;var t=d.width()-20,e=d.height()-20;(t!=m[0]||e!=m[1])&&(h.css({maxWidth:t,maxHeight:e}),m=[t,e])}function r(){s(),i(),g=setInterval(i,100)}function s(){clearInterval(g),g=null}function o(t){if(-1==t&&(t=l.length-1),t==l.length&&(t=0),t==p)return u.addClass("open"),r(),void 0;var e=l[t],n=e.caption,i=n.indexOf(":"),s=n.substr(0,i),o=n.substr(i+1);u.addClass("loading"),u.find(".title").text(s),u.find("img.figure").attr("src",e.url).load(function(){u.removeClass("loading"),f.stop()}),u.find(".caption").text(o),f.spin(u.find(".spinner")[0]),u.addClass("open"),p=t,r()}function a(){$(function(){f=new n({color:"#CCC",radius:10,length:20,width:2}),u=$("#figures-carousel"),d=u.find(".fc-content"),h=u.find("img.figure"),t.onData(function(t){l=t.figures,$(e).on("show-figure",function(t,e){o(e)}),u.find(".close").click(function(){u.removeClass("open")}),u.find(".prev").click(function(){o(p-1)}),u.find(".next").click(function(){o(p+1)}),u.find(".download-full").click(function(){location.href=l[p].download_url}),l.length<2&&u.find(".prev, .next").css({visibility:"hidden"})})})}var c={},l=null,u=null,d=null,h=null,f=null,p=null,g=null,m=[-1,-1];return a(),c}),define("sharing-view",["access-control","article","tracker"],function(t,e,n){function i(t){var n=u.val(),i=e.get().meta.title;t.hasClass("twitter")&&(i=r(i,116));var s=t.data("url");s=s.replace("{{url}}",encodeURIComponent(n)),s=s.replace("{{title}}",encodeURIComponent(i)),t.attr("href",s)}function r(t,e){return t.length>e?t.substring(0,e-3)+"...":t}function s(){e.onAccessCheck(function(e){!d&&e.access_share_enabled&&t.generateSharedAccess(o)})}function o(t){t.shared_access_url&&(l.find(".share-access").show(),u.val(t.shared_access_url),d=!0)}function a(){l.find(".share-btn.facebook").on("click",function(){n.share("fb")}),l.find(".share-btn.twitter").on("click",function(){n.share("twitter")}),l.find(".share-btn.google").on("click",function(){n.share("gp")}),l.find(".share-btn.linkedin").on("click",function(){n.share("li")}),l.find(".altmetric-embed").on("click","a",function(){n.altmetric()})}function c(){$(function(){l=$("#sidepanel-share"),u=l.find("input[name=share_url]"),l.find(".share-access-link").on("click",function(){u.select()}),e.onData(function(t){window.readcube.discover&&u.val(t.meta.url)}),l.one("open",s),l.find(".share-btn").on("click",function(){$(this).attr("href",i($(this)))}),a()})}var l=null,u=null,d=!1,h={};return c(),h}),define("notes-view",["util","format","annotations-model"],function(t,e,n){function i(t,e){var n=new Date(t.getCreated()),i=new Date(e.getCreated());return i.getTime()-n.getTime()}function r(t){var n=new Date(t.getCreated()),i=c.clone().removeAttr("id");return i.find(".note-created-at").html(e.friendlyDate(n)),i.find(".note-highlight").addClass(t.getColor()).html(t.getRange().toString()),t.hasNote()?i.find(".note-text").html(t.getNote()):i.find(".note-text").remove(),i}function s(){var e=t.hashToArray(n.getAll());if(e.length){var s=e.sort(i);u.empty();for(var o=0;o<s.length;o++)u.append(r(s[o]));l.removeClass("empty")}else l.addClass("empty")}function o(){$(function(){c=$("#templates #note-template"),l=$("#sidepanel-notes"),u=l.find(".notes-list"),$(n).on("add remove change",s),s()})}var a={},c=null,l=null,u=null;return o(),a}),define("references-view",["article","references-template"],function(t,e){function n(){$(function(){s=$("#sidepanel-references"),t.onData(function(t){i(t.references)})})}function i(t){t.length&&(s.removeClass("empty"),s.append(e.create(t)))}var r={},s=null;return n(),r}),define("sidepanel-view",["tabs","summary-view","figures-view","figures-carousel","sharing-view","notes-view","references-view","checkout-view","readcube-view","tracker"],function(t,e,n,i,r,s,o,a,c,l){function u(t){g.addClass("expanded"),$(".content").addClass("contracted"),l.sidepanel(t)}function d(){g.removeClass("expanded"),$(".content").removeClass("contracted")}function h(){$(function(){g=$("#sidepanel"),p=t(g,u,d),setTimeout(function(){g.addClass("ready")},1500)})}var f={},p=null,g=null;return h(),f}),define("publisher-fixes",["util","article","viewer"],function(t,e,n){function i(){0==a.indexOf("10.4018/irmj")&&n.onInit(function(){var t=n.getPageObj(1);t.onLoaded(function(){t.hasText()&&t.getElem().find('.t:contains("717/533-8845")').length&&t.getElem().find('.t:contains("Information Resources Management Journal")').hide()})})}function r(){0==a.indexOf("10.4018/irmj.2013010102")&&n.onInit(function(){n.eachPage(function(e,n){n.onLoaded(function(){n.hasText()&&n.getElem().find('.t:contains("Copyright © 2013, IGI Global")').contents().each(function(e,n){0!=e&&(n.nodeType==Node.TEXT_NODE&&(n=t.wrapTextNode(n)),$(n).hide())})})})})}function s(){i(),r()}function o(){s()}var a=e.get().doi;return o(),{}}),define("annotation-notifications",["user","annotations-store"],function(t,e){function n(){var n=!1,i=$(".annotations-not-saved");i.find(".login").click(function(){t.showLogin({tracking_action:"annotations_notification"})}),i.find(".register").click(function(){t.showRegister({tracking_action:"annotations_notification"})}),i.find(".close").click(function(){i.removeClass("open")}),$(t).on("login",function(){i.removeClass("open")}),$(e).on("not-saved",function(){n||(i.addClass("open"),n=!0)})}var i={};return $(function(){n()}),i}),function(t){function e(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function n(t,e){return function(n){return u(t.call(this,n),e)}}function i(t,e){return function(n){return this.lang().ordinal(t.call(this,n),e)}}function r(){}function s(t){x(t),a(this,t)}function o(t){var e=m(t),n=e.year||0,i=e.month||0,r=e.week||0,s=e.day||0,o=e.hour||0,a=e.minute||0,c=e.second||0,l=e.millisecond||0;this._milliseconds=+l+1e3*c+6e4*a+36e5*o,this._days=+s+7*r,this._months=+i+12*n,this._data={},this._bubble()}function a(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return e.hasOwnProperty("toString")&&(t.toString=e.toString),e.hasOwnProperty("valueOf")&&(t.valueOf=e.valueOf),t}function c(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&me.hasOwnProperty(e)&&(n[e]=t[e]);return n}function l(t){return 0>t?Math.ceil(t):Math.floor(t)}function u(t,e,n){for(var i=""+Math.abs(t),r=t>=0;i.length<e;)i="0"+i;return(r?n?"+":"":"-")+i}function d(t,e,n,i){var r,s,o=e._milliseconds,a=e._days,c=e._months;o&&t._d.setTime(+t._d+o*n),(a||c)&&(r=t.minute(),s=t.hour()),a&&t.date(t.date()+a*n),c&&t.month(t.month()+c*n),o&&!i&&ie.updateOffset(t),(a||c)&&(t.minute(r),t.hour(s))}function h(t){return"[object Array]"===Object.prototype.toString.call(t)}function f(t){return"[object Date]"===Object.prototype.toString.call(t)||t instanceof Date}function p(t,e,n){var i,r=Math.min(t.length,e.length),s=Math.abs(t.length-e.length),o=0;for(i=0;r>i;i++)(n&&t[i]!==e[i]||!n&&b(t[i])!==b(e[i]))&&o++;return o+s}function g(t){if(t){var e=t.toLowerCase().replace(/(.)s$/,"$1");t=We[t]||qe[e]||e}return t}function m(t){var e,n,i={};for(n in t)t.hasOwnProperty(n)&&(e=g(n),e&&(i[e]=t[n]));return i}function v(e){var n,i;if(0===e.indexOf("week"))n=7,i="day";else{if(0!==e.indexOf("month"))return;n=12,i="month"}ie[e]=function(r,s){var o,a,c=ie.fn._lang[e],l=[];if("number"==typeof r&&(s=r,r=t),a=function(t){var e=ie().utc().set(i,t);return c.call(ie.fn._lang,e,r||"")},null!=s)return a(s);for(o=0;n>o;o++)l.push(a(o));return l}}function b(t){var e=+t,n=0;return 0!==e&&isFinite(e)&&(n=e>=0?Math.floor(e):Math.ceil(e)),n}function y(t,e){return new Date(Date.UTC(t,e+1,0)).getUTCDate()}function _(t){return w(t)?366:365}function w(t){return 0===t%4&&0!==t%100||0===t%400}function x(t){var e;t._a&&-2===t._pf.overflow&&(e=t._a[le]<0||t._a[le]>11?le:t._a[ue]<1||t._a[ue]>y(t._a[ce],t._a[le])?ue:t._a[de]<0||t._a[de]>23?de:t._a[he]<0||t._a[he]>59?he:t._a[fe]<0||t._a[fe]>59?fe:t._a[pe]<0||t._a[pe]>999?pe:-1,t._pf._overflowDayOfYear&&(ce>e||e>ue)&&(e=ue),t._pf.overflow=e)}function S(t){return null==t._isValid&&(t._isValid=!isNaN(t._d.getTime())&&t._pf.overflow<0&&!t._pf.empty&&!t._pf.invalidMonth&&!t._pf.nullInput&&!t._pf.invalidFormat&&!t._pf.userInvalidated,t._strict&&(t._isValid=t._isValid&&0===t._pf.charsLeftOver&&0===t._pf.unusedTokens.length)),t._isValid}function C(t){return t?t.toLowerCase().replace("_","-"):t}function k(t,e){return e._isUTC?ie(t).zone(e._offset||0):ie(t).local()}function T(t,e){return e.abbr=t,ge[t]||(ge[t]=new r),ge[t].set(e),ge[t]}function I(t){delete ge[t]}function O(t){var e,n,i,r,s=0,o=function(t){if(!ge[t]&&ve)try{require("./lang/"+t)}catch(e){}return ge[t]};if(!t)return ie.fn._lang;if(!h(t)){if(n=o(t))return n;t=[t]}for(;s<t.length;){for(r=C(t[s]).split("-"),e=r.length,i=C(t[s+1]),i=i?i.split("-"):null;e>0;){if(n=o(r.slice(0,e).join("-")))return n;if(i&&i.length>=e&&p(r,i,!0)>=e-1)break;e--}s++}return ie.fn._lang}function E(t){return t.match(/\[[\s\S]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"")}function N(t){var e,n,i=t.match(we);for(e=0,n=i.length;n>e;e++)i[e]=Ke[i[e]]?Ke[i[e]]:E(i[e]);return function(r){var s="";for(e=0;n>e;e++)s+=i[e]instanceof Function?i[e].call(r,t):i[e];return s}}function L(t,e){return t.isValid()?(e=A(e,t.lang()),Ve[e]||(Ve[e]=N(e)),Ve[e](t)):t.lang().invalidDate()}function A(t,e){function n(t){return e.longDateFormat(t)||t}var i=5;for(xe.lastIndex=0;i>=0&&xe.test(t);)t=t.replace(xe,n),xe.lastIndex=0,i-=1;return t}function R(t,e){var n,i=e._strict;switch(t){case"DDDD":return $e;case"YYYY":case"GGGG":case"gggg":return i?De:ke;case"Y":case"G":case"g":return Me;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return i?Pe:Te;case"S":if(i)return Ae;case"SS":if(i)return Re;case"SSS":if(i)return $e;case"DDD":return Ce;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return Oe;case"a":case"A":return O(e._l)._meridiemParse;case"X":return Le;case"Z":case"ZZ":return Ee;case"T":return Ne;case"SSSS":return Ie;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return i?Re:Se;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return Se;default:return n=new RegExp(B(z(t.replace("\\","")),"i"))}}function $(t){t=t||"";var e=t.match(Ee)||[],n=e[e.length-1]||[],i=(n+"").match(Ue)||["-",0,0],r=+(60*i[1])+b(i[2]);return"+"===i[0]?-r:r}function D(t,e,n){var i,r=n._a;switch(t){case"M":case"MM":null!=e&&(r[le]=b(e)-1);break;case"MMM":case"MMMM":i=O(n._l).monthsParse(e),null!=i?r[le]=i:n._pf.invalidMonth=e;break;case"D":case"DD":null!=e&&(r[ue]=b(e));break;case"DDD":case"DDDD":null!=e&&(n._dayOfYear=b(e));break;case"YY":r[ce]=b(e)+(b(e)>68?1900:2e3);break;case"YYYY":case"YYYYY":case"YYYYYY":r[ce]=b(e);break;case"a":case"A":n._isPm=O(n._l).isPM(e);break;case"H":case"HH":case"h":case"hh":r[de]=b(e);break;case"m":case"mm":r[he]=b(e);break;case"s":case"ss":r[fe]=b(e);break;case"S":case"SS":case"SSS":case"SSSS":r[pe]=b(1e3*("0."+e));break;case"X":n._d=new Date(1e3*parseFloat(e));break;case"Z":case"ZZ":n._useUTC=!0,n._tzm=$(e);break;case"w":case"ww":case"W":case"WW":case"d":case"dd":case"ddd":case"dddd":case"e":case"E":t=t.substr(0,1);case"gg":case"gggg":case"GG":case"GGGG":case"GGGGG":t=t.substr(0,2),e&&(n._w=n._w||{},n._w[t]=e)}}function P(t){var e,n,i,r,s,o,a,c,l,u,d=[];if(!t._d){for(i=j(t),t._w&&null==t._a[ue]&&null==t._a[le]&&(s=function(e){var n=parseInt(e,10);return e?e.length<3?n>68?1900+n:2e3+n:n:null==t._a[ce]?ie().weekYear():t._a[ce]},o=t._w,null!=o.GG||null!=o.W||null!=o.E?a=X(s(o.GG),o.W||1,o.E,4,1):(c=O(t._l),l=null!=o.d?V(o.d,c):null!=o.e?parseInt(o.e,10)+c._week.dow:0,u=parseInt(o.w,10)||1,null!=o.d&&l<c._week.dow&&u++,a=X(s(o.gg),u,l,c._week.doy,c._week.dow)),t._a[ce]=a.year,t._dayOfYear=a.dayOfYear),t._dayOfYear&&(r=null==t._a[ce]?i[ce]:t._a[ce],t._dayOfYear>_(r)&&(t._pf._overflowDayOfYear=!0),n=q(r,0,t._dayOfYear),t._a[le]=n.getUTCMonth(),t._a[ue]=n.getUTCDate()),e=0;3>e&&null==t._a[e];++e)t._a[e]=d[e]=i[e];for(;7>e;e++)t._a[e]=d[e]=null==t._a[e]?2===e?1:0:t._a[e];d[de]+=b((t._tzm||0)/60),d[he]+=b((t._tzm||0)%60),t._d=(t._useUTC?q:W).apply(null,d)}}function M(t){var e;t._d||(e=m(t._i),t._a=[e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond],P(t))}function j(t){var e=new Date;return t._useUTC?[e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()]:[e.getFullYear(),e.getMonth(),e.getDate()]}function F(t){t._a=[],t._pf.empty=!0;var e,n,i,r,s,o=O(t._l),a=""+t._i,c=a.length,l=0;for(i=A(t._f,o).match(we)||[],e=0;e<i.length;e++)r=i[e],n=(a.match(R(r,t))||[])[0],n&&(s=a.substr(0,a.indexOf(n)),s.length>0&&t._pf.unusedInput.push(s),a=a.slice(a.indexOf(n)+n.length),l+=n.length),Ke[r]?(n?t._pf.empty=!1:t._pf.unusedTokens.push(r),D(r,n,t)):t._strict&&!n&&t._pf.unusedTokens.push(r);t._pf.charsLeftOver=c-l,a.length>0&&t._pf.unusedInput.push(a),t._isPm&&t._a[de]<12&&(t._a[de]+=12),t._isPm===!1&&12===t._a[de]&&(t._a[de]=0),P(t),x(t)}function z(t){return t.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(t,e,n,i,r){return e||n||i||r})}function B(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function U(t){var n,i,r,s,o;if(0===t._f.length)return t._pf.invalidFormat=!0,t._d=new Date(0/0),void 0;for(s=0;s<t._f.length;s++)o=0,n=a({},t),n._pf=e(),n._f=t._f[s],F(n),S(n)&&(o+=n._pf.charsLeftOver,o+=10*n._pf.unusedTokens.length,n._pf.score=o,(null==r||r>o)&&(r=o,i=n));a(t,i||n)}function Y(t){var e,n,i=t._i,r=je.exec(i);if(r){for(t._pf.iso=!0,e=0,n=ze.length;n>e;e++)if(ze[e][1].exec(i)){t._f=ze[e][0]+(r[6]||" ");break}for(e=0,n=Be.length;n>e;e++)if(Be[e][1].exec(i)){t._f+=Be[e][0];break}i.match(Ee)&&(t._f+="Z"),F(t)}else t._d=new Date(i)}function H(e){var n=e._i,i=be.exec(n);n===t?e._d=new Date:i?e._d=new Date(+i[1]):"string"==typeof n?Y(e):h(n)?(e._a=n.slice(0),P(e)):f(n)?e._d=new Date(+n):"object"==typeof n?M(e):e._d=new Date(n)}function W(t,e,n,i,r,s,o){var a=new Date(t,e,n,i,r,s,o);return 1970>t&&a.setFullYear(t),a}function q(t){var e=new Date(Date.UTC.apply(null,arguments));return 1970>t&&e.setUTCFullYear(t),e}function V(t,e){if("string"==typeof t)if(isNaN(t)){if(t=e.weekdaysParse(t),"number"!=typeof t)return null}else t=parseInt(t,10);return t}function G(t,e,n,i,r){return r.relativeTime(e||1,!!n,t,i)}function Q(t,e,n){var i=ae(Math.abs(t)/1e3),r=ae(i/60),s=ae(r/60),o=ae(s/24),a=ae(o/365),c=45>i&&["s",i]||1===r&&["m"]||45>r&&["mm",r]||1===s&&["h"]||22>s&&["hh",s]||1===o&&["d"]||25>=o&&["dd",o]||45>=o&&["M"]||345>o&&["MM",ae(o/30)]||1===a&&["y"]||["yy",a];return c[2]=e,c[3]=t>0,c[4]=n,G.apply({},c)}function K(t,e,n){var i,r=n-e,s=n-t.day();return s>r&&(s-=7),r-7>s&&(s+=7),i=ie(t).add("d",s),{week:Math.ceil(i.dayOfYear()/7),year:i.year()}}function X(t,e,n,i,r){var s,o,a=q(t,0,1).getUTCDay();return n=null!=n?n:r,s=r-a+(a>i?7:0)-(r>a?7:0),o=7*(e-1)+(n-r)+s+1,{year:o>0?t:t-1,dayOfYear:o>0?o:_(t-1)+o}}function Z(t){var e=t._i,n=t._f;return null===e?ie.invalid({nullInput:!0}):("string"==typeof e&&(t._i=e=O().preparse(e)),ie.isMoment(e)?(t=c(e),t._d=new Date(+e._d)):n?h(n)?U(t):F(t):H(t),new s(t))}function J(t,e){ie.fn[t]=ie.fn[t+"s"]=function(t){var n=this._isUTC?"UTC":"";return null!=t?(this._d["set"+n+e](t),ie.updateOffset(this),this):this._d["get"+n+e]()}}function te(t){ie.duration.fn[t]=function(){return this._data[t]}}function ee(t,e){ie.duration.fn["as"+t]=function(){return+this/e}}function ne(t){var e=!1,n=ie;"undefined"==typeof ender&&(t?(oe.moment=function(){return!e&&console&&console.warn&&(e=!0,console.warn("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.")),n.apply(null,arguments)},a(oe.moment,n)):oe.moment=ie)}for(var ie,re,se="2.5.1",oe=this,ae=Math.round,ce=0,le=1,ue=2,de=3,he=4,fe=5,pe=6,ge={},me={_isAMomentObject:null,_i:null,_f:null,_l:null,_strict:null,_isUTC:null,_offset:null,_pf:null,_lang:null},ve="undefined"!=typeof module&&module.exports&&"undefined"!=typeof require,be=/^\/?Date\((\-?\d+)/i,ye=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,_e=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,we=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,xe=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,Se=/\d\d?/,Ce=/\d{1,3}/,ke=/\d{1,4}/,Te=/[+\-]?\d{1,6}/,Ie=/\d+/,Oe=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Ee=/Z|[\+\-]\d\d:?\d\d/gi,Ne=/T/i,Le=/[\+\-]?\d+(\.\d{1,3})?/,Ae=/\d/,Re=/\d\d/,$e=/\d{3}/,De=/\d{4}/,Pe=/[+-]?\d{6}/,Me=/[+-]?\d+/,je=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Fe="YYYY-MM-DDTHH:mm:ssZ",ze=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],Be=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],Ue=/([\+\-]|\d\d)/gi,Ye="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),He={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},We={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},qe={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},Ve={},Ge="DDD w W M D d".split(" "),Qe="M D H h m s w W".split(" "),Ke={M:function(){return this.month()+1},MMM:function(t){return this.lang().monthsShort(this,t)},MMMM:function(t){return this.lang().months(this,t)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(t){return this.lang().weekdaysMin(this,t)},ddd:function(t){return this.lang().weekdaysShort(this,t)},dddd:function(t){return this.lang().weekdays(this,t)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return u(this.year()%100,2)},YYYY:function(){return u(this.year(),4)},YYYYY:function(){return u(this.year(),5)},YYYYYY:function(){var t=this.year(),e=t>=0?"+":"-";return e+u(Math.abs(t),6)},gg:function(){return u(this.weekYear()%100,2)},gggg:function(){return u(this.weekYear(),4)},ggggg:function(){return u(this.weekYear(),5)},GG:function(){return u(this.isoWeekYear()%100,2)},GGGG:function(){return u(this.isoWeekYear(),4)},GGGGG:function(){return u(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return b(this.milliseconds()/100)},SS:function(){return u(b(this.milliseconds()/10),2)},SSS:function(){return u(this.milliseconds(),3)},SSSS:function(){return u(this.milliseconds(),3)},Z:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+u(b(t/60),2)+":"+u(b(t)%60,2)},ZZ:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+u(b(t/60),2)+u(b(t)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()},Q:function(){return this.quarter()}},Xe=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];Ge.length;)re=Ge.pop(),Ke[re+"o"]=i(Ke[re],re);for(;Qe.length;)re=Qe.pop(),Ke[re+re]=n(Ke[re],2);for(Ke.DDDD=n(Ke.DDD,3),a(r.prototype,{set:function(t){var e,n;for(n in t)e=t[n],"function"==typeof e?this[n]=e:this["_"+n]=e},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(t){return this._months[t.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(t){return this._monthsShort[t.month()]},monthsParse:function(t){var e,n,i;for(this._monthsParse||(this._monthsParse=[]),e=0;12>e;e++)if(this._monthsParse[e]||(n=ie.utc([2e3,e]),i="^"+this.months(n,"")+"|^"+this.monthsShort(n,""),this._monthsParse[e]=new RegExp(i.replace(".",""),"i")),this._monthsParse[e].test(t))return e},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(t){return this._weekdays[t.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(t){return this._weekdaysShort[t.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(t){return this._weekdaysMin[t.day()]},weekdaysParse:function(t){var e,n,i;for(this._weekdaysParse||(this._weekdaysParse=[]),e=0;7>e;e++)if(this._weekdaysParse[e]||(n=ie([2e3,1]).day(e),i="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[e]=new RegExp(i.replace(".",""),"i")),this._weekdaysParse[e].test(t))return e},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(t){var e=this._longDateFormat[t];return!e&&this._longDateFormat[t.toUpperCase()]&&(e=this._longDateFormat[t.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(t){return t.slice(1)}),this._longDateFormat[t]=e),e},isPM:function(t){return"p"===(t+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(t,e,n){return t>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(t,e){var n=this._calendar[t];return"function"==typeof n?n.apply(e):n},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(t,e,n,i){var r=this._relativeTime[n];return"function"==typeof r?r(t,e,n,i):r.replace(/%d/i,t)},pastFuture:function(t,e){var n=this._relativeTime[t>0?"future":"past"];return"function"==typeof n?n(e):n.replace(/%s/i,e)},ordinal:function(t){return this._ordinal.replace("%d",t)},_ordinal:"%d",preparse:function(t){return t},postformat:function(t){return t},week:function(t){return K(t,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),ie=function(n,i,r,s){var o;return"boolean"==typeof r&&(s=r,r=t),o={},o._isAMomentObject=!0,o._i=n,o._f=i,o._l=r,o._strict=s,o._isUTC=!1,o._pf=e(),Z(o)},ie.utc=function(n,i,r,s){var o;return"boolean"==typeof r&&(s=r,r=t),o={},o._isAMomentObject=!0,o._useUTC=!0,o._isUTC=!0,o._l=r,o._i=n,o._f=i,o._strict=s,o._pf=e(),Z(o).utc()},ie.unix=function(t){return ie(1e3*t)},ie.duration=function(t,e){var n,i,r,s=t,a=null;return ie.isDuration(t)?s={ms:t._milliseconds,d:t._days,M:t._months}:"number"==typeof t?(s={},e?s[e]=t:s.milliseconds=t):(a=ye.exec(t))?(n="-"===a[1]?-1:1,s={y:0,d:b(a[ue])*n,h:b(a[de])*n,m:b(a[he])*n,s:b(a[fe])*n,ms:b(a[pe])*n}):(a=_e.exec(t))&&(n="-"===a[1]?-1:1,r=function(t){var e=t&&parseFloat(t.replace(",","."));return(isNaN(e)?0:e)*n},s={y:r(a[2]),M:r(a[3]),d:r(a[4]),h:r(a[5]),m:r(a[6]),s:r(a[7]),w:r(a[8])}),i=new o(s),ie.isDuration(t)&&t.hasOwnProperty("_lang")&&(i._lang=t._lang),i},ie.version=se,ie.defaultFormat=Fe,ie.updateOffset=function(){},ie.lang=function(t,e){var n;return t?(e?T(C(t),e):null===e?(I(t),t="en"):ge[t]||O(t),n=ie.duration.fn._lang=ie.fn._lang=O(t),n._abbr):ie.fn._lang._abbr},ie.langData=function(t){return t&&t._lang&&t._lang._abbr&&(t=t._lang._abbr),O(t)},ie.isMoment=function(t){return t instanceof s||null!=t&&t.hasOwnProperty("_isAMomentObject")},ie.isDuration=function(t){return t instanceof o},re=Xe.length-1;re>=0;--re)v(Xe[re]);for(ie.normalizeUnits=function(t){return g(t)},ie.invalid=function(t){var e=ie.utc(0/0);
return null!=t?a(e._pf,t):e._pf.userInvalidated=!0,e},ie.parseZone=function(t){return ie(t).parseZone()},a(ie.fn=s.prototype,{clone:function(){return ie(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var t=ie(this).utc();return 0<t.year()&&t.year()<=9999?L(t,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):L(t,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var t=this;return[t.year(),t.month(),t.date(),t.hours(),t.minutes(),t.seconds(),t.milliseconds()]},isValid:function(){return S(this)},isDSTShifted:function(){return this._a?this.isValid()&&p(this._a,(this._isUTC?ie.utc(this._a):ie(this._a)).toArray())>0:!1},parsingFlags:function(){return a({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(t){var e=L(this,t||ie.defaultFormat);return this.lang().postformat(e)},add:function(t,e){var n;return n="string"==typeof t?ie.duration(+e,t):ie.duration(t,e),d(this,n,1),this},subtract:function(t,e){var n;return n="string"==typeof t?ie.duration(+e,t):ie.duration(t,e),d(this,n,-1),this},diff:function(t,e,n){var i,r,s=k(t,this),o=6e4*(this.zone()-s.zone());return e=g(e),"year"===e||"month"===e?(i=432e5*(this.daysInMonth()+s.daysInMonth()),r=12*(this.year()-s.year())+(this.month()-s.month()),r+=(this-ie(this).startOf("month")-(s-ie(s).startOf("month")))/i,r-=6e4*(this.zone()-ie(this).startOf("month").zone()-(s.zone()-ie(s).startOf("month").zone()))/i,"year"===e&&(r/=12)):(i=this-s,r="second"===e?i/1e3:"minute"===e?i/6e4:"hour"===e?i/36e5:"day"===e?(i-o)/864e5:"week"===e?(i-o)/6048e5:i),n?r:l(r)},from:function(t,e){return ie.duration(this.diff(t)).lang(this.lang()._abbr).humanize(!e)},fromNow:function(t){return this.from(ie(),t)},calendar:function(){var t=k(ie(),this).startOf("day"),e=this.diff(t,"days",!0),n=-6>e?"sameElse":-1>e?"lastWeek":0>e?"lastDay":1>e?"sameDay":2>e?"nextDay":7>e?"nextWeek":"sameElse";return this.format(this.lang().calendar(n,this))},isLeapYear:function(){return w(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(t){var e=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=t?(t=V(t,this.lang()),this.add({d:t-e})):e},month:function(t){var e,n=this._isUTC?"UTC":"";return null!=t?"string"==typeof t&&(t=this.lang().monthsParse(t),"number"!=typeof t)?this:(e=this.date(),this.date(1),this._d["set"+n+"Month"](t),this.date(Math.min(e,this.daysInMonth())),ie.updateOffset(this),this):this._d["get"+n+"Month"]()},startOf:function(t){switch(t=g(t)){case"year":this.month(0);case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===t?this.weekday(0):"isoWeek"===t&&this.isoWeekday(1),this},endOf:function(t){return t=g(t),this.startOf(t).add("isoWeek"===t?"week":t,1).subtract("ms",1)},isAfter:function(t,e){return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)>+ie(t).startOf(e)},isBefore:function(t,e){return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)<+ie(t).startOf(e)},isSame:function(t,e){return e=e||"ms",+this.clone().startOf(e)===+k(t,this).startOf(e)},min:function(t){return t=ie.apply(null,arguments),this>t?this:t},max:function(t){return t=ie.apply(null,arguments),t>this?this:t},zone:function(t){var e=this._offset||0;return null==t?this._isUTC?e:this._d.getTimezoneOffset():("string"==typeof t&&(t=$(t)),Math.abs(t)<16&&(t=60*t),this._offset=t,this._isUTC=!0,e!==t&&d(this,ie.duration(e-t,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(t){return t=t?ie(t).zone():0,0===(this.zone()-t)%60},daysInMonth:function(){return y(this.year(),this.month())},dayOfYear:function(t){var e=ae((ie(this).startOf("day")-ie(this).startOf("year"))/864e5)+1;return null==t?e:this.add("d",t-e)},quarter:function(){return Math.ceil((this.month()+1)/3)},weekYear:function(t){var e=K(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==t?e:this.add("y",t-e)},isoWeekYear:function(t){var e=K(this,1,4).year;return null==t?e:this.add("y",t-e)},week:function(t){var e=this.lang().week(this);return null==t?e:this.add("d",7*(t-e))},isoWeek:function(t){var e=K(this,1,4).week;return null==t?e:this.add("d",7*(t-e))},weekday:function(t){var e=(this.day()+7-this.lang()._week.dow)%7;return null==t?e:this.add("d",t-e)},isoWeekday:function(t){return null==t?this.day()||7:this.day(this.day()%7?t:t-7)},get:function(t){return t=g(t),this[t]()},set:function(t,e){return t=g(t),"function"==typeof this[t]&&this[t](e),this},lang:function(e){return e===t?this._lang:(this._lang=O(e),this)}}),re=0;re<Ye.length;re++)J(Ye[re].toLowerCase().replace(/s$/,""),Ye[re]);J("year","FullYear"),ie.fn.days=ie.fn.day,ie.fn.months=ie.fn.month,ie.fn.weeks=ie.fn.week,ie.fn.isoWeeks=ie.fn.isoWeek,ie.fn.toJSON=ie.fn.toISOString,a(ie.duration.fn=o.prototype,{_bubble:function(){var t,e,n,i,r=this._milliseconds,s=this._days,o=this._months,a=this._data;a.milliseconds=r%1e3,t=l(r/1e3),a.seconds=t%60,e=l(t/60),a.minutes=e%60,n=l(e/60),a.hours=n%24,s+=l(n/24),a.days=s%30,o+=l(s/30),a.months=o%12,i=l(o/12),a.years=i},weeks:function(){return l(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+2592e6*(this._months%12)+31536e6*b(this._months/12)},humanize:function(t){var e=+this,n=Q(e,!t,this.lang());return t&&(n=this.lang().pastFuture(e,n)),this.lang().postformat(n)},add:function(t,e){var n=ie.duration(t,e);return this._milliseconds+=n._milliseconds,this._days+=n._days,this._months+=n._months,this._bubble(),this},subtract:function(t,e){var n=ie.duration(t,e);return this._milliseconds-=n._milliseconds,this._days-=n._days,this._months-=n._months,this._bubble(),this},get:function(t){return t=g(t),this[t.toLowerCase()+"s"]()},as:function(t){return t=g(t),this["as"+t.charAt(0).toUpperCase()+t.slice(1)+"s"]()},lang:ie.fn.lang,toIsoString:function(){var t=Math.abs(this.years()),e=Math.abs(this.months()),n=Math.abs(this.days()),i=Math.abs(this.hours()),r=Math.abs(this.minutes()),s=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(t?t+"Y":"")+(e?e+"M":"")+(n?n+"D":"")+(i||r||s?"T":"")+(i?i+"H":"")+(r?r+"M":"")+(s?s+"S":""):"P0D"}});for(re in He)He.hasOwnProperty(re)&&(ee(re,He[re]),te(re.toLowerCase()));ee("Weeks",6048e5),ie.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},ie.lang("en",{ordinal:function(t){var e=t%10,n=1===b(t%100/10)?"th":1===e?"st":2===e?"nd":3===e?"rd":"th";return t+n}}),ve?(module.exports=ie,ne(!0)):"function"==typeof define&&define.amd?define("moment",function(e,n,i){return i.config&&i.config()&&i.config().noGlobal!==!0&&ne(i.config().noGlobal===t),ie}):ne()}.call(this),define("rental-notifications",["moment","format","access-control"],function(t,e,n){function i(t){return t-Date.now()}function r(t){return e.friendlyDuration(i(t))}function s(e){return t(e).format("dddd, MMMM Do YYYY, h:mm a")}function o(){var t=null,e=!1,o=$(".rental-expires-in"),a=$(".rental-expired-on");o.find(".close").click(function(){clearInterval(t),o.removeClass("open")}),a.find(".close").click(function(){a.removeClass("open")}),$(n).on("rental-expiry",function(n,c){e||(i(c)>=0?(o.addClass("open").find(".time").text(r(c)),clearInterval(t),t=setInterval(function(){i(c)>=0?o.find(".time").text(r(c)):clearInterval(t)},1e3)):a.addClass("open").find(".time").text(s(c)),e=!0)})}var a={};return $(function(){o()}),a}),define("shared-notifications",["article"],function(t){function e(){var e=!1,n=$(".notifications .shared-access");n.find(".close").click(function(){n.removeClass("open")}),t.onAccessCheck(function(t){e||(t.access&&t.access_shared?(e=!0,n.addClass("open")):n.removeClass("open"))})}return $(function(){e()}),api}),define("notifications",["annotation-notifications","rental-notifications","shared-notifications"],function(){return{}}),define("user-voice",["session","user","util"],function(t,e){function n(){r||($(function(){s=$("#user-voice"),t.onceStarted(i)}),r=!0)}function i(){UserVoice=window.UserVoice||[],$.getScript("//widget.uservoice.com/H9jSrH2fJST0D33BtNfyOA.js",function(){s.show()}),UserVoice.push(["set",{accent_color:"#448dd6",permalinks_enabled:!1,contact_title:"How can we help you?",ticket_custom_fields:{Product:"HTML5 Web Reader"}}]),e.onSignIn(function(){UserVoice.push(["identify",e.get()])}),UserVoice.push(["addTrigger","#user-voice",{mode:"contact",permalinks_enabled:!1,menu:!1,topic_id:4937,forum_id:263598}])}var r=!1,s=null;n()}),define("reader",["enviroment","endpoint","access-control","key-handler","copy-control","banner","citations-view","annotations-view","bottombar-view","topbar-view","sidepanel-view","publisher-fixes","notifications","user-voice"],function(t,e){t.production()||(window["readcube-console-log"]=!0),$(function(){$(document.body).removeClass("redirect-wait")}),e("parent")&&window.parent.postMessage({type:"load"},e("parent"))}),define("initializer",["compatible","endpoint"],function(t,e){function n(){return/^\/force_reader_v2\/.+/.test(location.pathname)}function i(){t.result||n()?require("reader"):location.href=e("legacy_browser_redirect")}i()}),require("initializer");